import{$ as q,Y as Z,a0 as E,Z as f,a1 as J,r as v,j as e,a2 as X,_ as ee,C as P,g as R,i as S,N as T,O as U,a3 as se,k as K}from"./index-CjT1ZNgX.js";import{T as te}from"./TablesWidget13-DcY1CsaW.js";import{D as ae,a as re,b as ne}from"./DynamicEditModal-CWHXiAYX.js";import{u as w,a as I}from"./useMutation-bify0NZM.js";import{u as G}from"./useVendors-DT93MlyL.js";import{S as C}from"./StatusBadge-CApyHaA7.js";import{u as le}from"./useSpkList-ne6It3YS.js";import"./ThemeProvider-DxhEyUPT.js";import"./Modal-Ch3UiCbq.js";import"./hasClass-CN7lXdNy.js";import"./Form-Bl1QkGuE.js";import"./warning-6ASXsdlm.js";const ie=async()=>(await q.get("/delivery-note/type")).data.data,oe=async r=>{const s=await q.get("/delivery-note",{params:r});return{data:s.data.data,meta:s.data.meta}},de=async r=>(await q.get(`/delivery-note/${r}`)).data.data,ce=async r=>{const u=r?`/delivery-note/generate-no/${encodeURIComponent((t=>t.replace(/^SURAT JALAN\s+/i,"").trim().replace(/\s+/g,"_").toUpperCase())(r))}`:"/delivery-note/generate-no";return(await q.get(u)).data.data.delivery_note_no},me=async r=>(await q.post("/delivery-note",r)).data.data,he=async r=>(await q.put("/delivery-note",r)).data.data,ue=async r=>{await q.post("/delivery-note/approval",r)},Q=r=>{var o,h;const s=Z(),u=w({queryKey:["delivery-notes",r],queryFn:()=>oe(r)}),m=I({mutationFn:d=>me(d),onSuccess:d=>{console.log("Add delivery note success:",d),s.invalidateQueries({queryKey:["delivery-notes"]}),f.success("Delivery note added successfully")},onError:d=>{var n;const y=d instanceof E?(n=d.response)==null?void 0:n.data.message:`Gagal Menambah Surat Jalan: ${d.message}`;Array.isArray(y)?y.forEach(a=>f.error(a)):f.error(y)}}),t=I({mutationFn:d=>he(d),onSuccess:d=>{console.log("Update delivery note success:",d),s.invalidateQueries({queryKey:["delivery-notes"]}),f.success("Delivery note updated successfully")},onError:d=>{var n;const y=d instanceof E?(n=d.response)==null?void 0:n.data.message:`Gagal Mengubah Surat Jalan: ${d.message}`;Array.isArray(y)?y.forEach(a=>f.error(a)):f.error(y)}}),x=I({mutationFn:d=>ue(d),onSuccess:()=>{console.log("Approve delivery note success"),s.invalidateQueries({queryKey:["delivery-notes"]}),f.success("Delivery note approved successfully")},onError:d=>{var n;const y=d instanceof E?(n=d.response)==null?void 0:n.data.message:`Gagal Approve: ${d.message}`;Array.isArray(y)?y.forEach(a=>f.error(a)):f.error(y)}});return{deliveryNotes:((o=u.data)==null?void 0:o.data)||[],meta:(h=u.data)==null?void 0:h.meta,isLoading:u.isLoading,error:u.error,addDeliveryNote:m.mutate,updateDeliveryNote:t.mutate,approveDeliveryNote:x.mutate,isAdding:m.isPending,isUpdating:t.isPending,isApproving:x.isPending}},xe=r=>{const s=w({queryKey:["delivery-note",r],queryFn:()=>de(r),enabled:!!r});return{deliveryNote:s.data,isLoading:s.isLoading,error:s.error}},B=()=>{const r=w({queryKey:["delivery-note-types"],queryFn:ie});return{types:r.data||[],isLoading:r.isLoading,error:r.error}},L=r=>{const s=w({queryKey:["generate-delivery-note-no",r],queryFn:()=>ce(r),enabled:!!r});return{deliveryNoteNo:s.data,isLoading:s.isLoading,error:s.error,refetch:s.refetch}},je=()=>{const r=J(),[s,u]=v.useState(!1),[m,t]=v.useState(!1),[x,o]=v.useState(!1),[h,d]=v.useState(null),[y,n]=v.useState(""),{deliveryNotes:a,addDeliveryNote:p,updateDeliveryNote:i}=Q(),{types:_}=B(),{vendors:j}=G(),{deliveryNoteNo:b,refetch:A}=L(y),k=[{key:"noSJ",label:"No. SJ",className:"min-w-120px"},{key:"tanggal",label:"Tanggal",className:"min-w-100px"},{key:"jenis",label:"Jenis",className:"min-w-100px"},{key:"vendor",label:"Vendor",className:"min-w-125px"},{key:"tujuan",label:"Tujuan",className:"min-w-125px"},{key:"status",label:"Status",className:"min-w-100px"},{key:"createdBy",label:"Created By",className:"min-w-125px"}],l=a.map(c=>({id:c.id,noSJ:c.delivery_note_no,tanggal:c.delivery_note_date,jenis:c.delivery_note_type,vendor:c.vendor.name,tujuan:c.destination,status:e.jsx(C,{status:c.status.toLowerCase()}),createdBy:"System"})),F=c=>{d(c),u(!0)},O=()=>{console.log("Deleting:",h),u(!1)},$=c=>{const N=a.find(Y=>Y.id===c.id);d(N?{id:N.id,noSJ:N.delivery_note_no,tanggal:N.delivery_note_date,jenis:N.delivery_note_type,vendor:N.vendor.id,tujuan:N.destination,status:N.status,notes:N.notes}:c),t(!0)},z=c=>{const N={id:c.id,delivery_note_no:c.noSJ,delivery_note_date:c.tanggal,delivery_note_type:c.jenis,vendor_id:c.vendor||"",destination:c.tujuan,status:c.status,notes:c.notes||"",user_id:"system",details:[]};i(N),t(!1),d(null)},H=()=>{r("/production/add-surat-jalan")},V=c=>{n(c),A()},W=c=>{const N={delivery_note_no:b||c.noSJ,delivery_note_date:c.tanggal,delivery_note_type:c.jenis,vendor_id:c.vendor,destination:c.tujuan,status:c.status,notes:c.notes||"",user_id:"system",details:[]};p(N),o(!1),n("")};return e.jsxs("div",{children:[e.jsx(te,{className:"card-xl-stretch",rows:l,columns:k,labelAdd:"Surat Jalan",filters:[{key:"jenis",label:"Filter by Jenis"},{key:"vendor",label:"Filter by Vendor"},{key:"status",label:"Filter by Status"}],onDelete:F,onEdit:$,onAddClick:H,onRowClick:c=>r(`/production/delivery-note-detail/detail/${c.id}`),roleAccess:["ADMIN","OWNER","ADMIN PRODUKSI"]}),s&&h&&e.jsx(ae,{show:s,title:"Delete Surat Jalan",itemName:h.noSJ,onConfirm:O,onClose:()=>{u(!1),d(null)}}),m&&h&&e.jsx(re,{show:m,title:"Edit Surat Jalan",fields:[{name:"noSJ",label:"No. SJ",type:"text",required:!0,icon:"document"},{name:"tanggal",label:"Tanggal",type:"date",required:!0,icon:"calendar"},{name:"jenis",label:"Jenis",type:"select",required:!0,options:_.map(c=>({value:c.id,label:c.name})),icon:"cog"},{name:"vendor",label:"Vendor",type:"select",required:!0,options:j.map(c=>({value:c.id,label:c.name})),icon:"user"},{name:"tujuan",label:"Tujuan",type:"text",required:!0,icon:"map"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"PENDING",label:"Pending"},{value:"DONE",label:"Done"}],icon:"check-circle"},{name:"notes",label:"Notes",type:"textarea",required:!1,icon:"comment"}],initialData:h,onSave:z,onClose:()=>{t(!1),d(null)}}),x&&e.jsx(ne,{show:x,title:"Add Surat Jalan",fields:[{name:"jenis",label:"Jenis",type:"select",required:!0,options:_.map(c=>({value:c.id,label:c.name})),icon:"cog",onChange:V},{name:"noSJ",label:"No. SJ",type:"text",required:!0,icon:"document"},{name:"tanggal",label:"Tanggal",type:"date",required:!0,icon:"calendar"},{name:"vendor",label:"Vendor",type:"select",required:!0,options:j.map(c=>({value:c.id,label:c.name})),icon:"user"},{name:"tujuan",label:"Tujuan",type:"text",required:!0,icon:"map"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"PENDING",label:"Pending"},{value:"DONE",label:"Done"}],icon:"check-circle"},{name:"notes",label:"Notes",type:"textarea",required:!1,icon:"comment"}],onSubmit:W,onClose:()=>o(!1)})]})},ye=()=>{const[r,s]=v.useState({delivery_note_no:"",delivery_note_date:"",delivery_note_type:"PERMINTAAN_KAIN",vendor_id:"",destination:"",status:"PENDING",notes:"",user_id:"system"}),{deliveryNoteNo:u,refetch:m}=L(r.delivery_note_type);return v.useEffect(()=>{r.delivery_note_type&&m()},[r.delivery_note_type,m]),v.useEffect(()=>{u&&s(x=>({...x,delivery_note_no:u}))},[u]),v.useEffect(()=>{const x=new Date().toISOString().split("T")[0];s(o=>({...o,delivery_note_date:x}))},[]),{formData:r,updateFormData:x=>{s(o=>({...o,...x}))}}},pe=()=>{const{data:r}=le(),[s,u]=v.useState([]),[m,t]=v.useState({});return v.useEffect(()=>{s.forEach(o=>{m[o]||(async()=>{try{const d=await q.get(`/spk/${o}`);d.data.success&&t(y=>({...y,[o]:d.data.data.details}))}catch(d){console.error("Error fetching SPK detail:",d)}})()})},[s,m]),{spkList:r,selectedSpks:s,spkDetails:m,toggleSpkSelection:o=>{u(h=>h.includes(o)?h.filter(d=>d!==o):[...h,o])}}},g={PERMINTAAN_KAIN:"PERMINTAAN_KAIN",BUANG_BENANG_KELUAR:"BUANG_BENANG_KELUAR",JAHIT_KELUAR:"JAHIT_KELUAR",BUANG_BENANG_MASUK:"BUANG_BENANG_MASUK",JAHIT_MASUK:"JAHIT_MASUK",PENGIRIMAN_BARANG:"PENGIRIMAN_BARANG"},D=(r,s,u)=>{const m=Array.isArray(r)?r:[];if(u===g.PERMINTAAN_KAIN){const t=Array.isArray(s.req_material)?s.req_material:[],x=t.find(h=>/kain/i.test(h.material_name))||t[0];if(x)return{material_name:x.material_name,material_qty:x.qty_required};const o=m.find(h=>/kain/i.test(h.material_name));if(o)return{material_name:o.material_name,material_qty:o.qty_per_unit*s.qty_order}}return{material_name:"",material_qty:0}},ve=r=>{const[s,u]=v.useState([]);return{selectedDetails:s,handleDetailSelect:(o,h,d)=>{if(d){const{material_name:y,material_qty:n}=D(o.bom,o,r),a={spk_detail_id:o.id,item_type:"PRODUCT",product_variant_id:(o==null?void 0:o.id)??"",material_id:null,qty_out:o.qty_order,qty_in:0,labor_cost:0,spk_no:h.noSpk,product_name:o.product_name,color:o.color,size:o.size,qty_order:o.qty_order,material_name:y,material_qty:n,short_material:0,qty_done:0,hpp:0,selisih:0,req_material:o.req_material};u(p=>[...p,a])}else u(y=>y.filter(n=>n.spk_detail_id!==o.id))},handleSelectAllDetails:(o,h,d,y)=>{if(h){const n=y.map(a=>{const{material_name:p,material_qty:i}=D(a.bom,a,r);return{spk_detail_id:a.id,item_type:"PRODUCT",product_variant_id:(a==null?void 0:a.id)??"",material_id:null,qty_out:a.qty_order,qty_in:0,labor_cost:0,spk_no:d.noSpk,product_name:a.product_name,color:a.color,size:a.size,qty_order:a.qty_order,material_name:p,material_qty:i,short_material:0,qty_done:0,hpp:0,selisih:0,req_material:a.req_material}});u(a=>[...a.filter(p=>!y.some(i=>i.id===p.spk_detail_id)),...n])}else u(n=>n.filter(a=>!y.some(p=>p.id===a.spk_detail_id)))},updateDetail:(o,h,d)=>{u(y=>y.map(n=>n.spk_detail_id===o?{...n,[h]:d}:n))}}},_e=({formData:r,updateFormData:s})=>{const{types:u}=B(),{vendors:m}=G();return e.jsxs("div",{children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Note No *"}),e.jsx("input",{type:"text",className:"form-control",value:r.delivery_note_no,onChange:t=>s({delivery_note_no:t.target.value}),disabled:!0})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Date *"}),e.jsx("input",{type:"date",className:"form-control",value:r.delivery_note_date,onChange:t=>s({delivery_note_date:t.target.value})})]})})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Type *"}),e.jsx("select",{className:"form-select",value:r.delivery_note_type,onChange:t=>s({delivery_note_type:t.target.value}),children:u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Vendor *"}),e.jsxs("select",{className:"form-select",value:r.vendor_id,onChange:t=>s({vendor_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Vendor"}),m.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})})]}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Destination *"}),e.jsx("input",{type:"text",className:"form-control",value:r.destination,onChange:t=>s({destination:t.target.value})})]})})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"form-control",rows:3,value:r.notes,onChange:t=>s({notes:t.target.value})})]})]})},Ne=({spkList:r,selectedSpks:s,toggleSpkSelection:u})=>{const[m,t]=v.useState(""),[x,o]=v.useState(1),h=3,d=(r==null?void 0:r.filter(a=>a.status==="approved"&&(m===""||a.noSpk.toLowerCase().includes(m.toLowerCase())||a.buyer.toLowerCase().includes(m.toLowerCase()))))||[],y=d.slice((x-1)*h,x*h),n=Math.ceil(d.length/h);return e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Select SPKs *"}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-md-6",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search SPK by number or buyer...",value:m,onChange:a=>t(a.target.value),onKeyDown:a=>{a.key==="Enter"&&o(1)}})})}),e.jsx("div",{className:"row",children:y.map(a=>e.jsx("div",{className:"col-md-6 col-lg-4 mb-3",children:e.jsx("div",{className:`card h-100 ${s.includes(a.id)?"border-primary":"border-light"}`,children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`spk-${a.id}`,checked:s.includes(a.id),disabled:a.status!=="approved",onChange:()=>u(a.id)}),e.jsx("label",{className:"form-check-label w-100",htmlFor:`spk-${a.id}`,children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("strong",{className:"text-primary",children:a.noSpk}),e.jsx("small",{className:"text-muted",children:a.buyer}),e.jsx("span",{className:`badge ${a.status==="approved"?"bg-success":a.status==="in_progress"?"bg-warning":"bg-secondary"} mt-1 align-self-start`,children:a.status.replace("_"," ").toUpperCase()})]})})]})})})},a.id))}),n>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsx("nav",{children:e.jsxs("ul",{className:"pagination",children:[e.jsx("li",{className:`page-item ${x===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(a=>Math.max(1,a-1)),disabled:x===1,children:"Previous"})}),Array.from({length:n},(a,p)=>p+1).map(a=>e.jsx("li",{className:`page-item ${x===a?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(a),children:a})},a)),e.jsx("li",{className:`page-item ${x===n?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(a=>Math.min(n,a+1)),disabled:x===n,children:"Next"})})]})})}),s.length>0&&e.jsx("div",{className:"mt-3",children:e.jsxs("small",{className:"text-muted",children:["Selected ",s.length," SPK",s.length>1?"s":""]})})]})},ge=({selectedSpks:r,spkList:s,spkDetails:u,selectedDetails:m,deliveryNoteType:t,handleDetailSelect:x,handleSelectAllDetails:o,updateDetail:h})=>{if(r.length===0)return null;const d=()=>{const n=[e.jsx("th",{},"checkbox"),e.jsx("th",{children:"Product"},"product"),e.jsx("th",{children:"Color"},"color"),e.jsx("th",{children:"Size"},"size")];return t===g.PERMINTAAN_KAIN?n.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Nama Material"},"material_name"),e.jsx("th",{children:"Jumlah Material"},"material_qty"),e.jsx("th",{children:"Kurang Material"},"short_material")):t===g.BUANG_BENANG_KELUAR||t===g.JAHIT_KELUAR?n.push(e.jsx("th",{children:"Qty Order"},"qty_order"),e.jsx("th",{children:"Qty Out"},"qty_out")):t===g.BUANG_BENANG_MASUK||t===g.JAHIT_MASUK?n.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"Qty In"},"qty_in"),e.jsx("th",{children:"Selisih"},"selisih")):t===g.PENGIRIMAN_BARANG?n.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Qty Done"},"qty_done"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"HPP"},"hpp")):n.push(e.jsx("th",{children:"Qty Order"},"qty_order"),e.jsx("th",{children:"Qty"},"qty_out")),n},y=(n,a)=>{var j,b,A,k;const p=m.some(l=>l.spk_detail_id===n.id),i=m.find(l=>l.spk_detail_id===n.id),_=[e.jsx("td",{onClick:l=>l.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:p,onChange:l=>x(n,a,l.target.checked)})},"checkbox"),e.jsx("td",{children:n.product_name},"product"),e.jsx("td",{children:n.color},"color"),e.jsx("td",{children:n.size},"size")];return t===g.PERMINTAAN_KAIN?_.push(e.jsx("td",{children:n.qty_order},"qty_spk"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"text",className:"form-control",value:((b=(j=i==null?void 0:i.req_material)==null?void 0:j[0])==null?void 0:b.material_name)??(i==null?void 0:i.material_name)??"",readOnly:!0})},"material_name"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:((k=(A=i==null?void 0:i.req_material)==null?void 0:A[0])==null?void 0:k.qty_required)??(i==null?void 0:i.material_qty)??"",readOnly:!0})},"material_qty"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.short_material)||"",onChange:l=>h(n.id,"short_material",l.target.value===""?0:parseInt(l.target.value)||0),min:0})},"short_material")):t===g.BUANG_BENANG_KELUAR||t===g.JAHIT_KELUAR?_.push(e.jsx("td",{children:n.qty_order},"qty_order"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:l=>h(n.id,"qty_out",l.target.value===""?0:parseInt(l.target.value)||0),max:n.qty_order,min:0})},"qty_out")):t===g.BUANG_BENANG_MASUK||t===g.JAHIT_MASUK?_.push(e.jsx("td",{children:n.qty_order},"qty_spk"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:l=>h(n.id,"qty_out",l.target.value===""?0:parseInt(l.target.value)||0),min:0})},"qty_out"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_in)||"",onChange:l=>h(n.id,"qty_in",l.target.value===""?0:parseInt(l.target.value)||0),min:0})},"qty_in"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.selisih)||"",onChange:l=>h(n.id,"selisih",l.target.value===""?0:parseInt(l.target.value)||0),min:0})},"selisih")):t===g.PENGIRIMAN_BARANG?_.push(e.jsx("td",{children:n.qty_order},"qty_spk"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_done)||"",onChange:l=>h(n.id,"qty_done",l.target.value===""?0:parseInt(l.target.value)||0),min:0})},"qty_done"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:l=>h(n.id,"qty_out",l.target.value===""?0:parseInt(l.target.value)||0),min:0})},"qty_out"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.hpp)||"",onChange:l=>h(n.id,"hpp",l.target.value===""?0:parseFloat(l.target.value)||0),min:0,step:"0.01"})},"hpp")):_.push(e.jsx("td",{children:n.qty_order},"qty_order"),e.jsx("td",{onClick:l=>l.stopPropagation(),children:p&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:l=>h(n.id,"qty_out",l.target.value===""?0:parseInt(l.target.value)||0),max:n.qty_order,min:0})},"qty_out")),_};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Select SPK Details"}),r.map(n=>{const a=s==null?void 0:s.find(j=>j.id===n),p=u[n]||[],i=p.length>0&&p.every(j=>m.some(b=>b.spk_detail_id===j.id)),_=p.some(j=>m.some(b=>b.spk_detail_id===j.id));return e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{children:[a==null?void 0:a.noSpk," - ",a==null?void 0:a.buyer]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("input",{type:"checkbox",checked:i,ref:j=>{j&&(j.indeterminate=_&&!i)},onChange:j=>o(n,j.target.checked,a,p)})}),d().slice(1)]})}),e.jsx("tbody",{children:p.map(j=>{const b=m.some(A=>A.spk_detail_id===j.id);return e.jsx("tr",{className:`cursor-pointer ${b?"table-active":""}`,onClick:()=>x(j,a,!b),children:y(j,a)},j.id)})})]})})]},n)})]})},be=()=>{const r=J(),{addDeliveryNote:s}=Q(),{currentUser:u}=X(),{formData:m,updateFormData:t}=ye(),{spkList:x,selectedSpks:o,spkDetails:h,toggleSpkSelection:d}=pe(),{selectedDetails:y,handleDetailSelect:n,handleSelectAllDetails:a,updateDetail:p}=ve(m.delivery_note_type),i=()=>{if(!m.delivery_note_no||!m.delivery_note_date||!m.vendor_id||!m.destination){alert("Please fill all required fields");return}if(y.length===0){alert("Please select at least one SPK detail");return}if(u){const _={...m,user_id:u==null?void 0:u.full_name,details:y.map(j=>({spk_detail_id:j.spk_detail_id,item_type:j.item_type,product_variant_id:j.product_variant_id,material_id:j.material_id,qty_out:j.qty_out,qty_in:j.qty_in,labor_cost:j.labor_cost,material_name:j.material_name,material_qty:j.material_qty,short_material:j.short_material,qty_done:j.qty_done,hpp:j.hpp,selisih:j.selisih}))};console.log(_),s(_),r("/production/surat-jalan")}};return e.jsx("div",{className:"container-fluid",children:e.jsxs(ee,{children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Add Surat Jalan"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(_e,{formData:m,updateFormData:t}),e.jsx(Ne,{spkList:x,selectedSpks:o,toggleSpkSelection:d}),e.jsx(ge,{selectedSpks:o,spkList:x,spkDetails:h,selectedDetails:y,deliveryNoteType:m.delivery_note_type,handleDetailSelect:n,handleSelectAllDetails:a,updateDetail:p}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:i,children:"Save Surat Jalan"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>r("/production/surat-jalan"),children:"Cancel"})]})]})]})})},fe=({deliveryNoteId:r})=>{console.log(r);const{deliveryNote:s,isLoading:u,error:m}=xe(r||"");return r?u?e.jsx(P,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):m?e.jsx(P,{children:e.jsxs("div",{className:"alert alert-danger",children:["Error loading delivery note: ",m.message]})}):s?e.jsxs(P,{children:[e.jsxs("div",{className:"card mb-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"card-title",children:e.jsxs("h3",{className:"card-label",children:["Delivery Note #",s.delivery_note_no]})})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Delivery Note No:"})," ",s.delivery_note_no]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Delivery Date:"})," ",s.delivery_note_date]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Type:"})," ",s.delivery_note_type]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Vendor:"})," ",s.vendor.name]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Destination:"})," ",s.destination]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(C,{status:s.status.toLowerCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Notes:"})," ",s.notes||"-"]})]})]})})]}),e.jsxs("div",{className:"card mb-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Vendor Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Name:"})," ",s.vendor.name]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Contact Person:"})," ",s.vendor.contact_person]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Phone:"})," ",s.vendor.phone]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Email:"})," ",s.vendor.email]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Address:"})," ",s.vendor.address]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"City:"})," ",s.vendor.city,", ",s.vendor.province,", ",s.vendor.country]})]})]})})]}),s.details&&s.details.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Delivery Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-block d-md-none",children:["// eslint-disable-next-line @typescript-eslint/no-explicit-any",s.details.map((t,x)=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h6",{className:"card-title mb-2",children:["Detail #",x+1]}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Item Type"}),e.jsx("div",{children:t.item_type})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Out"}),e.jsx("div",{children:t.qty_out})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty In"}),e.jsx("div",{children:t.qty_in})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted",children:"HPP"}),e.jsxs("div",{children:["Rp ",t.labor_cost.toLocaleString()]})]})]})]})},t.id||x))]}),e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-125px",children:"SPK Detail ID"}),e.jsx("th",{className:"min-w-100px",children:"Item Type"}),e.jsx("th",{className:"min-w-100px",children:"Product Variant ID"}),e.jsx("th",{className:"min-w-100px",children:"Material ID"}),e.jsx("th",{className:"min-w-80px",children:"Qty Out"}),e.jsx("th",{className:"min-w-80px",children:"Qty In"}),e.jsx("th",{className:"min-w-100px",children:"Labor Cost"}),e.jsx("th",{className:"min-w-100px",children:"Status"})]})}),e.jsx("tbody",{className:"text-gray-600 fw-semibold",children:s.details.map((t,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.spk_detail_id}),e.jsx("td",{children:t.item_type}),e.jsx("td",{children:t.product_variant_id||"-"}),e.jsx("td",{children:t.material_id||"-"}),e.jsx("td",{children:t.qty_out}),e.jsx("td",{children:t.qty_in}),e.jsxs("td",{children:["Rp ",t.labor_cost.toLocaleString()]}),e.jsx("td",{children:t.status?e.jsx(C,{status:t.status.toLowerCase()}):"-"})]},t.id||x))})]})})})]})]}),s.spk&&s.spk.length>0&&e.jsxs("div",{className:"card mt-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Related SPK Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"SPK No:"})," ",s.spk[0].spk_no]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Buyer:"})," ",s.spk[0].buyer]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"SPK Date:"})," ",s.spk[0].spk_date]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Deadline:"})," ",s.spk[0].deadline]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(C,{status:s.spk[0].status.toLowerCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Notes:"})," ",s.spk[0].notes||"-"]})]})]})})]}),s.spk_details&&s.spk_details.length>0&&e.jsxs("div",{className:"card mt-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"SPK Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"d-block d-md-none",children:s.spk_details.map(t=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title mb-2",children:t.product_variants.product_name}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Size"}),e.jsx("div",{children:t.product_variants.size})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Color"}),e.jsx("div",{children:t.product_variants.color})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Order"}),e.jsx("div",{children:t.qty_order})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Done"}),e.jsx("div",{children:t.qty_done})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Reject"}),e.jsx("div",{children:t.qty_reject})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Progress"}),e.jsxs("div",{children:[t.progress,"%"]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted",children:"Status"}),e.jsx(C,{status:t.status.toLowerCase()})]})]})]})},t.id))}),e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-200px",children:"Product"}),e.jsx("th",{className:"min-w-80px",children:"Size"}),e.jsx("th",{className:"min-w-80px",children:"Color"}),e.jsx("th",{className:"min-w-80px",children:"Qty Order"}),e.jsx("th",{className:"min-w-80px",children:"Qty Done"}),e.jsx("th",{className:"min-w-80px",children:"Qty Reject"}),e.jsx("th",{className:"min-w-80px",children:"Progress"}),e.jsx("th",{className:"min-w-100px",children:"Status"})]})}),e.jsx("tbody",{className:"text-gray-600 fw-semibold",children:s.spk_details.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.product_variants.product_name}),e.jsx("td",{children:t.product_variants.size}),e.jsx("td",{children:t.product_variants.color}),e.jsx("td",{children:t.qty_order}),e.jsx("td",{children:t.qty_done}),e.jsx("td",{children:t.qty_reject}),e.jsx("td",{children:t.progress}),e.jsx("td",{children:e.jsx(C,{status:t.status.toLowerCase()})})]},t.id))})]})})})]})]})]}):e.jsx(P,{children:e.jsx("div",{className:"alert alert-warning",children:"Delivery note not found."})}):e.jsx(P,{children:e.jsx("div",{className:"alert alert-warning",children:"Delivery note ID is required."})})},Se=[{title:"Surat Jalan",path:"/production/surat-jalan",isSeparator:!1,isActive:!1}],qe=()=>{const{id:r}=se();return e.jsxs(e.Fragment,{children:[e.jsx(K,{breadcrumbs:Se,children:"Delivery Note Detail"}),e.jsx(fe,{deliveryNoteId:r})]})},Ae=()=>e.jsx(R,{children:e.jsxs(S,{element:e.jsx(e.Fragment,{children:e.jsx(U,{})}),children:[e.jsx(S,{path:"detail/:id",element:e.jsx(qe,{})}),e.jsx(S,{index:!0,element:e.jsx(T,{to:"/production/surat-jalan"})})]})}),M=[{title:"Produksi > ",path:"/production/",isSeparator:!1,isActive:!1}],Ue=()=>e.jsx(R,{children:e.jsxs(S,{element:e.jsx(U,{}),children:[e.jsx(S,{path:"surat-jalan",element:e.jsxs(e.Fragment,{children:[e.jsx(K,{breadcrumbs:M,children:"Surat Jalan"}),e.jsx(je,{})]})}),e.jsx(S,{path:"add-surat-jalan",element:e.jsxs(e.Fragment,{children:[e.jsx(K,{breadcrumbs:M,children:"Add Surat Jalan"}),e.jsx(be,{})]})}),e.jsx(S,{path:"delivery-note-detail/*",element:e.jsx(Ae,{})}),e.jsx(S,{index:!0,element:e.jsx(T,{to:"/production/dashboard"})})]})});export{Ue as default};
