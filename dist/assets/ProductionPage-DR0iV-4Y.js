import{a0 as f,Z,X as C,a1 as k,_,a2 as R,r as p,j as e,a3 as ee,$ as se,C as q,g as K,i as b,N as J,O as T,a4 as te,k as E}from"./index-BAulphtV.js";import{T as ae}from"./TablesWidget13-DLHtAgkC.js";import{D as ne,a as re}from"./DynamicDeleteModal-GwsgxHGm.js";import{D as le}from"./DynamicEditModal-Kb9ncj_C.js";import{u as w}from"./useMutation-BLKrHnwU.js";import{u as M}from"./useVendors-B-i7l01M.js";import{S}from"./StatusBadge-D5G5F0Tb.js";import{u as ie}from"./useSpkList-Ddw358zG.js";import"./ThemeProvider-W5bYDXGz.js";import"./Modal-SzttqNH0.js";import"./hasClass-CNQS_-5V.js";import"./warning-BqVEbd31.js";const oe=async()=>(await f.get("/delivery-note/type")).data.data,ce=async r=>{const a=await f.get("/delivery-note",{params:r});return{data:a.data.data,meta:a.data.meta}},de=async r=>(await f.get(`/delivery-note/${r}`)).data.data,me=async r=>{const h=r?`/delivery-note/generate-no/${encodeURIComponent((t=>t.replace(/^SURAT JALAN\s+/i,"").trim().replace(/\s+/g,"_").toUpperCase())(r))}`:"/delivery-note/generate-no";return(await f.get(h)).data.data.delivery_note_no},he=async r=>(await f.post("/delivery-note",r)).data.data,ue=async r=>(await f.put("/delivery-note",r)).data.data,xe=async r=>{await f.post("/delivery-note/approval",r)},U=r=>{var d,u;const a=Z(),h=C({queryKey:["delivery-notes",r],queryFn:()=>ce(r)}),m=w({mutationFn:o=>he(o),onSuccess:o=>{console.log("Add delivery note success:",o),a.invalidateQueries({queryKey:["delivery-notes"]}),_.success("Delivery note added successfully")},onError:o=>{var l;const y=o instanceof k?(l=o.response)==null?void 0:l.data.message:`Gagal Menambah Surat Jalan: ${o.message}`;Array.isArray(y)?y.forEach(n=>_.error(n)):_.error(y)}}),t=w({mutationFn:o=>ue(o),onSuccess:o=>{console.log("Update delivery note success:",o),a.invalidateQueries({queryKey:["delivery-notes"]}),_.success("Delivery note updated successfully")},onError:o=>{var l;const y=o instanceof k?(l=o.response)==null?void 0:l.data.message:`Gagal Mengubah Surat Jalan: ${o.message}`;Array.isArray(y)?y.forEach(n=>_.error(n)):_.error(y)}}),x=w({mutationFn:o=>xe(o),onSuccess:()=>{console.log("Approve delivery note success"),a.invalidateQueries({queryKey:["delivery-notes"]}),_.success("Delivery note approved successfully")},onError:o=>{var l;const y=o instanceof k?(l=o.response)==null?void 0:l.data.message:`Gagal Approve: ${o.message}`;Array.isArray(y)?y.forEach(n=>_.error(n)):_.error(y)}});return{deliveryNotes:((d=h.data)==null?void 0:d.data)||[],meta:(u=h.data)==null?void 0:u.meta,isLoading:h.isLoading,error:h.error,addDeliveryNote:m.mutate,updateDeliveryNote:t.mutate,approveDeliveryNote:x.mutate,isAdding:m.isPending,isUpdating:t.isPending,isApproving:x.isPending}},je=r=>{const a=C({queryKey:["delivery-note",r],queryFn:()=>de(r),enabled:!!r});return{deliveryNote:a.data,isLoading:a.isLoading,error:a.error}},L=()=>{const r=C({queryKey:["delivery-note-types"],queryFn:oe});return{types:r.data||[],isLoading:r.isLoading,error:r.error}},G=r=>{const a=C({queryKey:["generate-delivery-note-no",r],queryFn:()=>me(r),enabled:!!r});return{deliveryNoteNo:a.data,isLoading:a.isLoading,error:a.error,refetch:a.refetch}},ye=()=>{const r=R(),[a,h]=p.useState(!1),[m,t]=p.useState(!1),[x,d]=p.useState(!1),[u,o]=p.useState(null),[y,l]=p.useState(""),{deliveryNotes:n,addDeliveryNote:j,updateDeliveryNote:i}=U(),{types:v}=L(),{vendors:s}=M(),{deliveryNoteNo:g,refetch:P}=G(y),Q=[{key:"noSJ",label:"No. SJ",className:"min-w-120px"},{key:"tanggal",label:"Tanggal",className:"min-w-100px"},{key:"jenis",label:"Jenis",className:"min-w-100px"},{key:"vendor",label:"Vendor",className:"min-w-125px"},{key:"tujuan",label:"Tujuan",className:"min-w-125px"},{key:"status",label:"Status",className:"min-w-100px"},{key:"createdBy",label:"Created By",className:"min-w-125px"}],B=n.map(c=>({id:c.id,noSJ:c.delivery_note_no,tanggal:c.delivery_note_date,jenis:c.delivery_note_type,vendor:c.vendor.name,tujuan:c.destination,status:e.jsx(S,{status:c.status.toLowerCase()}),createdBy:"System"})),O=c=>{o(c),h(!0)},F=()=>{console.log("Deleting:",u),h(!1)},$=c=>{o(c),t(!0)},z=c=>{const A=s.find(X=>X.name===c.vendor),Y={id:c.id,delivery_note_no:c.noSJ,delivery_note_date:c.tanggal,delivery_note_type:c.jenis,vendor_id:(A==null?void 0:A.id)||"",destination:c.tujuan,status:c.status,notes:c.notes||"",user_id:"system",details:[]};i(Y),t(!1),o(null)},V=()=>{r("/production/add-surat-jalan")},H=c=>{l(c),P()},W=c=>{const A={delivery_note_no:g||c.noSJ,delivery_note_date:c.tanggal,delivery_note_type:c.jenis,vendor_id:c.vendor,destination:c.tujuan,status:c.status,notes:c.notes||"",user_id:"system",details:[]};j(A),d(!1),l("")};return e.jsxs("div",{children:[e.jsx(ae,{className:"card-xl-stretch",rows:B,columns:Q,labelAdd:"Surat Jalan",filters:[{key:"jenis",label:"Filter by Jenis"},{key:"vendor",label:"Filter by Vendor"},{key:"status",label:"Filter by Status"}],onDelete:O,onEdit:$,onAddClick:V,onRowClick:c=>r(`/production/delivery-note-detail/detail/${c.id}`),roleAccess:["ADMIN","OWNER","ADMIN PRODUKSI"]}),a&&u&&e.jsx(ne,{show:a,title:"Delete Surat Jalan",itemName:u.noSJ,onConfirm:F,onClose:()=>{h(!1),o(null)}}),m&&u&&e.jsx(le,{show:m,title:"Edit Surat Jalan",fields:[{name:"noSJ",label:"No. SJ",type:"text",required:!0,icon:"document"},{name:"tanggal",label:"Tanggal",type:"date",required:!0,icon:"calendar"},{name:"jenis",label:"Jenis",type:"select",required:!0,options:v.map(c=>({value:c.id,label:c.name})),icon:"cog"},{name:"vendor",label:"Vendor",type:"select",required:!0,options:s.map(c=>({value:c.id,label:c.name})),icon:"user"},{name:"tujuan",label:"Tujuan",type:"text",required:!0,icon:"map"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"PENDING",label:"Pending"},{value:"APPROVED",label:"Approved"},{value:"REJECTED",label:"Rejected"}],icon:"check-circle"},{name:"notes",label:"Notes",type:"textarea",required:!1,icon:"comment"}],initialData:u,onSave:z,onClose:()=>{t(!1),o(null)}}),x&&e.jsx(re,{show:x,title:"Add Surat Jalan",fields:[{name:"jenis",label:"Jenis",type:"select",required:!0,options:v.map(c=>({value:c.id,label:c.name})),icon:"cog",onChange:H},{name:"noSJ",label:"No. SJ",type:"text",required:!0,icon:"document"},{name:"tanggal",label:"Tanggal",type:"date",required:!0,icon:"calendar"},{name:"vendor",label:"Vendor",type:"select",required:!0,options:s.map(c=>({value:c.id,label:c.name})),icon:"user"},{name:"tujuan",label:"Tujuan",type:"text",required:!0,icon:"map"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"PENDING",label:"Pending"},{value:"APPROVED",label:"Approved"},{value:"REJECTED",label:"Rejected"}],icon:"check-circle"},{name:"notes",label:"Notes",type:"textarea",required:!1,icon:"comment"}],onSubmit:W,onClose:()=>d(!1)})]})},pe=()=>{const[r,a]=p.useState({delivery_note_no:"",delivery_note_date:"",delivery_note_type:"SURAT JALAN PERMINTAAN KAIN",vendor_id:"",destination:"",status:"PENDING",notes:"",user_id:"system"}),{deliveryNoteNo:h,refetch:m}=G(r.delivery_note_type);return p.useEffect(()=>{r.delivery_note_type&&m()},[r.delivery_note_type,m]),p.useEffect(()=>{h&&a(x=>({...x,delivery_note_no:h}))},[h]),p.useEffect(()=>{const x=new Date().toISOString().split("T")[0];a(d=>({...d,delivery_note_date:x}))},[]),{formData:r,updateFormData:x=>{a(d=>({...d,...x}))}}},ve=()=>{const{data:r}=ie(),[a,h]=p.useState([]),[m,t]=p.useState({});return p.useEffect(()=>{a.forEach(d=>{m[d]||(async()=>{try{const o=await f.get(`/spk/${d}`);o.data.success&&t(y=>({...y,[d]:o.data.data.details}))}catch(o){console.error("Error fetching SPK detail:",o)}})()})},[a,m]),{spkList:r,selectedSpks:a,spkDetails:m,toggleSpkSelection:d=>{h(u=>u.includes(d)?u.filter(o=>o!==d):[...u,d])}}},N={PERMINTAAN_KAIN:"SURAT JALAN PERMINTAAN KAIN",BUANG_BENANG_KELUAR:"SURAT JALAN BUANG BENANG KELUAR",JAHIT_KELUAR:"SURAT JALAN JAHIT KELUAR",BUANG_BENANG_MASUK:"SURAT JALAN BUANG BENANG MASUK",JAHIT_MASUK:"SURAT JALAN JAHIT MASUK",PENGIRIMAN_BARANG:"SURAT JALAN PENGIRIMAN BARANG"},I=(r,a,h)=>{const m=Array.isArray(r)?r:[];if(h===N.PERMINTAAN_KAIN){const t=m.find(x=>x.material_name==="KAIN");if(t)return{material_name:t.material_name,material_qty:t.qty_per_unit*a.qty_order}}return{material_name:"",material_qty:0}},Ne=r=>{const[a,h]=p.useState([]);return{selectedDetails:a,handleDetailSelect:(d,u,o)=>{if(o){const{material_name:y,material_qty:l}=I(d.bom,d,r),n={spk_detail_id:d.id,item_type:"PRODUCT",product_variant_id:(d==null?void 0:d.id)??"",material_id:null,qty_out:d.qty_order,qty_in:0,labor_cost:0,spk_no:u.noSpk,product_name:d.product_name,color:d.color,size:d.size,qty_order:d.qty_order,material_name:y,material_qty:l,short_material:0,qty_done:0,hpp:0,selisih:0};h(j=>[...j,n])}else h(y=>y.filter(l=>l.spk_detail_id!==d.id))},handleSelectAllDetails:(d,u,o,y)=>{if(u){const l=y.map(n=>{const{material_name:j,material_qty:i}=I(n.bom,n,r);return{spk_detail_id:n.id,item_type:"PRODUCT",product_variant_id:(n==null?void 0:n.id)??"",material_id:null,qty_out:n.qty_order,qty_in:0,labor_cost:0,spk_no:o.noSpk,product_name:n.product_name,color:n.color,size:n.size,qty_order:n.qty_order,material_name:j,material_qty:i,short_material:0,qty_done:0,hpp:0,selisih:0}});h(n=>[...n.filter(j=>!y.some(i=>i.id===j.spk_detail_id)),...l])}else h(l=>l.filter(n=>!y.some(j=>j.id===n.spk_detail_id)))},updateDetail:(d,u,o)=>{h(y=>y.map(l=>l.spk_detail_id===d?{...l,[u]:o}:l))}}},_e=({formData:r,updateFormData:a})=>{const{types:h}=L(),{vendors:m}=M();return e.jsxs("div",{children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Note No *"}),e.jsx("input",{type:"text",className:"form-control",value:r.delivery_note_no,onChange:t=>a({delivery_note_no:t.target.value}),disabled:!0})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Date *"}),e.jsx("input",{type:"date",className:"form-control",value:r.delivery_note_date,onChange:t=>a({delivery_note_date:t.target.value})})]})})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Type *"}),e.jsx("select",{className:"form-select",value:r.delivery_note_type,onChange:t=>a({delivery_note_type:t.target.value}),children:h.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Vendor *"}),e.jsxs("select",{className:"form-select",value:r.vendor_id,onChange:t=>a({vendor_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Select Vendor"}),m.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Destination *"}),e.jsx("input",{type:"text",className:"form-control",value:r.destination,onChange:t=>a({destination:t.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Status *"}),e.jsxs("select",{className:"form-select",value:r.status,onChange:t=>a({status:t.target.value}),children:[e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"form-control",rows:3,value:r.notes,onChange:t=>a({notes:t.target.value})})]})]})},ge=({spkList:r,selectedSpks:a,toggleSpkSelection:h})=>{const[m,t]=p.useState(""),[x,d]=p.useState(1),u=3,o=(r==null?void 0:r.filter(n=>n.status==="approved"&&(m===""||n.noSpk.toLowerCase().includes(m.toLowerCase())||n.buyer.toLowerCase().includes(m.toLowerCase()))))||[],y=o.slice((x-1)*u,x*u),l=Math.ceil(o.length/u);return e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Select SPKs *"}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-md-6",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search SPK by number or buyer...",value:m,onChange:n=>t(n.target.value),onKeyDown:n=>{n.key==="Enter"&&d(1)}})})}),e.jsx("div",{className:"row",children:y.map(n=>e.jsx("div",{className:"col-md-6 col-lg-4 mb-3",children:e.jsx("div",{className:`card h-100 ${a.includes(n.id)?"border-primary":"border-light"}`,children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`spk-${n.id}`,checked:a.includes(n.id),disabled:n.status!=="approved",onChange:()=>h(n.id)}),e.jsx("label",{className:"form-check-label w-100",htmlFor:`spk-${n.id}`,children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("strong",{className:"text-primary",children:n.noSpk}),e.jsx("small",{className:"text-muted",children:n.buyer}),e.jsx("span",{className:`badge ${n.status==="approved"?"bg-success":n.status==="in_progress"?"bg-warning":"bg-secondary"} mt-1 align-self-start`,children:n.status.replace("_"," ").toUpperCase()})]})})]})})})},n.id))}),l>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsx("nav",{children:e.jsxs("ul",{className:"pagination",children:[e.jsx("li",{className:`page-item ${x===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>d(n=>Math.max(1,n-1)),disabled:x===1,children:"Previous"})}),Array.from({length:l},(n,j)=>j+1).map(n=>e.jsx("li",{className:`page-item ${x===n?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>d(n),children:n})},n)),e.jsx("li",{className:`page-item ${x===l?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>d(n=>Math.min(l,n+1)),disabled:x===l,children:"Next"})})]})})}),a.length>0&&e.jsx("div",{className:"mt-3",children:e.jsxs("small",{className:"text-muted",children:["Selected ",a.length," SPK",a.length>1?"s":""]})})]})},be=({selectedSpks:r,spkList:a,spkDetails:h,selectedDetails:m,deliveryNoteType:t,handleDetailSelect:x,handleSelectAllDetails:d,updateDetail:u})=>{if(r.length===0)return null;const o=()=>{const l=[e.jsx("th",{},"checkbox"),e.jsx("th",{children:"Product"},"product"),e.jsx("th",{children:"Color"},"color"),e.jsx("th",{children:"Size"},"size")];return t===N.PERMINTAAN_KAIN?l.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Nama Material"},"material_name"),e.jsx("th",{children:"Jumlah Material"},"material_qty"),e.jsx("th",{children:"Kurang Material"},"short_material")):t===N.BUANG_BENANG_KELUAR||t===N.JAHIT_KELUAR?l.push(e.jsx("th",{children:"Qty Order"},"qty_order"),e.jsx("th",{children:"Qty Out"},"qty_out")):t===N.BUANG_BENANG_MASUK||t===N.JAHIT_MASUK?l.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"Qty In"},"qty_in"),e.jsx("th",{children:"Selisih"},"selisih")):t===N.PENGIRIMAN_BARANG?l.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Qty Done"},"qty_done"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"HPP"},"hpp")):l.push(e.jsx("th",{children:"Qty Order"},"qty_order"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"Qty In"},"qty_in"),e.jsx("th",{children:"Labor Cost"},"labor_cost")),l},y=(l,n)=>{const j=m.some(s=>s.spk_detail_id===l.id),i=m.find(s=>s.spk_detail_id===l.id),v=[e.jsx("td",{onClick:s=>s.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:j,onChange:s=>x(l,n,s.target.checked)})},"checkbox"),e.jsx("td",{children:l.product_name},"product"),e.jsx("td",{children:l.color},"color"),e.jsx("td",{children:l.size},"size")];return t===N.PERMINTAAN_KAIN?v.push(e.jsx("td",{children:l.qty_order},"qty_spk"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"text",className:"form-control",value:(i==null?void 0:i.material_name)||"",readOnly:!0})},"material_name"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.material_qty)||"",readOnly:!0})},"material_qty"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.short_material)||"",onChange:s=>u(l.id,"short_material",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"short_material")):t===N.BUANG_BENANG_KELUAR||t===N.JAHIT_KELUAR?v.push(e.jsx("td",{children:l.qty_order},"qty_order"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:s=>u(l.id,"qty_out",s.target.value===""?0:parseInt(s.target.value)||0),max:l.qty_order,min:0})},"qty_out")):t===N.BUANG_BENANG_MASUK||t===N.JAHIT_MASUK?v.push(e.jsx("td",{children:l.qty_order},"qty_spk"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:s=>u(l.id,"qty_out",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_out"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_in)||"",onChange:s=>u(l.id,"qty_in",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_in"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.selisih)||"",onChange:s=>u(l.id,"selisih",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"selisih")):t===N.PENGIRIMAN_BARANG?v.push(e.jsx("td",{children:l.qty_order},"qty_spk"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_done)||"",onChange:s=>u(l.id,"qty_done",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_done"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:s=>u(l.id,"qty_out",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_out"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.hpp)||"",onChange:s=>u(l.id,"hpp",s.target.value===""?0:parseFloat(s.target.value)||0),min:0,step:"0.01"})},"hpp")):v.push(e.jsx("td",{children:l.qty_order},"qty_order"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:s=>u(l.id,"qty_out",s.target.value===""?0:parseInt(s.target.value)||0),max:l.qty_order,min:0})},"qty_out"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_in)||"",onChange:s=>u(l.id,"qty_in",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_in"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:j&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.labor_cost)||"",onChange:s=>u(l.id,"labor_cost",s.target.value===""?0:parseFloat(s.target.value)||0),min:0,step:"0.01"})},"labor_cost")),v};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Select SPK Details"}),r.map(l=>{const n=a==null?void 0:a.find(s=>s.id===l),j=h[l]||[],i=j.length>0&&j.every(s=>m.some(g=>g.spk_detail_id===s.id)),v=j.some(s=>m.some(g=>g.spk_detail_id===s.id));return e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{children:[n==null?void 0:n.noSpk," - ",n==null?void 0:n.buyer]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("input",{type:"checkbox",checked:i,ref:s=>{s&&(s.indeterminate=v&&!i)},onChange:s=>d(l,s.target.checked,n,j)})}),o().slice(1)]})}),e.jsx("tbody",{children:j.map(s=>{const g=m.some(P=>P.spk_detail_id===s.id);return e.jsx("tr",{className:`cursor-pointer ${g?"table-active":""}`,onClick:()=>x(s,n,!g),children:y(s,n)},s.id)})})]})})]},l)})]})},fe=()=>{const r=R(),{addDeliveryNote:a}=U(),{currentUser:h}=ee(),{formData:m,updateFormData:t}=pe(),{spkList:x,selectedSpks:d,spkDetails:u,toggleSpkSelection:o}=ve(),{selectedDetails:y,handleDetailSelect:l,handleSelectAllDetails:n,updateDetail:j}=Ne(m.delivery_note_type),i=()=>{if(!m.delivery_note_no||!m.delivery_note_date||!m.vendor_id||!m.destination){alert("Please fill all required fields");return}if(y.length===0){alert("Please select at least one SPK detail");return}if(h){const v={...m,user_id:h==null?void 0:h.full_name,details:y.map(s=>({spk_detail_id:s.spk_detail_id,item_type:s.item_type,product_variant_id:s.product_variant_id,material_id:s.material_id,qty_out:s.qty_out,qty_in:s.qty_in,labor_cost:s.labor_cost,material_name:s.material_name,material_qty:s.material_qty,short_material:s.short_material,qty_done:s.qty_done,hpp:s.hpp,selisih:s.selisih}))};console.log(v),a(v),r("/production/surat-jalan")}};return e.jsx("div",{className:"container-fluid",children:e.jsxs(se,{children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Add Surat Jalan"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(_e,{formData:m,updateFormData:t}),e.jsx(ge,{spkList:x,selectedSpks:d,toggleSpkSelection:o}),e.jsx(be,{selectedSpks:d,spkList:x,spkDetails:u,selectedDetails:y,deliveryNoteType:m.delivery_note_type,handleDetailSelect:l,handleSelectAllDetails:n,updateDetail:j}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:i,children:"Save Surat Jalan"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>r("/production/surat-jalan"),children:"Cancel"})]})]})]})})},Se=({deliveryNoteId:r})=>{console.log(r);const{deliveryNote:a,isLoading:h,error:m}=je(r||"");return r?h?e.jsx(q,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):m?e.jsx(q,{children:e.jsxs("div",{className:"alert alert-danger",children:["Error loading delivery note: ",m.message]})}):a?e.jsxs(q,{children:[e.jsxs("div",{className:"card mb-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"card-title",children:e.jsxs("h3",{className:"card-label",children:["Delivery Note #",a.delivery_note_no]})})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Delivery Note No:"})," ",a.delivery_note_no]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Delivery Date:"})," ",a.delivery_note_date]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Type:"})," ",a.delivery_note_type]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Vendor:"})," ",a.vendor.name]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Destination:"})," ",a.destination]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(S,{status:a.status.toLowerCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Notes:"})," ",a.notes||"-"]})]})]})})]}),e.jsxs("div",{className:"card mb-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Vendor Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Name:"})," ",a.vendor.name]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Contact Person:"})," ",a.vendor.contact_person]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Phone:"})," ",a.vendor.phone]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Email:"})," ",a.vendor.email]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Address:"})," ",a.vendor.address]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"City:"})," ",a.vendor.city,", ",a.vendor.province,", ",a.vendor.country]})]})]})})]}),a.details&&a.details.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Delivery Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-block d-md-none",children:["// eslint-disable-next-line @typescript-eslint/no-explicit-any",a.details.map((t,x)=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h6",{className:"card-title mb-2",children:["Detail #",x+1]}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Item Type"}),e.jsx("div",{children:t.item_type})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Out"}),e.jsx("div",{children:t.qty_out})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty In"}),e.jsx("div",{children:t.qty_in})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted",children:"HPP"}),e.jsxs("div",{children:["Rp ",t.labor_cost.toLocaleString()]})]})]})]})},t.id||x))]}),e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-125px",children:"SPK Detail ID"}),e.jsx("th",{className:"min-w-100px",children:"Item Type"}),e.jsx("th",{className:"min-w-100px",children:"Product Variant ID"}),e.jsx("th",{className:"min-w-100px",children:"Material ID"}),e.jsx("th",{className:"min-w-80px",children:"Qty Out"}),e.jsx("th",{className:"min-w-80px",children:"Qty In"}),e.jsx("th",{className:"min-w-100px",children:"Labor Cost"}),e.jsx("th",{className:"min-w-100px",children:"Status"})]})}),e.jsx("tbody",{className:"text-gray-600 fw-semibold",children:a.details.map((t,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.spk_detail_id}),e.jsx("td",{children:t.item_type}),e.jsx("td",{children:t.product_variant_id||"-"}),e.jsx("td",{children:t.material_id||"-"}),e.jsx("td",{children:t.qty_out}),e.jsx("td",{children:t.qty_in}),e.jsxs("td",{children:["Rp ",t.labor_cost.toLocaleString()]}),e.jsx("td",{children:t.status?e.jsx(S,{status:t.status.toLowerCase()}):"-"})]},t.id||x))})]})})})]})]}),a.spk&&a.spk.length>0&&e.jsxs("div",{className:"card mt-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Related SPK Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"SPK No:"})," ",a.spk[0].spk_no]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Buyer:"})," ",a.spk[0].buyer]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"SPK Date:"})," ",a.spk[0].spk_date]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Deadline:"})," ",a.spk[0].deadline]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(S,{status:a.spk[0].status.toLowerCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Notes:"})," ",a.spk[0].notes||"-"]})]})]})})]}),a.spk_details&&a.spk_details.length>0&&e.jsxs("div",{className:"card mt-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"SPK Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"d-block d-md-none",children:a.spk_details.map(t=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title mb-2",children:t.product_variants.product_name}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Size"}),e.jsx("div",{children:t.product_variants.size})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Color"}),e.jsx("div",{children:t.product_variants.color})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Order"}),e.jsx("div",{children:t.qty_order})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Done"}),e.jsx("div",{children:t.qty_done})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Reject"}),e.jsx("div",{children:t.qty_reject})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Progress"}),e.jsxs("div",{children:[t.progress,"%"]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted",children:"Status"}),e.jsx(S,{status:t.status.toLowerCase()})]})]})]})},t.id))}),e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-200px",children:"Product"}),e.jsx("th",{className:"min-w-80px",children:"Size"}),e.jsx("th",{className:"min-w-80px",children:"Color"}),e.jsx("th",{className:"min-w-80px",children:"Qty Order"}),e.jsx("th",{className:"min-w-80px",children:"Qty Done"}),e.jsx("th",{className:"min-w-80px",children:"Qty Reject"}),e.jsx("th",{className:"min-w-80px",children:"Progress"}),e.jsx("th",{className:"min-w-100px",children:"Status"})]})}),e.jsx("tbody",{className:"text-gray-600 fw-semibold",children:a.spk_details.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.product_variants.product_name}),e.jsx("td",{children:t.product_variants.size}),e.jsx("td",{children:t.product_variants.color}),e.jsx("td",{children:t.qty_order}),e.jsx("td",{children:t.qty_done}),e.jsx("td",{children:t.qty_reject}),e.jsxs("td",{children:[t.progress,"%"]}),e.jsx("td",{children:e.jsx(S,{status:t.status.toLowerCase()})})]},t.id))})]})})})]})]})]}):e.jsx(q,{children:e.jsx("div",{className:"alert alert-warning",children:"Delivery note not found."})}):e.jsx(q,{children:e.jsx("div",{className:"alert alert-warning",children:"Delivery note ID is required."})})},Ae=[{title:"Surat Jalan",path:"/production/surat-jalan",isSeparator:!1,isActive:!1}],qe=()=>{const{id:r}=te();return e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:Ae,children:"Delivery Note Detail"}),e.jsx(Se,{deliveryNoteId:r})]})},Ce=()=>e.jsx(K,{children:e.jsxs(b,{element:e.jsx(e.Fragment,{children:e.jsx(T,{})}),children:[e.jsx(b,{path:"detail/:id",element:e.jsx(qe,{})}),e.jsx(b,{index:!0,element:e.jsx(J,{to:"/production/surat-jalan"})})]})}),D=[{title:"Produksi > ",path:"/production/",isSeparator:!1,isActive:!1}],Le=()=>e.jsx(K,{children:e.jsxs(b,{element:e.jsx(T,{}),children:[e.jsx(b,{path:"surat-jalan",element:e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:D,children:"Surat Jalan"}),e.jsx(ye,{})]})}),e.jsx(b,{path:"add-surat-jalan",element:e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:D,children:"Add Surat Jalan"}),e.jsx(fe,{})]})}),e.jsx(b,{path:"delivery-note-detail/*",element:e.jsx(Ce,{})}),e.jsx(b,{index:!0,element:e.jsx(J,{to:"/production/dashboard"})})]})});export{Le as default};
