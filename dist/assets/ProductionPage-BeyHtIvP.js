import{a0 as f,Z,X as C,a1 as k,_,a2 as K,r as y,j as e,a3 as ee,$ as se,C as q,g as J,i as b,N as R,O as M,a4 as te,k as E}from"./index-SJ6CaKPn.js";import{T as ae}from"./TablesWidget13-CDtcnNGt.js";import{D as re,a as ne}from"./DynamicDeleteModal-D55r71gl.js";import{D as le}from"./DynamicEditModal-BkF9yRbb.js";import{u as w}from"./useMutation-DXbLPUgV.js";import{u as T}from"./useVendors-5yUAd3rV.js";import{S}from"./StatusBadge-CDeSiPwu.js";import{u as ie}from"./useSpkList-vp94EXPf.js";import"./ThemeProvider-DByzDFN4.js";import"./Modal-Dajr1G0h.js";import"./hasClass-DxMhqE8O.js";import"./warning-YOQHYAjv.js";const oe=async()=>(await f.get("/delivery-note/type")).data.data,ce=async l=>{const t=await f.get("/delivery-note",{params:l});return{data:t.data.data,meta:t.data.meta}},de=async l=>(await f.get(`/delivery-note/${l}`)).data.data,me=async l=>{const t=l?{type:l}:{};return(await f.get("/delivery-note/generate-no",{params:t})).data.data.delivery_note_no},he=async l=>(await f.post("/delivery-note",l)).data.data,ue=async l=>(await f.put("/delivery-note",l)).data.data,xe=async l=>{await f.post("/delivery-note/approval",l)},L=l=>{var m,h;const t=Z(),u=C({queryKey:["delivery-notes",l],queryFn:()=>ce(l)}),d=w({mutationFn:o=>he(o),onSuccess:o=>{console.log("Add delivery note success:",o),t.invalidateQueries({queryKey:["delivery-notes"]}),_.success("Delivery note added successfully")},onError:o=>{var r;const j=o instanceof k?(r=o.response)==null?void 0:r.data.message:`Gagal Menambah Surat Jalan: ${o.message}`;Array.isArray(j)?j.forEach(n=>_.error(n)):_.error(j)}}),a=w({mutationFn:o=>ue(o),onSuccess:o=>{console.log("Update delivery note success:",o),t.invalidateQueries({queryKey:["delivery-notes"]}),_.success("Delivery note updated successfully")},onError:o=>{var r;const j=o instanceof k?(r=o.response)==null?void 0:r.data.message:`Gagal Mengubah Surat Jalan: ${o.message}`;Array.isArray(j)?j.forEach(n=>_.error(n)):_.error(j)}}),p=w({mutationFn:o=>xe(o),onSuccess:()=>{console.log("Approve delivery note success"),t.invalidateQueries({queryKey:["delivery-notes"]}),_.success("Delivery note approved successfully")},onError:o=>{var r;const j=o instanceof k?(r=o.response)==null?void 0:r.data.message:`Gagal Approve: ${o.message}`;Array.isArray(j)?j.forEach(n=>_.error(n)):_.error(j)}});return{deliveryNotes:((m=u.data)==null?void 0:m.data)||[],meta:(h=u.data)==null?void 0:h.meta,isLoading:u.isLoading,error:u.error,addDeliveryNote:d.mutate,updateDeliveryNote:a.mutate,approveDeliveryNote:p.mutate,isAdding:d.isPending,isUpdating:a.isPending,isApproving:p.isPending}},je=l=>{const t=C({queryKey:["delivery-note",l],queryFn:()=>de(l),enabled:!!l});return{deliveryNote:t.data,isLoading:t.isLoading,error:t.error}},U=()=>{const l=C({queryKey:["delivery-note-types"],queryFn:oe});return{types:l.data||[],isLoading:l.isLoading,error:l.error}},G=l=>{const t=C({queryKey:["generate-delivery-note-no",l],queryFn:()=>me(l),enabled:!!l});return{deliveryNoteNo:t.data,isLoading:t.isLoading,error:t.error,refetch:t.refetch}},pe=()=>{const l=K(),[t,u]=y.useState(!1),[d,a]=y.useState(!1),[p,m]=y.useState(!1),[h,o]=y.useState(null),[j,r]=y.useState(""),{deliveryNotes:n,addDeliveryNote:x,updateDeliveryNote:i}=L(),{types:v}=U(),{vendors:s}=T(),{deliveryNoteNo:g,refetch:P}=G(j),Q=[{key:"noSJ",label:"No. SJ",className:"min-w-120px"},{key:"tanggal",label:"Tanggal",className:"min-w-100px"},{key:"jenis",label:"Jenis",className:"min-w-100px"},{key:"vendor",label:"Vendor",className:"min-w-125px"},{key:"tujuan",label:"Tujuan",className:"min-w-125px"},{key:"status",label:"Status",className:"min-w-100px"},{key:"createdBy",label:"Created By",className:"min-w-125px"}],B=n.map(c=>({id:c.id,noSJ:c.delivery_note_no,tanggal:c.delivery_note_date,jenis:c.delivery_note_type,vendor:c.vendor.name,tujuan:c.destination,status:e.jsx(S,{status:c.status.toLowerCase()}),createdBy:"System"})),O=c=>{o(c),u(!0)},F=()=>{console.log("Deleting:",h),u(!1)},$=c=>{o(c),a(!0)},z=c=>{const A=s.find(X=>X.name===c.vendor),Y={id:c.id,delivery_note_no:c.noSJ,delivery_note_date:c.tanggal,delivery_note_type:c.jenis,vendor_id:(A==null?void 0:A.id)||"",destination:c.tujuan,status:c.status,notes:c.notes||"",user_id:"system",details:[]};i(Y),a(!1),o(null)},V=()=>{l("/production/add-surat-jalan")},H=c=>{r(c),P()},W=c=>{const A={delivery_note_no:g||c.noSJ,delivery_note_date:c.tanggal,delivery_note_type:c.jenis,vendor_id:c.vendor,destination:c.tujuan,status:c.status,notes:c.notes||"",user_id:"system",details:[]};x(A),m(!1),r("")};return e.jsxs("div",{children:[e.jsx(ae,{className:"card-xl-stretch",rows:B,columns:Q,labelAdd:"Surat Jalan",filters:[{key:"jenis",label:"Filter by Jenis"},{key:"vendor",label:"Filter by Vendor"},{key:"status",label:"Filter by Status"}],onDelete:O,onEdit:$,onAddClick:V,onRowClick:c=>l(`/production/delivery-note-detail/detail/${c.id}`)}),t&&h&&e.jsx(re,{show:t,title:"Delete Surat Jalan",itemName:h.noSJ,onConfirm:F,onClose:()=>{u(!1),o(null)}}),d&&h&&e.jsx(le,{show:d,title:"Edit Surat Jalan",fields:[{name:"noSJ",label:"No. SJ",type:"text",required:!0,icon:"document"},{name:"tanggal",label:"Tanggal",type:"date",required:!0,icon:"calendar"},{name:"jenis",label:"Jenis",type:"select",required:!0,options:v.map(c=>({value:c.id,label:c.name})),icon:"cog"},{name:"vendor",label:"Vendor",type:"select",required:!0,options:s.map(c=>({value:c.id,label:c.name})),icon:"user"},{name:"tujuan",label:"Tujuan",type:"text",required:!0,icon:"map"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"PENDING",label:"Pending"},{value:"APPROVED",label:"Approved"},{value:"REJECTED",label:"Rejected"}],icon:"check-circle"},{name:"notes",label:"Notes",type:"textarea",required:!1,icon:"comment"}],initialData:h,onSave:z,onClose:()=>{a(!1),o(null)}}),p&&e.jsx(ne,{show:p,title:"Add Surat Jalan",fields:[{name:"jenis",label:"Jenis",type:"select",required:!0,options:v.map(c=>({value:c.id,label:c.name})),icon:"cog",onChange:H},{name:"noSJ",label:"No. SJ",type:"text",required:!0,icon:"document"},{name:"tanggal",label:"Tanggal",type:"date",required:!0,icon:"calendar"},{name:"vendor",label:"Vendor",type:"select",required:!0,options:s.map(c=>({value:c.id,label:c.name})),icon:"user"},{name:"tujuan",label:"Tujuan",type:"text",required:!0,icon:"map"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"PENDING",label:"Pending"},{value:"APPROVED",label:"Approved"},{value:"REJECTED",label:"Rejected"}],icon:"check-circle"},{name:"notes",label:"Notes",type:"textarea",required:!1,icon:"comment"}],onSubmit:W,onClose:()=>m(!1)})]})},ye=()=>{const[l,t]=y.useState({delivery_note_no:"",delivery_note_date:"",delivery_note_type:"SURAT JALAN PERMINTAAN KAIN",vendor_id:"",destination:"",status:"PENDING",notes:"",user_id:"system"}),{deliveryNoteNo:u,refetch:d}=G(l.delivery_note_type);return y.useEffect(()=>{l.delivery_note_type&&d()},[l.delivery_note_type,d]),y.useEffect(()=>{u&&t(p=>({...p,delivery_note_no:u}))},[u]),y.useEffect(()=>{const p=new Date().toISOString().split("T")[0];t(m=>({...m,delivery_note_date:p}))},[]),{formData:l,updateFormData:p=>{t(m=>({...m,...p}))}}},ve=()=>{const{data:l}=ie(),[t,u]=y.useState([]),[d,a]=y.useState({});return y.useEffect(()=>{t.forEach(m=>{d[m]||(async()=>{try{const o=await f.get(`/spk/${m}`);o.data.success&&a(j=>({...j,[m]:o.data.data.details}))}catch(o){console.error("Error fetching SPK detail:",o)}})()})},[t,d]),{spkList:l,selectedSpks:t,spkDetails:d,toggleSpkSelection:m=>{u(h=>h.includes(m)?h.filter(o=>o!==m):[...h,m])}}},N={PERMINTAAN_KAIN:"SURAT JALAN PERMINTAAN KAIN",BUANG_BENANG_KELUAR:"SURAT JALAN BUANG BENANG KELUAR",JAHIT_KELUAR:"SURAT JALAN JAHIT KELUAR",BUANG_BENANG_MASUK:"SURAT JALAN BUANG BENANG MASUK",JAHIT_MASUK:"SURAT JALAN JAHIT MASUK",PENGIRIMAN_BARANG:"SURAT JALAN PENGIRIMAN BARANG"},D=(l,t,u)=>{if(u===N.PERMINTAAN_KAIN){const d=l.find(a=>a.material_name==="KAIN");if(d)return{material_name:d.material_name,material_qty:d.qty_per_unit*t.qty_order}}return{material_name:"",material_qty:0}},Ne=l=>{const[t,u]=y.useState([]);return{selectedDetails:t,handleDetailSelect:(m,h,o)=>{if(o){const{material_name:j,material_qty:r}=D(m.bom,m,l),n={spk_detail_id:m.id,item_type:"PRODUCT",product_variant_id:m.product_variants.id,material_id:null,qty_out:m.qty_order,qty_in:0,labor_cost:0,spk_no:h.noSpk,product_name:m.product_variants.product_name,color:m.product_variants.color,size:m.product_variants.size,qty_order:m.qty_order,material_name:j,material_qty:r,short_material:0,qty_done:0,hpp:0,selisih:0};u(x=>[...x,n])}else u(j=>j.filter(r=>r.spk_detail_id!==m.id))},handleSelectAllDetails:(m,h,o,j)=>{if(h){const r=j.map(n=>{const{material_name:x,material_qty:i}=D(n.bom,n,l);return{spk_detail_id:n.id,item_type:"PRODUCT",product_variant_id:n.product_variants.id,material_id:null,qty_out:n.qty_order,qty_in:0,labor_cost:0,spk_no:o.noSpk,product_name:n.product_variants.product_name,color:n.product_variants.color,size:n.product_variants.size,qty_order:n.qty_order,material_name:x,material_qty:i,short_material:0,qty_done:0,hpp:0,selisih:0}});u(n=>[...n.filter(x=>!j.some(i=>i.id===x.spk_detail_id)),...r])}else u(r=>r.filter(n=>!j.some(x=>x.id===n.spk_detail_id)))},updateDetail:(m,h,o)=>{u(j=>j.map(r=>r.spk_detail_id===m?{...r,[h]:o}:r))}}},_e=({formData:l,updateFormData:t})=>{const{types:u}=U(),{vendors:d}=T();return e.jsxs("div",{children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Note No *"}),e.jsx("input",{type:"text",className:"form-control",value:l.delivery_note_no,onChange:a=>t({delivery_note_no:a.target.value}),disabled:!0})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Date *"}),e.jsx("input",{type:"date",className:"form-control",value:l.delivery_note_date,onChange:a=>t({delivery_note_date:a.target.value})})]})})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Type *"}),e.jsx("select",{className:"form-select",value:l.delivery_note_type,onChange:a=>t({delivery_note_type:a.target.value}),children:u.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Vendor *"}),e.jsxs("select",{className:"form-select",value:l.vendor_id,onChange:a=>t({vendor_id:a.target.value}),children:[e.jsx("option",{value:"",children:"Select Vendor"}),d.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Destination *"}),e.jsx("input",{type:"text",className:"form-control",value:l.destination,onChange:a=>t({destination:a.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Status *"}),e.jsxs("select",{className:"form-select",value:l.status,onChange:a=>t({status:a.target.value}),children:[e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"form-control",rows:3,value:l.notes,onChange:a=>t({notes:a.target.value})})]})]})},ge=({spkList:l,selectedSpks:t,toggleSpkSelection:u})=>{const[d,a]=y.useState(""),[p,m]=y.useState(1),h=3,o=(l==null?void 0:l.filter(n=>n.status==="approved"&&(d===""||n.noSpk.toLowerCase().includes(d.toLowerCase())||n.buyer.toLowerCase().includes(d.toLowerCase()))))||[],j=o.slice((p-1)*h,p*h),r=Math.ceil(o.length/h);return e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Select SPKs *"}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-md-6",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search SPK by number or buyer...",value:d,onChange:n=>a(n.target.value),onKeyDown:n=>{n.key==="Enter"&&m(1)}})})}),e.jsx("div",{className:"row",children:j.map(n=>e.jsx("div",{className:"col-md-6 col-lg-4 mb-3",children:e.jsx("div",{className:`card h-100 ${t.includes(n.id)?"border-primary":"border-light"}`,children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`spk-${n.id}`,checked:t.includes(n.id),disabled:n.status!=="approved",onChange:()=>u(n.id)}),e.jsx("label",{className:"form-check-label w-100",htmlFor:`spk-${n.id}`,children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("strong",{className:"text-primary",children:n.noSpk}),e.jsx("small",{className:"text-muted",children:n.buyer}),e.jsx("span",{className:`badge ${n.status==="approved"?"bg-success":n.status==="in_progress"?"bg-warning":"bg-secondary"} mt-1 align-self-start`,children:n.status.replace("_"," ").toUpperCase()})]})})]})})})},n.id))}),r>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsx("nav",{children:e.jsxs("ul",{className:"pagination",children:[e.jsx("li",{className:`page-item ${p===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>m(n=>Math.max(1,n-1)),disabled:p===1,children:"Previous"})}),Array.from({length:r},(n,x)=>x+1).map(n=>e.jsx("li",{className:`page-item ${p===n?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>m(n),children:n})},n)),e.jsx("li",{className:`page-item ${p===r?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>m(n=>Math.min(r,n+1)),disabled:p===r,children:"Next"})})]})})}),t.length>0&&e.jsx("div",{className:"mt-3",children:e.jsxs("small",{className:"text-muted",children:["Selected ",t.length," SPK",t.length>1?"s":""]})})]})},be=({selectedSpks:l,spkList:t,spkDetails:u,selectedDetails:d,deliveryNoteType:a,handleDetailSelect:p,handleSelectAllDetails:m,updateDetail:h})=>{if(l.length===0)return null;const o=()=>{const r=[e.jsx("th",{},"checkbox"),e.jsx("th",{children:"Product"},"product"),e.jsx("th",{children:"Color"},"color"),e.jsx("th",{children:"Size"},"size")];return a===N.PERMINTAAN_KAIN?r.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Nama Material"},"material_name"),e.jsx("th",{children:"Jumlah Material"},"material_qty"),e.jsx("th",{children:"Kurang Material"},"short_material")):a===N.BUANG_BENANG_KELUAR||a===N.JAHIT_KELUAR?r.push(e.jsx("th",{children:"Qty Order"},"qty_order"),e.jsx("th",{children:"Qty Out"},"qty_out")):a===N.BUANG_BENANG_MASUK||a===N.JAHIT_MASUK?r.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"Qty In"},"qty_in"),e.jsx("th",{children:"Selisih"},"selisih")):a===N.PENGIRIMAN_BARANG?r.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Qty Done"},"qty_done"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"HPP"},"hpp")):r.push(e.jsx("th",{children:"Qty Order"},"qty_order"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"Qty In"},"qty_in"),e.jsx("th",{children:"Labor Cost"},"labor_cost")),r},j=(r,n)=>{const x=d.some(s=>s.spk_detail_id===r.id),i=d.find(s=>s.spk_detail_id===r.id),v=[e.jsx("td",{onClick:s=>s.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:x,onChange:s=>p(r,n,s.target.checked)})},"checkbox"),e.jsx("td",{children:r.product_variants.product_name},"product"),e.jsx("td",{children:r.product_variants.color},"color"),e.jsx("td",{children:r.product_variants.size},"size")];return a===N.PERMINTAAN_KAIN?v.push(e.jsx("td",{children:r.qty_order},"qty_spk"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"text",className:"form-control",value:(i==null?void 0:i.material_name)||"",readOnly:!0})},"material_name"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.material_qty)||"",readOnly:!0})},"material_qty"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.short_material)||"",onChange:s=>h(r.id,"short_material",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"short_material")):a===N.BUANG_BENANG_KELUAR||a===N.JAHIT_KELUAR?v.push(e.jsx("td",{children:r.qty_order},"qty_order"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:s=>h(r.id,"qty_out",s.target.value===""?0:parseInt(s.target.value)||0),max:r.qty_order,min:0})},"qty_out")):a===N.BUANG_BENANG_MASUK||a===N.JAHIT_MASUK?v.push(e.jsx("td",{children:r.qty_order},"qty_spk"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:s=>h(r.id,"qty_out",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_out"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_in)||"",onChange:s=>h(r.id,"qty_in",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_in"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.selisih)||"",onChange:s=>h(r.id,"selisih",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"selisih")):a===N.PENGIRIMAN_BARANG?v.push(e.jsx("td",{children:r.qty_order},"qty_spk"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_done)||"",onChange:s=>h(r.id,"qty_done",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_done"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:s=>h(r.id,"qty_out",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_out"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.hpp)||"",onChange:s=>h(r.id,"hpp",s.target.value===""?0:parseFloat(s.target.value)||0),min:0,step:"0.01"})},"hpp")):v.push(e.jsx("td",{children:r.qty_order},"qty_order"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_out)||"",onChange:s=>h(r.id,"qty_out",s.target.value===""?0:parseInt(s.target.value)||0),max:r.qty_order,min:0})},"qty_out"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.qty_in)||"",onChange:s=>h(r.id,"qty_in",s.target.value===""?0:parseInt(s.target.value)||0),min:0})},"qty_in"),e.jsx("td",{onClick:s=>s.stopPropagation(),children:x&&e.jsx("input",{type:"number",className:"form-control",value:(i==null?void 0:i.labor_cost)||"",onChange:s=>h(r.id,"labor_cost",s.target.value===""?0:parseFloat(s.target.value)||0),min:0,step:"0.01"})},"labor_cost")),v};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Select SPK Details"}),l.map(r=>{const n=t==null?void 0:t.find(s=>s.id===r),x=u[r]||[],i=x.length>0&&x.every(s=>d.some(g=>g.spk_detail_id===s.id)),v=x.some(s=>d.some(g=>g.spk_detail_id===s.id));return e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{children:[n==null?void 0:n.noSpk," - ",n==null?void 0:n.buyer]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("input",{type:"checkbox",checked:i,ref:s=>{s&&(s.indeterminate=v&&!i)},onChange:s=>m(r,s.target.checked,n,x)})}),o().slice(1)," "]})}),e.jsx("tbody",{children:x.map(s=>{const g=d.some(P=>P.spk_detail_id===s.id);return e.jsx("tr",{className:`cursor-pointer ${g?"table-active":""}`,onClick:()=>p(s,n,!g),children:j(s,n)},s.id)})})]})})]},r)})]})},fe=()=>{const l=K(),{addDeliveryNote:t}=L(),{currentUser:u}=ee(),{formData:d,updateFormData:a}=ye(),{spkList:p,selectedSpks:m,spkDetails:h,toggleSpkSelection:o}=ve(),{selectedDetails:j,handleDetailSelect:r,handleSelectAllDetails:n,updateDetail:x}=Ne(d.delivery_note_type),i=()=>{if(!d.delivery_note_no||!d.delivery_note_date||!d.vendor_id||!d.destination){alert("Please fill all required fields");return}if(j.length===0){alert("Please select at least one SPK detail");return}if(u){const v={...d,user_id:u==null?void 0:u.full_name,details:j.map(s=>({spk_detail_id:s.spk_detail_id,item_type:s.item_type,product_variant_id:s.product_variant_id,material_id:s.material_id,qty_out:s.qty_out,qty_in:s.qty_in,labor_cost:s.labor_cost,material_name:s.material_name,material_qty:s.material_qty,short_material:s.short_material,qty_done:s.qty_done,hpp:s.hpp,selisih:s.selisih}))};console.log(v),t(v),l("/production/surat-jalan")}};return e.jsx("div",{className:"container-fluid",children:e.jsxs(se,{children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Add Surat Jalan"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(_e,{formData:d,updateFormData:a}),e.jsx(ge,{spkList:p,selectedSpks:m,toggleSpkSelection:o}),e.jsx(be,{selectedSpks:m,spkList:p,spkDetails:h,selectedDetails:j,deliveryNoteType:d.delivery_note_type,handleDetailSelect:r,handleSelectAllDetails:n,updateDetail:x}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:i,children:"Save Surat Jalan"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>l("/production/surat-jalan"),children:"Cancel"})]})]})]})})},Se=({deliveryNoteId:l})=>{console.log(l);const{deliveryNote:t,isLoading:u,error:d}=je(l||"");return l?u?e.jsx(q,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):d?e.jsx(q,{children:e.jsxs("div",{className:"alert alert-danger",children:["Error loading delivery note: ",d.message]})}):t?e.jsxs(q,{children:[e.jsxs("div",{className:"card mb-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"card-title",children:e.jsxs("h3",{className:"card-label",children:["Delivery Note #",t.delivery_note_no]})})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Delivery Note No:"})," ",t.delivery_note_no]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Delivery Date:"})," ",t.delivery_note_date]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Type:"})," ",t.delivery_note_type]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Vendor:"})," ",t.vendor.name]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Destination:"})," ",t.destination]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(S,{status:t.status.toLowerCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Notes:"})," ",t.notes||"-"]})]})]})})]}),e.jsxs("div",{className:"card mb-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Vendor Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Name:"})," ",t.vendor.name]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Contact Person:"})," ",t.vendor.contact_person]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Phone:"})," ",t.vendor.phone]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Email:"})," ",t.vendor.email]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Address:"})," ",t.vendor.address]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"City:"})," ",t.vendor.city,", ",t.vendor.province,", ",t.vendor.country]})]})]})})]}),t.details&&t.details.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Delivery Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-block d-md-none",children:["// eslint-disable-next-line @typescript-eslint/no-explicit-any",t.details.map((a,p)=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h6",{className:"card-title mb-2",children:["Detail #",p+1]}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Item Type"}),e.jsx("div",{children:a.item_type})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Out"}),e.jsx("div",{children:a.qty_out})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty In"}),e.jsx("div",{children:a.qty_in})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted",children:"HPP"}),e.jsxs("div",{children:["Rp ",a.labor_cost.toLocaleString()]})]})]})]})},a.id||p))]}),e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-125px",children:"SPK Detail ID"}),e.jsx("th",{className:"min-w-100px",children:"Item Type"}),e.jsx("th",{className:"min-w-100px",children:"Product Variant ID"}),e.jsx("th",{className:"min-w-100px",children:"Material ID"}),e.jsx("th",{className:"min-w-80px",children:"Qty Out"}),e.jsx("th",{className:"min-w-80px",children:"Qty In"}),e.jsx("th",{className:"min-w-100px",children:"Labor Cost"}),e.jsx("th",{className:"min-w-100px",children:"Status"})]})}),e.jsx("tbody",{className:"text-gray-600 fw-semibold",children:t.details.map((a,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:a.spk_detail_id}),e.jsx("td",{children:a.item_type}),e.jsx("td",{children:a.product_variant_id||"-"}),e.jsx("td",{children:a.material_id||"-"}),e.jsx("td",{children:a.qty_out}),e.jsx("td",{children:a.qty_in}),e.jsxs("td",{children:["Rp ",a.labor_cost.toLocaleString()]}),e.jsx("td",{children:a.status?e.jsx(S,{status:a.status.toLowerCase()}):"-"})]},a.id||p))})]})})})]})]}),t.spk&&t.spk.length>0&&e.jsxs("div",{className:"card mt-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Related SPK Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"SPK No:"})," ",t.spk[0].spk_no]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Buyer:"})," ",t.spk[0].buyer]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"SPK Date:"})," ",t.spk[0].spk_date]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Deadline:"})," ",t.spk[0].deadline]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(S,{status:t.spk[0].status.toLowerCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Notes:"})," ",t.spk[0].notes||"-"]})]})]})})]}),t.spk_details&&t.spk_details.length>0&&e.jsxs("div",{className:"card mt-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"SPK Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"d-block d-md-none",children:t.spk_details.map(a=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title mb-2",children:a.product_variants.product_name}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Size"}),e.jsx("div",{children:a.product_variants.size})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Color"}),e.jsx("div",{children:a.product_variants.color})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Order"}),e.jsx("div",{children:a.qty_order})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Done"}),e.jsx("div",{children:a.qty_done})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Reject"}),e.jsx("div",{children:a.qty_reject})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Progress"}),e.jsxs("div",{children:[a.progress,"%"]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted",children:"Status"}),e.jsx(S,{status:a.status.toLowerCase()})]})]})]})},a.id))}),e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-200px",children:"Product"}),e.jsx("th",{className:"min-w-80px",children:"Size"}),e.jsx("th",{className:"min-w-80px",children:"Color"}),e.jsx("th",{className:"min-w-80px",children:"Qty Order"}),e.jsx("th",{className:"min-w-80px",children:"Qty Done"}),e.jsx("th",{className:"min-w-80px",children:"Qty Reject"}),e.jsx("th",{className:"min-w-80px",children:"Progress"}),e.jsx("th",{className:"min-w-100px",children:"Status"})]})}),e.jsx("tbody",{className:"text-gray-600 fw-semibold",children:t.spk_details.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.product_variants.product_name}),e.jsx("td",{children:a.product_variants.size}),e.jsx("td",{children:a.product_variants.color}),e.jsx("td",{children:a.qty_order}),e.jsx("td",{children:a.qty_done}),e.jsx("td",{children:a.qty_reject}),e.jsxs("td",{children:[a.progress,"%"]}),e.jsx("td",{children:e.jsx(S,{status:a.status.toLowerCase()})})]},a.id))})]})})})]})]})]}):e.jsx(q,{children:e.jsx("div",{className:"alert alert-warning",children:"Delivery note not found."})}):e.jsx(q,{children:e.jsx("div",{className:"alert alert-warning",children:"Delivery note ID is required."})})},Ae=[{title:"Dashboard",path:"/dashboard",isSeparator:!1,isActive:!1},{title:"Production",path:"/production",isSeparator:!1,isActive:!1},{title:"Surat Jalan",path:"/production/surat-jalan",isSeparator:!1,isActive:!1}],qe=()=>{const{id:l}=te();return e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:Ae,children:"Delivery Note Detail"}),e.jsx(Se,{deliveryNoteId:l})]})},Ce=()=>e.jsx(J,{children:e.jsxs(b,{element:e.jsx(e.Fragment,{children:e.jsx(M,{})}),children:[e.jsx(b,{path:"detail/:id",element:e.jsx(qe,{})}),e.jsx(b,{index:!0,element:e.jsx(R,{to:"/production/surat-jalan"})})]})}),I=[{title:"Produksi > ",path:"/production/",isSeparator:!1,isActive:!1}],Ue=()=>e.jsx(J,{children:e.jsxs(b,{element:e.jsx(M,{}),children:[e.jsx(b,{path:"surat-jalan",element:e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:I,children:"Surat Jalan"}),e.jsx(pe,{})]})}),e.jsx(b,{path:"add-surat-jalan",element:e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:I,children:"Add Surat Jalan"}),e.jsx(fe,{})]})}),e.jsx(b,{path:"delivery-note-detail/*",element:e.jsx(Ce,{})}),e.jsx(b,{index:!0,element:e.jsx(R,{to:"/production/dashboard"})})]})});export{Ue as default};
