import{a0 as S,Z as X,X as C,a1 as k,_ as g,a2 as K,r as p,j as e,a3 as Z,$ as ee,C as q,g as M,i as f,N as J,O as T,a4 as se,k as E}from"./index-B3agpCGs.js";import{T as te}from"./TablesWidget13-CXq8lksz.js";import{D as ae,a as ne}from"./DynamicDeleteModal-DUoWsf9I.js";import{D as re}from"./DynamicEditModal-DkKu4hPp.js";import{u as w}from"./useMutation-nrZU9vUa.js";import{u as R}from"./useVendors-DMJXANqt.js";import{S as A}from"./StatusBadge-DnNgXIpX.js";import{u as le}from"./useSpkList-buCQxp6C.js";import"./ThemeProvider-DDvPy6_R.js";import"./Modal-BmgU_ZWM.js";import"./hasClass-m-K6Zulr.js";import"./warning-Abi01nQB.js";const ie=async()=>(await S.get("/delivery-note/type")).data.data,oe=async r=>{const a=await S.get("/delivery-note",{params:r});return{data:a.data.data,meta:a.data.meta}},de=async r=>(await S.get(`/delivery-note/${r}`)).data.data,ce=async r=>{const h=r?`/delivery-note/generate-no/${encodeURIComponent((s=>s.replace(/^SURAT JALAN\s+/i,"").trim().replace(/\s+/g,"_").toUpperCase())(r))}`:"/delivery-note/generate-no";return(await S.get(h)).data.data.delivery_note_no},me=async r=>(await S.post("/delivery-note",r)).data.data,he=async r=>(await S.put("/delivery-note",r)).data.data,ue=async r=>{await S.post("/delivery-note/approval",r)},G=r=>{var c,u;const a=X(),h=C({queryKey:["delivery-notes",r],queryFn:()=>oe(r)}),m=w({mutationFn:i=>me(i),onSuccess:i=>{console.log("Add delivery note success:",i),a.invalidateQueries({queryKey:["delivery-notes"]}),g.success("Delivery note added successfully")},onError:i=>{var l;const j=i instanceof k?(l=i.response)==null?void 0:l.data.message:`Gagal Menambah Surat Jalan: ${i.message}`;Array.isArray(j)?j.forEach(n=>g.error(n)):g.error(j)}}),s=w({mutationFn:i=>he(i),onSuccess:i=>{console.log("Update delivery note success:",i),a.invalidateQueries({queryKey:["delivery-notes"]}),g.success("Delivery note updated successfully")},onError:i=>{var l;const j=i instanceof k?(l=i.response)==null?void 0:l.data.message:`Gagal Mengubah Surat Jalan: ${i.message}`;Array.isArray(j)?j.forEach(n=>g.error(n)):g.error(j)}}),x=w({mutationFn:i=>ue(i),onSuccess:()=>{console.log("Approve delivery note success"),a.invalidateQueries({queryKey:["delivery-notes"]}),g.success("Delivery note approved successfully")},onError:i=>{var l;const j=i instanceof k?(l=i.response)==null?void 0:l.data.message:`Gagal Approve: ${i.message}`;Array.isArray(j)?j.forEach(n=>g.error(n)):g.error(j)}});return{deliveryNotes:((c=h.data)==null?void 0:c.data)||[],meta:(u=h.data)==null?void 0:u.meta,isLoading:h.isLoading,error:h.error,addDeliveryNote:m.mutate,updateDeliveryNote:s.mutate,approveDeliveryNote:x.mutate,isAdding:m.isPending,isUpdating:s.isPending,isApproving:x.isPending}},xe=r=>{const a=C({queryKey:["delivery-note",r],queryFn:()=>de(r),enabled:!!r});return{deliveryNote:a.data,isLoading:a.isLoading,error:a.error}},U=()=>{const r=C({queryKey:["delivery-note-types"],queryFn:ie});return{types:r.data||[],isLoading:r.isLoading,error:r.error}},Q=r=>{const a=C({queryKey:["generate-delivery-note-no",r],queryFn:()=>ce(r),enabled:!!r});return{deliveryNoteNo:a.data,isLoading:a.isLoading,error:a.error,refetch:a.refetch}},je=()=>{const r=K(),[a,h]=p.useState(!1),[m,s]=p.useState(!1),[x,c]=p.useState(!1),[u,i]=p.useState(null),[j,l]=p.useState(""),{deliveryNotes:n,addDeliveryNote:y,updateDeliveryNote:d}=G(),{types:v}=U(),{vendors:t}=R(),{deliveryNoteNo:b,refetch:P}=Q(j),B=[{key:"noSJ",label:"No. SJ",className:"min-w-120px"},{key:"tanggal",label:"Tanggal",className:"min-w-100px"},{key:"jenis",label:"Jenis",className:"min-w-100px"},{key:"vendor",label:"Vendor",className:"min-w-125px"},{key:"tujuan",label:"Tujuan",className:"min-w-125px"},{key:"status",label:"Status",className:"min-w-100px"},{key:"createdBy",label:"Created By",className:"min-w-125px"}],L=n.map(o=>({id:o.id,noSJ:o.delivery_note_no,tanggal:o.delivery_note_date,jenis:o.delivery_note_type,vendor:o.vendor.name,tujuan:o.destination,status:e.jsx(A,{status:o.status.toLowerCase()}),createdBy:"System"})),O=o=>{i(o),h(!0)},F=()=>{console.log("Deleting:",u),h(!1)},$=o=>{const N=n.find(Y=>Y.id===o.id);i(N?{id:N.id,noSJ:N.delivery_note_no,tanggal:N.delivery_note_date,jenis:N.delivery_note_type,vendor:N.vendor.id,tujuan:N.destination,status:N.status,notes:N.notes}:o),s(!0)},z=o=>{const N={id:o.id,delivery_note_no:o.noSJ,delivery_note_date:o.tanggal,delivery_note_type:o.jenis,vendor_id:o.vendor||"",destination:o.tujuan,status:o.status,notes:o.notes||"",user_id:"system",details:[]};d(N),s(!1),i(null)},H=()=>{r("/production/add-surat-jalan")},V=o=>{l(o),P()},W=o=>{const N={delivery_note_no:b||o.noSJ,delivery_note_date:o.tanggal,delivery_note_type:o.jenis,vendor_id:o.vendor,destination:o.tujuan,status:o.status,notes:o.notes||"",user_id:"system",details:[]};y(N),c(!1),l("")};return e.jsxs("div",{children:[e.jsx(te,{className:"card-xl-stretch",rows:L,columns:B,labelAdd:"Surat Jalan",filters:[{key:"jenis",label:"Filter by Jenis"},{key:"vendor",label:"Filter by Vendor"},{key:"status",label:"Filter by Status"}],onDelete:O,onEdit:$,onAddClick:H,onRowClick:o=>r(`/production/delivery-note-detail/detail/${o.id}`),roleAccess:["ADMIN","OWNER","ADMIN PRODUKSI"]}),a&&u&&e.jsx(ae,{show:a,title:"Delete Surat Jalan",itemName:u.noSJ,onConfirm:F,onClose:()=>{h(!1),i(null)}}),m&&u&&e.jsx(re,{show:m,title:"Edit Surat Jalan",fields:[{name:"noSJ",label:"No. SJ",type:"text",required:!0,icon:"document"},{name:"tanggal",label:"Tanggal",type:"date",required:!0,icon:"calendar"},{name:"jenis",label:"Jenis",type:"select",required:!0,options:v.map(o=>({value:o.id,label:o.name})),icon:"cog"},{name:"vendor",label:"Vendor",type:"select",required:!0,options:t.map(o=>({value:o.id,label:o.name})),icon:"user"},{name:"tujuan",label:"Tujuan",type:"text",required:!0,icon:"map"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"PENDING",label:"Pending"},{value:"DONE",label:"Done"}],icon:"check-circle"},{name:"notes",label:"Notes",type:"textarea",required:!1,icon:"comment"}],initialData:u,onSave:z,onClose:()=>{s(!1),i(null)}}),x&&e.jsx(ne,{show:x,title:"Add Surat Jalan",fields:[{name:"jenis",label:"Jenis",type:"select",required:!0,options:v.map(o=>({value:o.id,label:o.name})),icon:"cog",onChange:V},{name:"noSJ",label:"No. SJ",type:"text",required:!0,icon:"document"},{name:"tanggal",label:"Tanggal",type:"date",required:!0,icon:"calendar"},{name:"vendor",label:"Vendor",type:"select",required:!0,options:t.map(o=>({value:o.id,label:o.name})),icon:"user"},{name:"tujuan",label:"Tujuan",type:"text",required:!0,icon:"map"},{name:"status",label:"Status",type:"select",required:!0,options:[{value:"PENDING",label:"Pending"},{value:"DONE",label:"Done"}],icon:"check-circle"},{name:"notes",label:"Notes",type:"textarea",required:!1,icon:"comment"}],onSubmit:W,onClose:()=>c(!1)})]})},ye=()=>{const[r,a]=p.useState({delivery_note_no:"",delivery_note_date:"",delivery_note_type:"PERMINTAAN_KAIN",vendor_id:"",destination:"",status:"PENDING",notes:"",user_id:"system"}),{deliveryNoteNo:h,refetch:m}=Q(r.delivery_note_type);return p.useEffect(()=>{r.delivery_note_type&&m()},[r.delivery_note_type,m]),p.useEffect(()=>{h&&a(x=>({...x,delivery_note_no:h}))},[h]),p.useEffect(()=>{const x=new Date().toISOString().split("T")[0];a(c=>({...c,delivery_note_date:x}))},[]),{formData:r,updateFormData:x=>{a(c=>({...c,...x}))}}},pe=()=>{const{data:r}=le(),[a,h]=p.useState([]),[m,s]=p.useState({});return p.useEffect(()=>{a.forEach(c=>{m[c]||(async()=>{try{const i=await S.get(`/spk/${c}`);i.data.success&&s(j=>({...j,[c]:i.data.data.details}))}catch(i){console.error("Error fetching SPK detail:",i)}})()})},[a,m]),{spkList:r,selectedSpks:a,spkDetails:m,toggleSpkSelection:c=>{h(u=>u.includes(c)?u.filter(i=>i!==c):[...u,c])}}},_={PERMINTAAN_KAIN:"PERMINTAAN_KAIN",BUANG_BENANG_KELUAR:"BUANG_BENANG_KELUAR",JAHIT_KELUAR:"JAHIT_KELUAR",BUANG_BENANG_MASUK:"BUANG_BENANG_MASUK",JAHIT_MASUK:"JAHIT_MASUK",PENGIRIMAN_BARANG:"PENGIRIMAN_BARANG"},D=(r,a,h)=>{const m=Array.isArray(r)?r:[];if(h===_.PERMINTAAN_KAIN){const s=m.find(x=>x.material_name==="KAIN");if(s)return{material_name:s.material_name,material_qty:s.qty_per_unit*a.qty_order}}return{material_name:"",material_qty:0}},ve=r=>{const[a,h]=p.useState([]);return{selectedDetails:a,handleDetailSelect:(c,u,i)=>{if(i){const{material_name:j,material_qty:l}=D(c.bom,c,r),n={spk_detail_id:c.id,item_type:"PRODUCT",product_variant_id:(c==null?void 0:c.id)??"",material_id:null,qty_out:c.qty_order,qty_in:0,labor_cost:0,spk_no:u.noSpk,product_name:c.product_name,color:c.color,size:c.size,qty_order:c.qty_order,material_name:j,material_qty:l,short_material:0,qty_done:0,hpp:0,selisih:0};h(y=>[...y,n])}else h(j=>j.filter(l=>l.spk_detail_id!==c.id))},handleSelectAllDetails:(c,u,i,j)=>{if(u){const l=j.map(n=>{const{material_name:y,material_qty:d}=D(n.bom,n,r);return{spk_detail_id:n.id,item_type:"PRODUCT",product_variant_id:(n==null?void 0:n.id)??"",material_id:null,qty_out:n.qty_order,qty_in:0,labor_cost:0,spk_no:i.noSpk,product_name:n.product_name,color:n.color,size:n.size,qty_order:n.qty_order,material_name:y,material_qty:d,short_material:0,qty_done:0,hpp:0,selisih:0}});h(n=>[...n.filter(y=>!j.some(d=>d.id===y.spk_detail_id)),...l])}else h(l=>l.filter(n=>!j.some(y=>y.id===n.spk_detail_id)))},updateDetail:(c,u,i)=>{h(j=>j.map(l=>l.spk_detail_id===c?{...l,[u]:i}:l))}}},Ne=({formData:r,updateFormData:a})=>{const{types:h}=U(),{vendors:m}=R();return e.jsxs("div",{children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Note No *"}),e.jsx("input",{type:"text",className:"form-control",value:r.delivery_note_no,onChange:s=>a({delivery_note_no:s.target.value}),disabled:!0})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Date *"}),e.jsx("input",{type:"date",className:"form-control",value:r.delivery_note_date,onChange:s=>a({delivery_note_date:s.target.value})})]})})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Type *"}),e.jsx("select",{className:"form-select",value:r.delivery_note_type,onChange:s=>a({delivery_note_type:s.target.value}),children:h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Vendor *"}),e.jsxs("select",{className:"form-select",value:r.vendor_id,onChange:s=>a({vendor_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Vendor"}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Destination *"}),e.jsx("input",{type:"text",className:"form-control",value:r.destination,onChange:s=>a({destination:s.target.value})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Status *"}),e.jsxs("select",{className:"form-select",value:r.status,onChange:s=>a({status:s.target.value}),children:[e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"DONE",children:"DONE"})]})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"form-control",rows:3,value:r.notes,onChange:s=>a({notes:s.target.value})})]})]})},_e=({spkList:r,selectedSpks:a,toggleSpkSelection:h})=>{const[m,s]=p.useState(""),[x,c]=p.useState(1),u=3,i=(r==null?void 0:r.filter(n=>n.status==="approved"&&(m===""||n.noSpk.toLowerCase().includes(m.toLowerCase())||n.buyer.toLowerCase().includes(m.toLowerCase()))))||[],j=i.slice((x-1)*u,x*u),l=Math.ceil(i.length/u);return e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label",children:"Select SPKs *"}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-md-6",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search SPK by number or buyer...",value:m,onChange:n=>s(n.target.value),onKeyDown:n=>{n.key==="Enter"&&c(1)}})})}),e.jsx("div",{className:"row",children:j.map(n=>e.jsx("div",{className:"col-md-6 col-lg-4 mb-3",children:e.jsx("div",{className:`card h-100 ${a.includes(n.id)?"border-primary":"border-light"}`,children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`spk-${n.id}`,checked:a.includes(n.id),disabled:n.status!=="approved",onChange:()=>h(n.id)}),e.jsx("label",{className:"form-check-label w-100",htmlFor:`spk-${n.id}`,children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("strong",{className:"text-primary",children:n.noSpk}),e.jsx("small",{className:"text-muted",children:n.buyer}),e.jsx("span",{className:`badge ${n.status==="approved"?"bg-success":n.status==="in_progress"?"bg-warning":"bg-secondary"} mt-1 align-self-start`,children:n.status.replace("_"," ").toUpperCase()})]})})]})})})},n.id))}),l>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsx("nav",{children:e.jsxs("ul",{className:"pagination",children:[e.jsx("li",{className:`page-item ${x===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>c(n=>Math.max(1,n-1)),disabled:x===1,children:"Previous"})}),Array.from({length:l},(n,y)=>y+1).map(n=>e.jsx("li",{className:`page-item ${x===n?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>c(n),children:n})},n)),e.jsx("li",{className:`page-item ${x===l?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>c(n=>Math.min(l,n+1)),disabled:x===l,children:"Next"})})]})})}),a.length>0&&e.jsx("div",{className:"mt-3",children:e.jsxs("small",{className:"text-muted",children:["Selected ",a.length," SPK",a.length>1?"s":""]})})]})},ge=({selectedSpks:r,spkList:a,spkDetails:h,selectedDetails:m,deliveryNoteType:s,handleDetailSelect:x,handleSelectAllDetails:c,updateDetail:u})=>{if(r.length===0)return null;const i=()=>{const l=[e.jsx("th",{},"checkbox"),e.jsx("th",{children:"Product"},"product"),e.jsx("th",{children:"Color"},"color"),e.jsx("th",{children:"Size"},"size")];return s===_.PERMINTAAN_KAIN?l.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Nama Material"},"material_name"),e.jsx("th",{children:"Jumlah Material"},"material_qty"),e.jsx("th",{children:"Kurang Material"},"short_material")):s===_.BUANG_BENANG_KELUAR||s===_.JAHIT_KELUAR?l.push(e.jsx("th",{children:"Qty Order"},"qty_order"),e.jsx("th",{children:"Qty Out"},"qty_out")):s===_.BUANG_BENANG_MASUK||s===_.JAHIT_MASUK?l.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"Qty In"},"qty_in"),e.jsx("th",{children:"Selisih"},"selisih")):s===_.PENGIRIMAN_BARANG?l.push(e.jsx("th",{children:"Qty SPK"},"qty_spk"),e.jsx("th",{children:"Qty Done"},"qty_done"),e.jsx("th",{children:"Qty Out"},"qty_out"),e.jsx("th",{children:"HPP"},"hpp")):l.push(e.jsx("th",{children:"Qty Order"},"qty_order"),e.jsx("th",{children:"Qty"},"qty_out")),l},j=(l,n)=>{const y=m.some(t=>t.spk_detail_id===l.id),d=m.find(t=>t.spk_detail_id===l.id),v=[e.jsx("td",{onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:y,onChange:t=>x(l,n,t.target.checked)})},"checkbox"),e.jsx("td",{children:l.product_name},"product"),e.jsx("td",{children:l.color},"color"),e.jsx("td",{children:l.size},"size")];return s===_.PERMINTAAN_KAIN?v.push(e.jsx("td",{children:l.qty_order},"qty_spk"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"text",className:"form-control",value:(d==null?void 0:d.material_name)||"",readOnly:!0})},"material_name"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.material_qty)||"",readOnly:!0})},"material_qty"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.short_material)||"",onChange:t=>u(l.id,"short_material",t.target.value===""?0:parseInt(t.target.value)||0),min:0})},"short_material")):s===_.BUANG_BENANG_KELUAR||s===_.JAHIT_KELUAR?v.push(e.jsx("td",{children:l.qty_order},"qty_order"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.qty_out)||"",onChange:t=>u(l.id,"qty_out",t.target.value===""?0:parseInt(t.target.value)||0),max:l.qty_order,min:0})},"qty_out")):s===_.BUANG_BENANG_MASUK||s===_.JAHIT_MASUK?v.push(e.jsx("td",{children:l.qty_order},"qty_spk"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.qty_out)||"",onChange:t=>u(l.id,"qty_out",t.target.value===""?0:parseInt(t.target.value)||0),min:0})},"qty_out"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.qty_in)||"",onChange:t=>u(l.id,"qty_in",t.target.value===""?0:parseInt(t.target.value)||0),min:0})},"qty_in"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.selisih)||"",onChange:t=>u(l.id,"selisih",t.target.value===""?0:parseInt(t.target.value)||0),min:0})},"selisih")):s===_.PENGIRIMAN_BARANG?v.push(e.jsx("td",{children:l.qty_order},"qty_spk"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.qty_done)||"",onChange:t=>u(l.id,"qty_done",t.target.value===""?0:parseInt(t.target.value)||0),min:0})},"qty_done"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.qty_out)||"",onChange:t=>u(l.id,"qty_out",t.target.value===""?0:parseInt(t.target.value)||0),min:0})},"qty_out"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.hpp)||"",onChange:t=>u(l.id,"hpp",t.target.value===""?0:parseFloat(t.target.value)||0),min:0,step:"0.01"})},"hpp")):v.push(e.jsx("td",{children:l.qty_order},"qty_order"),e.jsx("td",{onClick:t=>t.stopPropagation(),children:y&&e.jsx("input",{type:"number",className:"form-control",value:(d==null?void 0:d.qty_out)||"",onChange:t=>u(l.id,"qty_out",t.target.value===""?0:parseInt(t.target.value)||0),max:l.qty_order,min:0})},"qty_out")),v};return e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Select SPK Details"}),r.map(l=>{const n=a==null?void 0:a.find(t=>t.id===l),y=h[l]||[],d=y.length>0&&y.every(t=>m.some(b=>b.spk_detail_id===t.id)),v=y.some(t=>m.some(b=>b.spk_detail_id===t.id));return e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{children:[n==null?void 0:n.noSpk," - ",n==null?void 0:n.buyer]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx("input",{type:"checkbox",checked:d,ref:t=>{t&&(t.indeterminate=v&&!d)},onChange:t=>c(l,t.target.checked,n,y)})}),i().slice(1)]})}),e.jsx("tbody",{children:y.map(t=>{const b=m.some(P=>P.spk_detail_id===t.id);return e.jsx("tr",{className:`cursor-pointer ${b?"table-active":""}`,onClick:()=>x(t,n,!b),children:j(t,n)},t.id)})})]})})]},l)})]})},be=()=>{const r=K(),{addDeliveryNote:a}=G(),{currentUser:h}=Z(),{formData:m,updateFormData:s}=ye(),{spkList:x,selectedSpks:c,spkDetails:u,toggleSpkSelection:i}=pe(),{selectedDetails:j,handleDetailSelect:l,handleSelectAllDetails:n,updateDetail:y}=ve(m.delivery_note_type),d=()=>{if(!m.delivery_note_no||!m.delivery_note_date||!m.vendor_id||!m.destination){alert("Please fill all required fields");return}if(j.length===0){alert("Please select at least one SPK detail");return}if(h){const v={...m,user_id:h==null?void 0:h.full_name,details:j.map(t=>({spk_detail_id:t.spk_detail_id,item_type:t.item_type,product_variant_id:t.product_variant_id,material_id:t.material_id,qty_out:t.qty_out,qty_in:t.qty_in,labor_cost:t.labor_cost,material_name:t.material_name,material_qty:t.material_qty,short_material:t.short_material,qty_done:t.qty_done,hpp:t.hpp,selisih:t.selisih}))};console.log(v),a(v),r("/production/surat-jalan")}};return e.jsx("div",{className:"container-fluid",children:e.jsxs(ee,{children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Add Surat Jalan"})}),e.jsxs("div",{className:"card-body",children:[e.jsx(Ne,{formData:m,updateFormData:s}),e.jsx(_e,{spkList:x,selectedSpks:c,toggleSpkSelection:i}),e.jsx(ge,{selectedSpks:c,spkList:x,spkDetails:u,selectedDetails:j,deliveryNoteType:m.delivery_note_type,handleDetailSelect:l,handleSelectAllDetails:n,updateDetail:y}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:d,children:"Save Surat Jalan"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>r("/production/surat-jalan"),children:"Cancel"})]})]})]})})},fe=({deliveryNoteId:r})=>{console.log(r);const{deliveryNote:a,isLoading:h,error:m}=xe(r||"");return r?h?e.jsx(q,{children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):m?e.jsx(q,{children:e.jsxs("div",{className:"alert alert-danger",children:["Error loading delivery note: ",m.message]})}):a?e.jsxs(q,{children:[e.jsxs("div",{className:"card mb-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"card-title",children:e.jsxs("h3",{className:"card-label",children:["Delivery Note #",a.delivery_note_no]})})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Delivery Note No:"})," ",a.delivery_note_no]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Delivery Date:"})," ",a.delivery_note_date]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Type:"})," ",a.delivery_note_type]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Vendor:"})," ",a.vendor.name]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Destination:"})," ",a.destination]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(A,{status:a.status.toLowerCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Notes:"})," ",a.notes||"-"]})]})]})})]}),e.jsxs("div",{className:"card mb-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Vendor Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Name:"})," ",a.vendor.name]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Contact Person:"})," ",a.vendor.contact_person]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Phone:"})," ",a.vendor.phone]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Email:"})," ",a.vendor.email]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Address:"})," ",a.vendor.address]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"City:"})," ",a.vendor.city,", ",a.vendor.province,", ",a.vendor.country]})]})]})})]}),a.details&&a.details.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Delivery Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-block d-md-none",children:["// eslint-disable-next-line @typescript-eslint/no-explicit-any",a.details.map((s,x)=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h6",{className:"card-title mb-2",children:["Detail #",x+1]}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Item Type"}),e.jsx("div",{children:s.item_type})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Out"}),e.jsx("div",{children:s.qty_out})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty In"}),e.jsx("div",{children:s.qty_in})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted",children:"HPP"}),e.jsxs("div",{children:["Rp ",s.labor_cost.toLocaleString()]})]})]})]})},s.id||x))]}),e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-125px",children:"SPK Detail ID"}),e.jsx("th",{className:"min-w-100px",children:"Item Type"}),e.jsx("th",{className:"min-w-100px",children:"Product Variant ID"}),e.jsx("th",{className:"min-w-100px",children:"Material ID"}),e.jsx("th",{className:"min-w-80px",children:"Qty Out"}),e.jsx("th",{className:"min-w-80px",children:"Qty In"}),e.jsx("th",{className:"min-w-100px",children:"Labor Cost"}),e.jsx("th",{className:"min-w-100px",children:"Status"})]})}),e.jsx("tbody",{className:"text-gray-600 fw-semibold",children:a.details.map((s,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.spk_detail_id}),e.jsx("td",{children:s.item_type}),e.jsx("td",{children:s.product_variant_id||"-"}),e.jsx("td",{children:s.material_id||"-"}),e.jsx("td",{children:s.qty_out}),e.jsx("td",{children:s.qty_in}),e.jsxs("td",{children:["Rp ",s.labor_cost.toLocaleString()]}),e.jsx("td",{children:s.status?e.jsx(A,{status:s.status.toLowerCase()}):"-"})]},s.id||x))})]})})})]})]}),a.spk&&a.spk.length>0&&e.jsxs("div",{className:"card mt-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"Related SPK Information"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-6 col-md-12 mb-4 mb-lg-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"SPK No:"})," ",a.spk[0].spk_no]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Buyer:"})," ",a.spk[0].buyer]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"SPK Date:"})," ",a.spk[0].spk_date]})]}),e.jsxs("div",{className:"col-lg-6 col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Deadline:"})," ",a.spk[0].deadline]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(A,{status:a.spk[0].status.toLowerCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Notes:"})," ",a.spk[0].notes||"-"]})]})]})})]}),a.spk_details&&a.spk_details.length>0&&e.jsxs("div",{className:"card mt-5",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"card-title",children:"SPK Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"d-block d-md-none",children:a.spk_details.map(s=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title mb-2",children:s.product_variants.product_name}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Size"}),e.jsx("div",{children:s.product_variants.size})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Color"}),e.jsx("div",{children:s.product_variants.color})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Order"}),e.jsx("div",{children:s.qty_order})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Done"}),e.jsx("div",{children:s.qty_done})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Qty Reject"}),e.jsx("div",{children:s.qty_reject})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Progress"}),e.jsxs("div",{children:[s.progress,"%"]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted",children:"Status"}),e.jsx(A,{status:s.status.toLowerCase()})]})]})]})},s.id))}),e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle table-row-dashed fs-6 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-start text-muted fw-bold fs-7 text-uppercase gs-0",children:[e.jsx("th",{className:"min-w-200px",children:"Product"}),e.jsx("th",{className:"min-w-80px",children:"Size"}),e.jsx("th",{className:"min-w-80px",children:"Color"}),e.jsx("th",{className:"min-w-80px",children:"Qty Order"}),e.jsx("th",{className:"min-w-80px",children:"Qty Done"}),e.jsx("th",{className:"min-w-80px",children:"Qty Reject"}),e.jsx("th",{className:"min-w-80px",children:"Progress"}),e.jsx("th",{className:"min-w-100px",children:"Status"})]})}),e.jsx("tbody",{className:"text-gray-600 fw-semibold",children:a.spk_details.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.product_variants.product_name}),e.jsx("td",{children:s.product_variants.size}),e.jsx("td",{children:s.product_variants.color}),e.jsx("td",{children:s.qty_order}),e.jsx("td",{children:s.qty_done}),e.jsx("td",{children:s.qty_reject}),e.jsx("td",{children:s.progress}),e.jsx("td",{children:e.jsx(A,{status:s.status.toLowerCase()})})]},s.id))})]})})})]})]})]}):e.jsx(q,{children:e.jsx("div",{className:"alert alert-warning",children:"Delivery note not found."})}):e.jsx(q,{children:e.jsx("div",{className:"alert alert-warning",children:"Delivery note ID is required."})})},Se=[{title:"Surat Jalan",path:"/production/surat-jalan",isSeparator:!1,isActive:!1}],Ae=()=>{const{id:r}=se();return e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:Se,children:"Delivery Note Detail"}),e.jsx(fe,{deliveryNoteId:r})]})},qe=()=>e.jsx(M,{children:e.jsxs(f,{element:e.jsx(e.Fragment,{children:e.jsx(T,{})}),children:[e.jsx(f,{path:"detail/:id",element:e.jsx(Ae,{})}),e.jsx(f,{index:!0,element:e.jsx(J,{to:"/production/surat-jalan"})})]})}),I=[{title:"Produksi > ",path:"/production/",isSeparator:!1,isActive:!1}],Ge=()=>e.jsx(M,{children:e.jsxs(f,{element:e.jsx(T,{}),children:[e.jsx(f,{path:"surat-jalan",element:e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:I,children:"Surat Jalan"}),e.jsx(je,{})]})}),e.jsx(f,{path:"add-surat-jalan",element:e.jsxs(e.Fragment,{children:[e.jsx(E,{breadcrumbs:I,children:"Add Surat Jalan"}),e.jsx(be,{})]})}),e.jsx(f,{path:"delivery-note-detail/*",element:e.jsx(qe,{})}),e.jsx(f,{index:!0,element:e.jsx(J,{to:"/production/dashboard"})})]})});export{Ge as default};
