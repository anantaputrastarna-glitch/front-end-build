import{r as k,j as e,a4 as Me,$ as se,a1 as fe,_ as J,a2 as qe,a5 as ge,a3 as Ne,Y as ve,a0 as we,Z as ae,k as ue,g as Oe,i as ie,O as ke,N as Be}from"./index-D-XR31JT.js";import{T as Fe}from"./TablesWidget13-y_aP1tXu.js";import{u as me,a as Se}from"./useMutation-Oh55HBpB.js";import{u as Ce}from"./useVendors-BTFI78wS.js";import{a as Ge,b as De,c as Ke,u as $e,d as We,m as Qe}from"./useSpkList-e_ywL-l6.js";import{M as I}from"./Modal-DYMOa9Z9.js";import{F as a,C as _,B as G}from"./Form--xwUDFMC.js";import{u as Ae,b as Ve,d as ze,c as Ee}from"./ThemeProvider-B2JDDGPV.js";import{B as Je}from"./react-barcode-CoO91FqC.js";import{f as Y}from"./dateFormatter-Bb4_azhc.js";import{S as He}from"./StatusBadge-BYr4rya_.js";import"./hasClass-CdozZXuC.js";import"./warning-iUkfSyoP.js";const F=k.forwardRef(({bsPrefix:t,className:l,as:s="div",...r},n)=>{const d=Ae(t,"row"),f=Ve(),w=ze(),N=`${d}-cols`,p=[];return f.forEach(P=>{const c=r[P];delete r[P];let j;c!=null&&typeof c=="object"?{cols:j}=c:j=c;const g=P!==w?`-${P}`:"";j!=null&&p.push(`${N}${g}-${j}`)}),e.jsx(s,{ref:n,...r,className:Ee(l,d,...p)})});F.displayName="Row";const Ie=k.forwardRef(({bsPrefix:t,className:l,striped:s,bordered:r,borderless:n,hover:d,size:f,variant:w,responsive:N,...p},P)=>{const c=Ae(t,"table"),j=Ee(l,c,w&&`${c}-${w}`,f&&`${c}-${f}`,s&&`${c}-${typeof s=="string"?`striped-${s}`:"striped"}`,r&&`${c}-bordered`,n&&`${c}-borderless`,d&&`${c}-hover`),g=e.jsx("table",{...p,className:j,ref:P});if(N){let m=`${c}-responsive`;return typeof N=="string"&&(m=`${m}-${N}`),e.jsx("div",{className:m,children:g})}return g});var ye={exports:{}},Ue=ye.exports,Pe;function Ye(){return Pe||(Pe=1,(function(t,l){(function(s,r){t.exports=r(Me())})(typeof self<"u"?self:Ue,function(s){return(function(){var r={155:function(o){o.exports=s}},n={};function d(o){var x=n[o];if(x!==void 0)return x.exports;var b=n[o]={exports:{}};return r[o](b,b.exports,d),b.exports}d.d=function(o,x){for(var b in x)d.o(x,b)&&!d.o(o,b)&&Object.defineProperty(o,b,{enumerable:!0,get:x[b]})},d.o=function(o,x){return Object.prototype.hasOwnProperty.call(o,x)},d.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var f={};d.r(f),d.d(f,{useReactToPrint:function(){return u}});var w=d(155);const N="printWindow";function p({level:o="error",messages:x,suppressErrors:b=!1}){b||(o==="error"?console.error(x):o==="warning"?console.warn(x):console.debug(x))}function P(o,x){if(x||!o){const b=document.getElementById(N);b&&document.body.removeChild(b)}}function c(o){return o instanceof Error?o:new Error("Unknown Error")}function j(o,x){const{documentTitle:b,onAfterPrint:S,onPrintError:C,preserveAfterPrint:M,print:D,suppressErrors:$}=x;setTimeout(()=>{var y,R;if(o.contentWindow){let i=function(){S==null||S(),P(M)};if(o.contentWindow.focus(),D)D(o).then(i).catch(L=>{C?C("print",c(L)):p({messages:["An error was thrown by the specified `print` function"],suppressErrors:$})});else{if(o.contentWindow.print){const L=(R=(y=o.contentDocument)===null||y===void 0?void 0:y.title)!==null&&R!==void 0?R:"",K=o.ownerDocument.title;b&&(o.ownerDocument.title=b,o.contentDocument&&(o.contentDocument.title=b)),o.contentWindow.print(),b&&(o.ownerDocument.title=K,o.contentDocument&&(o.contentDocument.title=L))}else p({messages:["Printing for this browser is not currently possible: the browser does not have a `print` method available for iframes."],suppressErrors:$});[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(L=>{var K,W;return((W=(K=navigator.userAgent)!==null&&K!==void 0?K:navigator.vendor)!==null&&W!==void 0?W:"opera"in window&&window.opera).match(L)})?setTimeout(i,500):i()}}else p({messages:["Printing failed because the `contentWindow` of the print iframe did not load. This is possibly an error with `react-to-print`. Please file an issue: https://github.com/MatthewHerbst/react-to-print/issues/"],suppressErrors:$})},500)}function g(o){const x=[],b=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,null);let S=b.nextNode();for(;S;)x.push(S),S=b.nextNode();return x}function m(o,x,b){const S=g(o),C=g(x);if(S.length===C.length)for(let M=0;M<S.length;M++){const D=S[M],$=C[M],y=D.shadowRoot;if(y!==null){const R=$.attachShadow({mode:y.mode});R.innerHTML=y.innerHTML,m(y,R,b)}}else p({messages:["When cloning shadow root content, source and target elements have different size. `onBeforePrint` likely resolved too early.",o,x],suppressErrors:b})}const q=`
    @page {
        /* Remove browser default header (title) and footer (url) */
        margin: 0;
    }
    @media print {
        body {
            /* Tell browsers to print background colors */
            color-adjust: exact; /* Firefox. This is an older version of "print-color-adjust" */
            print-color-adjust: exact; /* Firefox/Safari */
            -webkit-print-color-adjust: exact; /* Chrome/Safari/Edge/Opera */
        }
    }
`;function h(o,x,b,S){var C,M,D,$,y;const{contentNode:R,clonedContentNode:i,clonedImgNodes:L,clonedVideoNodes:K,numResourcesToLoad:W,originalCanvasNodes:ne}=b,{bodyClass:pe,fonts:re,ignoreGlobalStyles:de,pageStyle:Q,nonce:X,suppressErrors:ce,copyShadowRoots:be}=S;o.onload=null;const A=(C=o.contentDocument)!==null&&C!==void 0?C:(M=o.contentWindow)===null||M===void 0?void 0:M.document;if(A){const B=A.body.appendChild(i);be&&m(R,B,!!ce),re&&(!((D=o.contentDocument)===null||D===void 0)&&D.fonts&&(!(($=o.contentWindow)===null||$===void 0)&&$.FontFace)?re.forEach(E=>{const v=new FontFace(E.family,E.source,{weight:E.weight,style:E.style});o.contentDocument.fonts.add(v),v.loaded.then(()=>{x(v)}).catch(V=>{x(v,["Failed loading the font:",v,"Load error:",c(V)])})}):(re.forEach(E=>{x(E)}),p({messages:['"react-to-print" is not able to load custom fonts because the browser does not support the FontFace API but will continue attempting to print the page'],suppressErrors:ce})));const oe=Q??q,Z=A.createElement("style");X&&(Z.setAttribute("nonce",X),A.head.setAttribute("nonce",X)),Z.appendChild(A.createTextNode(oe)),A.head.appendChild(Z),pe&&A.body.classList.add(...pe.split(" "));const he=A.querySelectorAll("canvas");for(let E=0;E<ne.length;++E){const v=ne[E],V=he[E];if(V===void 0){p({messages:["A canvas element could not be copied for printing, has it loaded? `onBeforePrint` likely resolved too early.",v],suppressErrors:ce});continue}const T=V.getContext("2d");T&&T.drawImage(v,0,0)}for(let E=0;E<L.length;E++){const v=L[E],V=v.getAttribute("src");if(V){const T=new Image;T.onload=()=>{x(v)},T.onerror=(O,z,ee,U,te)=>{x(v,["Error loading <img>",v,"Error",te])},T.src=V}else x(v,['Found an <img> tag with an empty "src" attribute. This prevents pre-loading it.',v])}for(let E=0;E<K.length;E++){const v=K[E];v.preload="auto";const V=v.getAttribute("poster");if(V){const T=new Image;T.onload=()=>{x(v)},T.onerror=(O,z,ee,U,te)=>{x(v,["Error loading video poster",V,"for video",v,"Error:",te])},T.src=V}else v.readyState>=2?x(v):v.src?(v.onloadeddata=()=>{x(v)},v.onerror=(T,O,z,ee,U)=>{x(v,["Error loading video",v,"Error",U])},v.onstalled=()=>{x(v,["Loading video stalled, skipping",v])}):x(v,["Error loading video, `src` is empty",v])}const xe="select",H=R.querySelectorAll(xe),le=A.querySelectorAll(xe);for(let E=0;E<H.length;E++)le[E].value=H[E].value;if(!de){const E=document.querySelectorAll("style, link[rel~='stylesheet'], link[as='style']");for(let v=0,V=E.length;v<V;++v){const T=E[v];if(T.tagName.toLowerCase()==="style"){const O=A.createElement(T.tagName),z=T.sheet;if(z){let ee="";try{const U=z.cssRules.length;for(let te=0;te<U;++te)typeof z.cssRules[te].cssText=="string"&&(ee+=`${z.cssRules[te].cssText}\r
`)}catch(U){p({messages:["A stylesheet could not be accessed. This is likely due to the stylesheet having cross-origin imports, and many browsers block script access to cross-origin stylesheets. See https://github.com/MatthewHerbst/react-to-print/issues/429 for details. You may be able to load the sheet by both marking the stylesheet with the cross `crossorigin` attribute, and setting the `Access-Control-Allow-Origin` header on the server serving the stylesheet. Alternatively, host the stylesheet on your domain to avoid this issue entirely.",T,`Original error: ${c(U).message}`],level:"warning"})}O.setAttribute("id",`react-to-print-${v}`),X&&O.setAttribute("nonce",X),O.appendChild(A.createTextNode(ee)),A.head.appendChild(O)}}else if(T.getAttribute("href"))if(T.hasAttribute("disabled"))p({messages:["`react-to-print` encountered a <link> tag with a `disabled` attribute and will ignore it. Note that the `disabled` attribute is deprecated, and some browsers ignore it. You should stop using it. https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link#attr-disabled. The <link> is:",T],level:"warning"}),x(T);else{const O=A.createElement(T.tagName);for(let z=0,ee=T.attributes.length;z<ee;++z){const U=T.attributes[z];U&&O.setAttribute(U.nodeName,(y=U.nodeValue)!==null&&y!==void 0?y:"")}O.onload=()=>{x(O)},O.onerror=(z,ee,U,te,Le)=>{x(O,["Failed to load",O,"Error:",Le])},X&&O.setAttribute("nonce",X),A.head.appendChild(O)}else p({messages:["`react-to-print` encountered a <link> tag with an empty `href` attribute. In addition to being invalid HTML, this can cause problems in many browsers, and so the <link> was not loaded. The <link> is:",T],level:"warning"}),x(T)}}}W===0&&j(o,S)}function u({bodyClass:o,contentRef:x,copyShadowRoots:b,documentTitle:S,fonts:C,ignoreGlobalStyles:M,nonce:D,onAfterPrint:$,onBeforePrint:y,onPrintError:R,pageStyle:i,preserveAfterPrint:L,print:K,printIframeProps:W,suppressErrors:ne}){return(0,w.useCallback)(re=>{function de(){const Q={bodyClass:o,contentRef:x,copyShadowRoots:b,documentTitle:S,fonts:C,ignoreGlobalStyles:M,nonce:D,onAfterPrint:$,onPrintError:R,pageStyle:i,preserveAfterPrint:L,print:K,suppressErrors:ne},X=(function(A){const B=document.createElement("iframe");return B.width=`${document.documentElement.clientWidth}px`,B.height=`${document.documentElement.clientHeight}px`,B.style.position="absolute",B.style.top=`-${document.documentElement.clientHeight+100}px`,B.style.left=`-${document.documentElement.clientWidth+100}px`,B.id=N,B.srcdoc="<!DOCTYPE html>",A&&(A.allow&&(B.allow=A.allow),A.referrerPolicy!==void 0&&(B.referrerPolicy=A.referrerPolicy),A.sandbox!==void 0&&(B.sandbox=A.sandbox)),B})(W),ce=(function(A,B){const{contentRef:oe,fonts:Z,ignoreGlobalStyles:he,suppressErrors:xe}=B,H=(function({contentRef:O,optionalContent:z,suppressErrors:ee}){return z&&typeof z=="function"?(O&&p({level:"warning",messages:['"react-to-print" received a `contentRef` option and an optional-content param passed to its callback. The `contentRef` option will be ignored.']}),z()):O?O.current:void p({messages:['"react-to-print" did not receive a `contentRef` option or a optional-content param pass to its callback.'],suppressErrors:ee})})({contentRef:oe,optionalContent:A,suppressErrors:xe});if(!H)return;const le=H.cloneNode(!0),E=document.querySelectorAll("link[rel~='stylesheet'], link[as='style']"),v=le.querySelectorAll("img"),V=le.querySelectorAll("video"),T=Z?Z.length:0;return{contentNode:H,clonedContentNode:le,clonedImgNodes:v,clonedVideoNodes:V,numResourcesToLoad:(he?0:E.length)+v.length+V.length+T,originalCanvasNodes:H.querySelectorAll("canvas")}})(re,Q);if(!ce)return void p({messages:["There is nothing to print"],suppressErrors:ne});const be=(function(A,B,oe){const{suppressErrors:Z}=A,he=[],xe=[];return function(H,le){he.includes(H)?p({level:"debug",messages:["Tried to mark a resource that has already been handled",H],suppressErrors:Z}):(le?(p({messages:['"react-to-print" was unable to load a resource but will continue attempting to print the page',...le],suppressErrors:Z}),xe.push(H)):he.push(H),he.length+xe.length===B&&j(oe,A))}})(Q,ce.numResourcesToLoad,X);(function(A,B,oe,Z){A.onload=()=>{h(A,B,oe,Z)},document.body.appendChild(A)})(X,be,ce,Q)}P(L,!0),y?y().then(()=>{de()}).catch(Q=>{R==null||R("onBeforePrint",c(Q))}):de()},[o,x,b,S,C,M,D,$,y,R,i,L,K,ne])}return f})()})})(ye)),ye.exports}var Ze=Ye();const Xe=({show:t,onHide:l})=>{const[s,r]=k.useState({no_spk:"",buyer:"",tanggal:new Date().toISOString().split("T")[0],deadline:"",status:"PENDING",notes:"",biayaJahit:"",user_id:"system"}),[n,d]=k.useState([{variantId:"",qty:""}]),{vendors:f}=Ce(),{data:w}=me({queryKey:["productVariants"],queryFn:async()=>(await se.get("/product-variants")).data.data}),{data:N}=Ge();k.useEffect(()=>{N&&!s.no_spk&&r(m=>({...m,no_spk:N}))},[N,s.no_spk]);const p=De(),P=async()=>{if(!s.no_spk||!s.buyer||!s.tanggal||!s.deadline){alert("Please fill all required fields");return}if(n.some(m=>!m.variantId||!m.qty||parseInt(m.qty)<=0)){alert("Please select a product variant and enter a valid quantity for each article");return}await p.mutateAsync({no_spk:s.no_spk,buyer:s.buyer,spk_date:s.tanggal,deadline:s.deadline,status:s.status,notes:s.notes,sewing_cost:s.biayaJahit,user_id:s.user_id,details:n.map(m=>({product_variant_id:m.variantId,qty_order:m.qty}))}),l(),r({no_spk:"",buyer:"",tanggal:new Date().toISOString().split("T")[0],deadline:"",status:"PENDING",notes:"",biayaJahit:"",user_id:"system"}),d([{variantId:"",qty:""}])},c=()=>{d([...n,{variantId:"",qty:""}])},j=m=>{n.length>1&&d(n.filter((q,h)=>h!==m))},g=(m,q,h)=>{const u=[...n];u[m]={...u[m],[q]:h},d(u)};return e.jsxs(I,{show:t,onHide:l,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Tambah SPK"})}),e.jsx(I.Body,{children:e.jsxs(a,{children:[e.jsxs(F,{children:[e.jsx(_,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"No SPK *"}),e.jsx(a.Control,{type:"text",value:s.no_spk,onChange:m=>r({...s,no_spk:m.target.value}),placeholder:"Masukkan nomor SPK",disabled:!0})]})}),e.jsx(_,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Vendor *"}),e.jsxs(a.Select,{value:s.buyer,onChange:m=>r({...s,buyer:m.target.value}),children:[e.jsx("option",{value:"",children:"Pilih Vendor"}),f==null?void 0:f.map(m=>e.jsx("option",{value:m.name,children:m.name},m.id))]})]})})]}),e.jsxs(F,{children:[e.jsx(_,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Tanggal *"}),e.jsx(a.Control,{type:"date",value:s.tanggal,onChange:m=>r({...s,tanggal:m.target.value})})]})}),e.jsx(_,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Deadline *"}),e.jsx(a.Control,{type:"date",value:s.deadline,onChange:m=>r({...s,deadline:m.target.value})})]})})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Notes"}),e.jsx(a.Control,{as:"textarea",rows:3,value:s.notes,onChange:m=>r({...s,notes:m.target.value}),placeholder:"Masukkan catatan"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Biaya Jahit"}),e.jsx(a.Control,{type:"number",value:s.biayaJahit,onChange:m=>r({...s,biayaJahit:m.target.value}),placeholder:"Masukkan biaya jahit"})]}),e.jsx("hr",{}),n.map((m,q)=>e.jsxs(F,{className:"mb-3 align-items-end",children:[e.jsx(_,{md:5,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Product Variant *"}),e.jsxs(a.Select,{value:m.variantId,onChange:h=>g(q,"variantId",h.target.value),children:[e.jsx("option",{value:"",children:"Pilih Variant"}),w==null?void 0:w.map(h=>e.jsxs("option",{value:h.id,children:[h.product_name," - ",h.color," - ",h.size]},h.id))]})]})}),e.jsx(_,{md:5,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Qty Order *"}),e.jsx(a.Control,{type:"number",value:m.qty,onChange:h=>g(q,"qty",h.target.value)})]})}),e.jsx(_,{md:2,children:e.jsx(G,{variant:"danger",onClick:()=>j(q),disabled:n.length===1,children:"Hapus"})})]},q)),e.jsx(G,{variant:"secondary",onClick:c,children:"Tambah Artikel"})]})}),e.jsxs(I.Footer,{children:[e.jsx(G,{variant:"secondary",onClick:l,children:"Batal"}),e.jsx(G,{variant:"primary",onClick:P,disabled:p.isPending,children:p.isPending?"Menyimpan...":"Simpan"})]})]})},es=({show:t,onHide:l,spkData:s})=>{const[r,n]=k.useState({no_spk:"",buyer:"",tanggal:"",deadline:"",notes:"",biayaJahit:""}),[d,f]=k.useState([]),{vendors:w}=Ce(),{data:N,isLoading:p}=me({queryKey:["productVariants"],queryFn:async()=>(await se.get("/product-variants")).data.data}),P=Ke(),{data:c,isLoading:j}=me({queryKey:["spkDetail",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return null;const u=await se.get(`/spk/${s.id}`);return u.data.success?u.data.data:null},enabled:!!(s!=null&&s.id)&&t});k.useEffect(()=>{s&&t&&n({no_spk:s.noSpk,buyer:s.buyer,tanggal:s.spkDate,deadline:s.deadline,notes:"",biayaJahit:""})},[s,t]),k.useEffect(()=>{if(c!=null&&c.details&&N){const u=c.details.map(o=>{var x,b,S,C;return{variantId:((b=(x=o.product_variants)==null?void 0:x.id)==null?void 0:b.toString())||((S=o.product_variant_id)==null?void 0:S.toString())||"",qty:((C=o.qty_order)==null?void 0:C.toString())||""}});f(u.length>0?u:[{variantId:"",qty:""}]),n(o=>{var x;return{...o,notes:c.notes||"",biayaJahit:((x=c.sewing_cost)==null?void 0:x.toString())||""}})}},[c,N]);const g=async()=>{if(s){if(!r.no_spk||!r.buyer||!r.tanggal||!r.deadline){alert("Please fill all required fields");return}if(d.some(u=>!u.variantId||!u.qty||parseInt(u.qty)<=0)){alert("Please select a product variant and enter a valid quantity for each article");return}await P.mutateAsync({id:s.id,data:{no_spk:r.no_spk,buyer:r.buyer,spk_date:r.tanggal,deadline:r.deadline,notes:r.notes,sewing_cost:r.biayaJahit,details:d.map(u=>({product_variant_id:u.variantId,qty_order:u.qty}))}}),l()}},m=()=>{const u=N&&N.length>0?N[0].id.toString():"";f([...d,{variantId:u,qty:""}])},q=u=>{d.length>1&&f(d.filter((o,x)=>x!==u))},h=(u,o,x)=>{const b=[...d];b[u]={...b[u],[o]:x},f(b)};return t&&(p||j)&&s?e.jsxs(I,{show:t,onHide:l,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Edit SPK"})}),e.jsx(I.Body,{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 mb-0",children:"Loading data..."})]})})]}):e.jsxs(I,{show:t,onHide:l,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Edit SPK"})}),e.jsx(I.Body,{children:e.jsxs(a,{children:[e.jsxs(F,{children:[e.jsx(_,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"No SPK *"}),e.jsx(a.Control,{type:"text",value:r.no_spk,onChange:u=>n({...r,no_spk:u.target.value}),placeholder:"Masukkan nomor SPK",disabled:!0})]})}),e.jsx(_,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Vendor *"}),e.jsxs(a.Select,{value:r.buyer,onChange:u=>n({...r,buyer:u.target.value}),children:[e.jsx("option",{value:"",children:"Pilih Vendor"}),w==null?void 0:w.map(u=>e.jsx("option",{value:u.name,children:u.name},u.id))]})]})})]}),e.jsxs(F,{children:[e.jsx(_,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Tanggal *"}),e.jsx(a.Control,{type:"date",value:r.tanggal,onChange:u=>n({...r,tanggal:u.target.value})})]})}),e.jsx(_,{md:6,children:e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Deadline *"}),e.jsx(a.Control,{type:"date",value:r.deadline,onChange:u=>n({...r,deadline:u.target.value})})]})})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Notes"}),e.jsx(a.Control,{as:"textarea",rows:3,value:r.notes,onChange:u=>n({...r,notes:u.target.value}),placeholder:"Masukkan catatan"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Biaya Jahit"}),e.jsx(a.Control,{type:"number",value:r.biayaJahit,onChange:u=>n({...r,biayaJahit:u.target.value}),placeholder:"Masukkan biaya jahit"})]}),e.jsx("hr",{}),d.map((u,o)=>e.jsxs(F,{className:"mb-3 align-items-end",children:[e.jsx(_,{md:5,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Product Variant *"}),e.jsxs(a.Select,{value:u.variantId,onChange:x=>h(o,"variantId",x.target.value),children:[e.jsx("option",{value:"",children:"Pilih Variant"}),N==null?void 0:N.map(x=>e.jsxs("option",{value:x.id.toString(),children:[x.product_name," - ",x.color," - ",x.size]},x.id))]})]})}),e.jsx(_,{md:5,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Qty Order *"}),e.jsx(a.Control,{type:"number",value:u.qty,onChange:x=>h(o,"qty",x.target.value)})]})}),e.jsx(_,{md:2,children:e.jsx(G,{variant:"danger",onClick:()=>q(o),disabled:d.length===1,children:"Hapus"})})]},o)),e.jsx(G,{variant:"secondary",onClick:m,children:"Tambah Artikel"})]})}),e.jsxs(I.Footer,{children:[e.jsx(G,{variant:"secondary",onClick:l,children:"Batal"}),e.jsx(G,{variant:"primary",onClick:g,disabled:P.isPending,children:P.isPending?"Menyimpan...":"Simpan"})]})]})},Te=({spkDetail:t,artikel:l,bom:s})=>{const r=new Date().toLocaleDateString("id-ID");return e.jsxs("div",{style:{fontFamily:"Arial, sans-serif",maxWidth:"210mm",margin:"0 auto",padding:"20mm",backgroundColor:"#fff",color:"#000",lineHeight:"1.4",fontSize:"12px"},children:[e.jsxs("div",{style:{textAlign:"center",borderBottom:"2px solid #333",paddingBottom:"10px",marginBottom:"20px"},children:[e.jsx("h1",{style:{margin:"0",fontSize:"24px",fontWeight:"bold",color:"#333"},children:"SPK Detail"}),e.jsx("div",{style:{margin:"10px 0"},children:e.jsx(Je,{value:t.spk_no,width:1.5,height:40,fontSize:12})}),e.jsxs("p",{style:{margin:"5px 0 0 0",fontSize:"10px",color:"#666"},children:["Printed on: ",r]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"30px",padding:"15px",backgroundColor:"#f9f9f9",borderRadius:"5px"},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"No SPK:"})," ",t.spk_no]}),e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"Tanggal Pembuatan SPK:"})," ",t.created_dt?Y(t.created_dt):""]})]}),e.jsxs("div",{children:[e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"Nama Vendor:"})," ",t.buyer]}),e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"Deadline:"})," ",t.deadline?Y(t.deadline):""]})]}),e.jsx("div",{style:{gridColumn:"span 2"},children:e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"Notes:"})," ",t.notes]})})]}),e.jsx("h2",{style:{fontSize:"18px",marginBottom:"10px",color:"#333",borderBottom:"1px solid #ddd",paddingBottom:"5px"},children:"Artikel / Varian"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"30px",fontSize:"11px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",fontWeight:"bold"},children:"Produk"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",fontWeight:"bold"},children:"Varian"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Qty Order"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Qty Done"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Qty Shipped"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Reject"})]})}),e.jsx("tbody",{children:l.map((n,d)=>e.jsxs("tr",{style:{backgroundColor:d%2===0?"#fff":"#f9f9f9"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:n.produk}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:n.varian}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:n.qtyOrder}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:n.qtyDone}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:n.qtyShipped}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:n.reject})]},d))})]}),e.jsx("h2",{style:{fontSize:"18px",marginBottom:"10px",color:"#333",borderBottom:"1px solid #ddd",paddingBottom:"5px"},children:"BOM"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"11px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",fontWeight:"bold"},children:"Material Name"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Qty Required"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Stock Qty"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"UOM"})]})}),e.jsx("tbody",{children:s.map((n,d)=>e.jsxs("tr",{style:{backgroundColor:d%2===0?"#fff":"#f9f9f9"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:n.materialName}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:n.qty_required}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:n.stock_qty}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:n.uom})]},d))})]}),e.jsx("div",{style:{marginTop:"40px",textAlign:"center",fontSize:"10px",color:"#666",borderTop:"1px solid #ddd",paddingTop:"10px"},children:e.jsxs("p",{children:["Kalea Attire Â© ",r.split("/")[2]]})})]})},_e=t=>me({queryKey:["spkDetail",t],queryFn:async()=>{const l=await se.get(`/spk/${t}`);if(l.data.success)return l.data.data;throw new Error("Failed to fetch SPK detail")}}),ss=()=>{var D,$;const t=fe(),{data:l,isLoading:s,error:r}=$e(),[n,d]=k.useState(!1),[f,w]=k.useState(!1),[N,p]=k.useState(null),[P,c]=k.useState(null),j=k.useRef(null),{data:g,isLoading:m}=_e(P||""),q=[{key:"noSpk",label:"No SPK",className:"min-w-150px"},{key:"buyer",label:"Vendor",className:"min-w-150px"},{key:"tanggal",label:"Tanggal",className:"min-w-100px"},{key:"deadline",label:"Deadline",className:"min-w-100px"},{key:"status",label:"Status",className:"min-w-100px"}],h=(l||[]).map(y=>({id:y.id,noSpk:y.noSpk,buyer:y.buyer,tanggal:Y(y.spkDate),deadline:Y(y.deadline),status:e.jsx("span",{className:`badge badge-light-${y.status_badge}`,children:y.status_label})})),u=()=>{d(!0)},o=y=>{const R=y.id;t(`/spk/detail/${R}`)},x=k.useCallback(y=>{const R=(l||[]).find(i=>i.id===y.id);R&&(p(R),w(!0))},[l]),b=k.useCallback(y=>{const R=y.id;c(R)},[]),S=Ze.useReactToPrint({contentRef:j,documentTitle:g?`SPK-${g.spk_no}`:"SPK-Detail",pageStyle:`
      @page {
        size: A4;
        margin: 20mm;
      }
      body {
        -webkit-print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
    `});if(k.useEffect(()=>{g&&!m&&P&&(S(),c(null))},[g,m,S,P]),s)return e.jsx("div",{className:"container-fluid",children:e.jsx(J,{children:e.jsx("div",{className:"text-center p-5",children:"Loading SPK data..."})})});if(r)return e.jsx("div",{className:"container-fluid",children:e.jsx(J,{children:e.jsx("div",{className:"text-center p-5 text-danger",children:r.message})})});const C=((D=g==null?void 0:g.details)==null?void 0:D.map(y=>({id:y.id,produk:y.product_name,varian:`${y.color} - ${y.size}`,qtyOrder:y.qty_order,qtyDone:y.qty_done,qtyShipped:y.qty_shipped,reject:y.qty_reject,status_badge:y.status_badge,status:y.status,progress:y.progress,costPrice:y.cost_price})))||[],M=(($=g==null?void 0:g.boms)==null?void 0:$.map(y=>({materialName:y.material_name,qty_required:y.qty_required,stock_qty:y.stock_qty,status_badge:y.status_badge,status:y.status,uom:y.unit_of_measure})))||[];return e.jsxs("div",{className:"container-fluid",children:[g&&e.jsx("div",{ref:j,className:"spk-print-content",style:{visibility:"hidden",position:"absolute",left:"-9999px"},children:e.jsx(Te,{spkDetail:g,artikel:C,bom:M})}),e.jsx(J,{children:e.jsx(Fe,{className:"card-xl-stretch",rows:h,columns:q,labelAdd:"SPK",filters:[],onEdit:x,onPrint:b,onAddClick:u,onRowClick:o})}),e.jsx(Xe,{show:n,onHide:()=>d(!1)}),f&&N&&e.jsx(es,{show:f,onHide:()=>{w(!1),p(null)},spkData:N})]})},ts=({spkDetail:t})=>{var r;const l=We(),{currentUser:s}=qe();return e.jsxs(J,{className:"mb-5 shadow-sm border-0",children:[e.jsx("div",{className:"card-header border-0 py-4",children:e.jsxs("div",{className:"w-100 d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"card-title mb-2 d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-file-earmark-text-fill text-primary me-3 fs-1"}),t.spk_no]}),e.jsxs("p",{className:"text-muted mb-1 fs-5",children:[e.jsx("i",{className:"bi bi-building me-2"}),t.buyer]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("span",{className:"badge badge-light-primary fs-6 px-3 py-2",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Deadline: ",Y(t.deadline)]})}),e.jsx("span",{className:`badge badge-light-${t.status_badge||"primary"} fs-7 fw-bold`,children:t.status})]})]})}),e.jsx("div",{className:"card-body pt-0",children:e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-person-circle text-info me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Created By"}),e.jsx("p",{className:"text-gray-900 mb-0 fw-semibold",children:t.created_by}),e.jsx("small",{className:"text-muted",children:Y(t.created_dt)})]})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle text-success me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Approved By"}),e.jsx("p",{className:"text-gray-900 mb-0 fw-semibold",children:t.approved_by||"-"})]})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-clock text-warning me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Approved At"}),e.jsx("p",{className:"text-gray-900 mb-0 fw-semibold",children:t.approved_dt?Y(t.approved_dt):"-"})]})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-cash text-primary me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Sewing Cost"}),e.jsxs("p",{className:"text-gray-900 mb-0 fw-semibold",children:["Rp. ",((r=t.sewing_cost)==null?void 0:r.toLocaleString("id-ID"))||"-"]})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Notes"}),e.jsx("p",{className:"text-gray-900 mb-0 fw-semibold",children:t.notes})]}),e.jsx(ge,{allowedRoles:["ADMIN","OWNER","PRODUKSI"],children:Qe(t.status)==="draft"&&e.jsx("button",{className:"btn btn-primary btn-sm ms-3",onClick:()=>{s&&l.mutate({id:t.id,status:"APPROVE",user_id:s.full_name})},disabled:l.isPending,children:l.isPending?"Approving...":"Approve"})})]})})]})})]})},as=({value:t})=>e.jsxs("div",{className:"d-flex flex-column w-100 me-2",children:[e.jsx("div",{className:"d-flex flex-stack mb-2",children:e.jsx("span",{className:"text-muted me-2 fs-7 fw-semibold",children:t})}),e.jsx("div",{className:"progress h-6px w-100",children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${t}`}})})]}),ns=({artikel:t,selectedArtikelId:l,onSelectArtikel:s})=>{const r=fe(),{id:n}=Ne();return e.jsx("div",{className:"tab-pane fade show active",id:"tab1",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped align-middle gs-0 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 min-w-150px",children:"Produk"}),e.jsx("th",{className:"p-0 min-w-150px",children:"Varian"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Qty Order"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Qty Done"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Qty Shipped"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Reject"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Status"}),e.jsx("th",{className:"p-0 min-w-120px",children:"Progress"})]})}),e.jsx("tbody",{children:t.map((d,f)=>e.jsxs("tr",{onClick:()=>{s(d.id),r(`/spk/detail/${n}/stage/${d.id}`)},style:{cursor:"pointer"},className:l===d.id?"table-active":"",children:[e.jsx("td",{children:e.jsx("span",{className:"text-gray-900 fw-bold",children:d.produk})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:d.varian})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:d.qtyOrder})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:d.qtyDone})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:d.qtyShipped})}),e.jsx("td",{children:e.jsx("span",{className:"text-danger",children:d.reject})}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-light-${d.status_badge==="WAITING_APPROVAL"?"warning":d.status_badge} fs-7 fw-bold`,children:d.status==="PROCESSING"?"Proses":d.status==="DONE"?"Selesai":d.status==="PENDING"?"Tertunda":d.status==="DONE_PARTIAL"?"Selesai (Partial)":d.status==="WAITING_APPROVAL"?"Menunggu Persetujuan":d.status})}),e.jsx("td",{children:e.jsx(as,{value:d.progress})})]},f))})]})})})},rs=({bom:t})=>e.jsx("div",{className:"tab-pane fade",id:"tab2",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle gs-0 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 min-w-200px",children:"Nama Material"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Qty"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Stock"}),e.jsx("th",{className:"p-0 min-w-80px",children:"Satuan Ukuran"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Status"})]})}),e.jsx("tbody",{children:t.map((l,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:l.materialName})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:l.qty_required})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:l.stock_qty})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:l.uom})}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-light-${l.status_badge} fs-7 fw-bold`,children:l.status})})]},s))})]})})}),ls=({suratJalanHistory:t})=>e.jsx("div",{className:"tab-pane fade",id:"tab4",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle gs-0 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 min-w-150px",children:"No Surat Jalan"}),e.jsx("th",{className:"p-0 min-w-150px",children:"Tanggal"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Status"}),e.jsx("th",{className:"p-0 min-w-200px",children:"Catatan"})]})}),e.jsx("tbody",{children:t&&t.length>0?t.map((l,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:l.no||"-"})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:l.date?Y(l.date):"-"})}),e.jsx("td",{children:e.jsx(He,{status:l.status||"UNKNOWN"})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:l.notes||"-"})})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center text-muted",children:"Tidak ada history surat jalan"})})})]})})}),is=()=>{const{id:t}=Ne(),[l,s]=k.useState(null),r=k.useRef(null),{data:n,isLoading:d,error:f}=_e(t);if(d)return e.jsx("div",{children:"Loading..."});if(f)return e.jsx("div",{children:"Error loading data"});if(!n)return e.jsx("div",{children:"No data found"});const w=n.details.map(p=>({id:p.id,produk:p.product_name,varian:`${p.color} - ${p.size}`,qtyOrder:p.qty_order,qtyDone:p.qty_done,qtyShipped:p.qty_shipped,reject:p.qty_reject,status_badge:p.status_badge,status:p.status,progress:p.progress,costPrice:p.cost_price})),N=n.boms.map(p=>({materialName:p.material_name,qty_required:p.qty_required,stock_qty:p.stock_qty,status_badge:p.status_badge,status:p.status,uom:p.unit_of_measure}));return e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{ref:r,className:"spk-print-content",style:{visibility:"hidden",position:"absolute",left:"-9999px"},children:e.jsx(Te,{spkDetail:n,artikel:w,bom:N})}),e.jsx(ts,{spkDetail:n}),e.jsxs(J,{children:[e.jsx("div",{className:"p-5",children:e.jsxs("ul",{className:"nav nav-tabs nav-line-tabs",children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link active","data-bs-toggle":"tab",href:"#tab1",children:"Artikel / Varian"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link","data-bs-toggle":"tab",href:"#tab2",children:"Bahan (BOM)"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link","data-bs-toggle":"tab",href:"#tab4",children:"History Surat Jalan"})})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"tab-content",children:[e.jsx(ns,{artikel:w,selectedArtikelId:l,onSelectArtikel:s}),e.jsx(rs,{bom:N}),e.jsx(ls,{suratJalanHistory:n.surat_jalan_history||[]})]})})]})]})},ds=t=>me({queryKey:["spkStages",t],queryFn:async()=>{const l=await se.get(`/spk-stage/spk-detail/${t}?start=0&length=100`);if(l.data.success)return l.data.data;throw new Error("Failed to fetch SPK stages")}}),cs=()=>{const t=ve();return Se({mutationFn:async l=>{const s=await se.post("/spk-stage",l);if(s.data.success)return s.data.data;throw new Error("Failed to add SPK stage")},onSuccess:()=>{t.invalidateQueries({queryKey:["spkStages"]}),ae.success("SPK stage added successfully")},onError:l=>{var r;const s=l instanceof we?(r=l.response)==null?void 0:r.data.message:l instanceof Error?l.message:"Failed to add SPK stage";Array.isArray(s)?s.forEach(n=>ae.error(n)):ae.error(s)}})},os=()=>{const t=ve();return Se({mutationFn:async({id:l,payload:s})=>{const r=await se.put(`/spk-stage/${l}`,s);if(r.data.success)return r.data.data;throw new Error("Failed to update SPK stage")},onSuccess:()=>{t.invalidateQueries({queryKey:["spkStages"]}),ae.success("SPK stage updated successfully")},onError:l=>{var r;const s=l instanceof we?(r=l.response)==null?void 0:r.data.message:l instanceof Error?l.message:"Failed to update SPK stage";Array.isArray(s)?s.forEach(n=>ae.error(n)):ae.error(s)}})},Re=t=>{const[l,s]=k.useState({stageName:"",seq:1,qtyIn:0,qtyMax:0,qtyReject:[{stageName:"Cutting",qty:""},{stageName:"Jahit",qty:""}],status:"PENDING",startAt:"",endAt:"",pic:[],...t}),r=k.useRef(void 0);return k.useEffect(()=>{const c=JSON.stringify(t);r.current!==c&&(s({stageName:"",seq:1,qtyIn:0,qtyMax:0,qtyReject:[],status:"PENDING",startAt:"",endAt:"",pic:[],...t}),r.current=c)},[t]),k.useEffect(()=>{const c=l.pic.reduce((j,g)=>j+(parseInt(g.qty||"0",10)||0),0);s(j=>({...j,qtyIn:c}))},[l.pic]),{formData:l,setFormData:s,handleFormChange:(c,j)=>{s(g=>({...g,[c]:j}))},handleNumericChange:(c,j)=>{if(j===""){s(m=>({...m,[c]:0}));return}const g=parseInt(j);!isNaN(g)&&g>=0&&s(m=>({...m,[c]:g}))},updateRejectEntry:(c,j,g)=>{s(m=>({...m,qtyReject:m.qtyReject.map((q,h)=>h===c?{...q,[j]:g}:q)}))},addPicEntry:()=>{s(c=>({...c,pic:[...c.pic,{name:"",qty:""}]}))},updatePicEntry:(c,j,g)=>{s(m=>({...m,pic:m.pic.map((q,h)=>h===c?{...q,[j]:g}:q)}))},removePicEntry:c=>{s(j=>({...j,pic:j.pic.filter((g,m)=>m!==c)}))},resetForm:c=>{s({stageName:"",seq:1,qtyIn:0,qtyMax:0,qtyReject:[{stageName:"Cutting",qty:""},{stageName:"Jahit",qty:""}],status:"PENDING",startAt:"",endAt:"",pic:[],...c})}}},hs=({show:t,onHide:l,onSubmit:s,nextSeq:r})=>{const{formData:n,handleFormChange:d,handleNumericChange:f,addPicEntry:w,updatePicEntry:N,removePicEntry:p,resetForm:P}=Re({seq:r}),c=()=>{s(n),P({seq:r}),l()};return e.jsxs(I,{show:t,onHide:l,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Tambah Tahapan Produksi"})}),e.jsx(I.Body,{children:e.jsxs(a,{children:[e.jsxs(F,{className:"mb-3",children:[e.jsx(_,{md:8,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Nama Tahapan"}),e.jsx(a.Control,{type:"text",value:n.stageName,onChange:j=>d("stageName",j.target.value),placeholder:"Masukkan nama tahapan"})]})}),e.jsx(_,{md:4,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Tahap"}),e.jsx(a.Control,{type:"text",value:n.seq,onChange:j=>f("seq",j.target.value),min:"1",placeholder:"1"})]})})]}),e.jsx(F,{className:"mb-3",children:e.jsx(_,{md:12,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Qty In"}),e.jsx(a.Control,{type:"text",value:n.qtyIn,onChange:j=>f("qtyIn",j.target.value),min:"0"})]})})}),e.jsx(F,{className:"mb-3",children:e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Status"}),e.jsxs(a.Select,{value:n.status,onChange:j=>d("status",j.target.value),children:[e.jsx("option",{value:"PENDING",children:"Tertunda"}),e.jsx("option",{value:"PROCESSING",children:"Proses"}),e.jsx("option",{value:"DONE",children:"Selesai"})]})]})})}),e.jsxs(F,{className:"mb-3",children:[e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Start At"}),e.jsx(a.Control,{type:"datetime-local",value:n.startAt,onChange:j=>d("startAt",j.target.value)})]})}),e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"End At"}),e.jsx(a.Control,{type:"datetime-local",value:n.endAt,onChange:j=>d("endAt",j.target.value)})]})})]}),n.pic.map((j,g)=>e.jsxs(F,{className:"mb-3 align-items-end",children:[e.jsx(_,{md:5,children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"fw-semibold text-gray-700",children:["Nama PIC ",g+1]}),e.jsx(a.Control,{type:"text",value:j.name,onChange:m=>N(g,"name",m.target.value),placeholder:"Masukkan nama PIC",className:"form-control-solid"})]})}),e.jsx(_,{md:5,children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"fw-semibold text-gray-700",children:["Qty PIC ",g+1]}),e.jsx(a.Control,{type:"number",value:j.qty,onChange:m=>{const q=m.target.value,h=parseInt(String(n.qtyIn||0),10),u=parseInt(q||"0",10),o=Math.min(Math.max(isNaN(u)?0:u,0),isNaN(h)?0:h);N(g,"qty",o.toString())},min:"0",max:n.qtyIn,placeholder:"0",className:"form-control-solid"})]})}),e.jsx(_,{md:2,className:"text-end",children:e.jsx(G,{variant:"light-danger",size:"sm",className:"btn-icon",onClick:()=>p(g),disabled:n.pic.length===1,children:e.jsx("i",{className:"bi bi-trash3 fs-5"})})})]},g)),e.jsx(F,{className:"mb-3",children:e.jsx(_,{md:6,children:e.jsxs(G,{variant:"outline-primary",onClick:w,children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Tambah PIC"]})})})]})}),e.jsxs(I.Footer,{children:[e.jsx(G,{variant:"secondary",onClick:l,children:"Batal"}),e.jsx(G,{variant:"primary",onClick:c,children:"Simpan"})]})]})},xs=({show:t,onHide:l,onSubmit:s,initialData:r,history:n})=>{var m,q;const{formData:d,handleFormChange:f,handleNumericChange:w,updateRejectEntry:N,addPicEntry:p,updatePicEntry:P,removePicEntry:c}=Re(r),j=()=>{s(d),l()},g=n||[];return e.jsxs(I,{show:t,onHide:l,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Edit Tahapan Produksi"})}),e.jsxs(I.Body,{children:[e.jsxs(a,{children:[e.jsxs(F,{className:"mb-3",children:[e.jsx(_,{md:8,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Nama Tahapan"}),e.jsx(a.Control,{type:"text",value:d.stageName,onChange:h=>f("stageName",h.target.value),placeholder:"Masukkan nama tahapan"})]})}),e.jsx(_,{md:4,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Tahap"}),e.jsx(a.Control,{type:"text",value:d.seq,onChange:h=>w("seq",h.target.value),min:"1",placeholder:"1"})]})})]}),e.jsxs(F,{className:"mb-3",children:[e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Qty In"}),e.jsx(a.Control,{type:"text",value:d.qtyIn,disabled:!0,min:"0"})]})}),e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Status"}),e.jsxs(a.Select,{value:d.status,onChange:h=>f("status",h.target.value),children:[e.jsx("option",{value:"PENDING",children:"Tertunda"}),e.jsx("option",{value:"PROCESSING",children:"Proses"}),e.jsx("option",{value:"DONE",children:"Selesai"})]})]})})]}),e.jsxs(F,{className:"mb-3",children:[e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Start At"}),e.jsx(a.Control,{type:"datetime-local",value:d.startAt,onChange:h=>f("startAt",h.target.value)})]})}),e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"End At"}),e.jsx(a.Control,{type:"datetime-local",value:d.endAt,onChange:h=>f("endAt",h.target.value)})]})})]}),d.pic.map((h,u)=>{const x=d.pic.reduce((S,C)=>S+(parseInt(C.qty||"0",10)||0),0)-(parseInt(h.qty||"0",10)||0),b=(d.qtyMax||0)-x;return e.jsxs(F,{className:"mb-3 align-items-end",children:[e.jsx(_,{md:5,children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"fw-semibold text-gray-700",children:["Nama PIC ",u+1]}),e.jsx(a.Control,{type:"text",value:h.name,onChange:S=>P(u,"name",S.target.value),placeholder:"Masukkan nama PIC",className:"form-control-solid"})]})}),e.jsx(_,{md:5,children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"fw-semibold text-gray-700",children:["Qty PIC ",u+1]}),e.jsx(a.Control,{type:"number",value:h.qty,onChange:S=>{const C=S.target.value,M=parseInt(C||"0",10),D=Math.min(Math.max(isNaN(M)?0:M,0),b);P(u,"qty",D.toString())},min:"0",max:b||void 0,placeholder:"0",className:"form-control-solid"})]})}),e.jsx(_,{md:2,className:"text-end",children:e.jsx(G,{variant:"light-danger",size:"sm",className:"btn-icon btn-active-light-danger",onClick:()=>c(u),disabled:d.pic.length===1,children:e.jsx("i",{className:"bi bi-trash3 fs-5"})})})]},u)}),e.jsx(F,{className:"mb-3",children:e.jsx(_,{md:6,children:e.jsxs(G,{variant:"outline-primary",onClick:p,children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Tambah PIC"]})})}),d.stageName==="QC 1"||d.stageName==="QC 2"&&e.jsx(e.Fragment,{children:e.jsxs(F,{className:"mb-3 align-items-end",children:[e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold text-gray-700",children:"Cutting Reject Qty"}),e.jsx(a.Control,{type:"number",value:((m=d.qtyReject[0])==null?void 0:m.qty)||"",onChange:h=>N(0,"qty",h.target.value),min:"0",placeholder:"0",className:"form-control-solid"})]})}),e.jsx(_,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{className:"fw-semibold text-gray-700",children:"Jahit Reject Qty"}),e.jsx(a.Control,{type:"number",value:((q=d.qtyReject[1])==null?void 0:q.qty)||"",onChange:h=>N(1,"qty",h.target.value),min:"0",placeholder:"0",className:"form-control-solid"})]})})]})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{children:"Historical Data"}),e.jsxs(Ie,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Perubahan Data"}),e.jsx("th",{children:"Data Lama"}),e.jsx("th",{children:"Data Baru"}),e.jsx("th",{children:"Created By"}),e.jsx("th",{children:"Created Date"})]})}),e.jsx("tbody",{children:g.map((h,u)=>e.jsxs("tr",{children:[e.jsx("td",{children:h.field_changed}),e.jsx("td",{children:h.old_value??""}),e.jsx("td",{children:h.new_value??""}),e.jsx("td",{children:h.created_by}),e.jsx("td",{children:h.created_dt?new Date(h.created_dt).toLocaleString("id-ID"):""})]},u))})]})]})]}),e.jsxs(I.Footer,{children:[e.jsx(G,{variant:"secondary",onClick:l,children:"Batal"}),e.jsx(G,{variant:"primary",onClick:j,children:"Update"})]})]})},ms=({show:t,onHide:l,history:s})=>e.jsxs(I,{show:t,onHide:l,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Riwayat Perubahan"})}),e.jsx(I.Body,{children:e.jsxs(Ie,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Perubahan Data"}),e.jsx("th",{children:"Data Lama"}),e.jsx("th",{children:"Data Baru"}),e.jsx("th",{children:"Dibuat Oleh"}),e.jsx("th",{children:"Tanggal Dibuat"})]})}),e.jsx("tbody",{children:s.map((r,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:r.field_changed}),e.jsx("td",{children:r.old_value??"-"}),e.jsx("td",{children:r.new_value??"-"}),e.jsx("td",{children:r.created_by}),e.jsx("td",{children:r.created_dt?new Date(r.created_dt).toLocaleString("id-ID"):"-"})]},n))})]})})]}),us=()=>{const t=fe(),{id:l,spkDetailId:s}=Ne(),[r,n]=k.useState(!1),[d,f]=k.useState(!1),[w,N]=k.useState(!1),[p,P]=k.useState({}),[c,j]=k.useState([]),[g,m]=k.useState([]),{data:q}=_e(l||""),{data:h}=ds(s||""),u=cs(),o=os(),{currentUser:x}=qe(),b=q==null?void 0:q.details.find(i=>i.id===s),S=q,C=h||[],M=()=>{n(!0)},D=i=>{P({stageName:i.stage_name,seq:i.seq,qtyIn:i.qty_in,qtyMax:i.qty_max??i.qty_in,qtyReject:i.stage_name==="QC 1"||i.stage_name==="QC 2"?[{stageName:"Cutting",qty:i.qty_reject.toString()},{stageName:"Jahit",qty:"0"}]:[],status:i.status,startAt:i.start_at?new Date(i.start_at).toISOString().slice(0,16):"",endAt:i.end_at?new Date(i.end_at).toISOString().slice(0,16):"",pic:i.pics&&i.pics.length>0?i.pics.map(L=>({name:L.pic,qty:L.qty.toString()})):i.pic_id?[{name:i.pic_id,qty:"0"}]:[]}),j(i.history||[]),f(!0)},$=i=>{m(i.history||[]),N(!0)},y=i=>{const L=C.length>0?Math.max(...C.map(W=>W.seq))+1:1,K={spk_detail_id:s||"",stage_name:i.stageName,seq:L,qty_in:i.qtyIn,qty_reject:0,pic:i.pic.map(W=>({pic_id:W.name,qty:parseInt(W.qty||"0",10)})),start_at:i.startAt?new Date(i.startAt).toISOString():"",end_at:i.endAt?new Date(i.endAt).toISOString():"",status:i.status==="PROCESSING"?"PROCESSING":i.status.toUpperCase(),user_id:x==null?void 0:x.full_name};u.mutate(K,{onSuccess:()=>{n(!1)},onError:W=>{console.error("Failed to add stage:",W)}})},R=i=>{var re,de;const L=C.find(Q=>Q.stage_name===i.stageName||Q.seq===i.seq);if(console.log(i),!L){console.error("Stage not found for editing");return}const K=i.stageName==="QC 1"||i.stageName==="QC 2"?parseInt(((re=i.qtyReject[0])==null?void 0:re.qty)||"0",10):0,W=i.stageName==="QC 1"||i.stageName==="QC 2"?parseInt(((de=i.qtyReject[1])==null?void 0:de.qty)||"0",10):0,ne=i.stageName==="QC 1"||i.stageName==="QC 2"?K+W:0,pe={stage_name:i.stageName,seq:i.seq,qty_in:i.qtyIn,qty_reject:ne,qty_reject_cutting:K,qty_reject_sewing:W,pic:i.pic.map(Q=>({pic_id:Q.name,qty:parseInt(Q.qty||"0",10)})),start_at:i.startAt?new Date(i.startAt).toISOString():"",end_at:i.endAt?new Date(i.endAt).toISOString():"",status:i.status,user_id:""};o.mutate({id:L.id,payload:pe},{onSuccess:()=>{f(!1)},onError:Q=>{console.error("Failed to update stage:",Q)}})};return e.jsxs("div",{className:"container-fluid",children:[e.jsx(J,{className:"mb-5",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"card-title",children:"Detail Tahapan Produksi"}),e.jsx("p",{className:"text-muted",children:b?`${b.product_name} - ${b.color} ${b.size}`:"Produk tidak ditemukan"}),S&&e.jsxs("small",{className:"text-gray-600",children:["SPK: ",S.spk_no," | Buyer: ",S.buyer]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(ge,{allowedRoles:["ADMIN","OWNER","ADMIN PRODUKSI"],children:e.jsxs(G,{variant:"dark",className:"btn btn-sm",onClick:M,disabled:!(S!=null&&S.can_add_stage),children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Tambah Tahapan"]})}),e.jsxs("button",{className:"btn btn-sm btn-outline-dark",onClick:()=>t(-1),children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to SPK Detail"]})]})]})})}),C.length>0?e.jsx("div",{className:"row",children:C.map((i,L)=>e.jsx("div",{className:"col-lg-4 col-md-6 mb-5",children:e.jsxs(J,{className:"h-100",children:[e.jsx("div",{className:"card-header border-0 pb-0",children:e.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center pt-4",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"card-title mb-1",children:[e.jsx("span",{className:"badge badge-circle badge-primary me-2",children:i.seq}),i.stage_name]}),e.jsx("small",{className:"text-muted",children:"Tahapan Produksi"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(ge,{allowedRoles:["ADMIN","OWNER","ADMIN PRODUKSI"],children:e.jsx(G,{variant:"outline-dark",className:"btn btn-sm",onClick:()=>D(i),disabled:!i.can_edit,title:"Edit Tahapan",children:e.jsx("i",{className:"bi bi-pencil"})})}),e.jsx(ge,{allowedRoles:["ADMIN","OWNER","WAREHOUSE"],children:e.jsx(G,{variant:"outline-dark",className:"btn btn-sm",onClick:()=>$(i),title:"Lihat Riwayat",children:e.jsx("i",{className:"bi bi-eye"})})}),e.jsx("span",{className:`badge badge-light-${i.status_badge==="WAITING_APPROVAL"?"warning":i.status_badge} fs-7 fw-bold`,children:i.status==="PROCESSING"?"Proses":i.status==="DONE"?"Selesai":i.status==="PENDING"?"Tertunda":i.status==="DONE_PARTIAL"?"Selesai (Partial)":i.status==="WAITING_APPROVAL"?"Menunggu Persetujuan":i.status})]})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Qty In"}),e.jsx("span",{className:"fw-bold text-gray-900",children:i.qty_in})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Qty OK"}),e.jsx("span",{className:"fw-bold text-success",children:i.qty_in-i.qty_reject})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Qty Reject"}),e.jsx("span",{className:"fw-bold text-danger",children:i.qty_reject})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"PIC"}),e.jsx("span",{className:"fw-bold text-gray-900",children:i.pics&&i.pics.length>0?i.pics.map(K=>K.pic).join(", "):i.pic_id||"-"})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Start At"}),e.jsx("span",{className:"fw-bold text-gray-900",children:i.start_at?Y(i.start_at):"-"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"End At"}),e.jsx("span",{className:"fw-bold text-gray-900",children:i.end_at?Y(i.end_at):"-"})]})})]})]})]})},L))}):e.jsx(J,{children:e.jsxs("div",{className:"card-body text-center py-10",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"bi bi-info-circle fs-3x text-muted"})}),e.jsx("h4",{className:"text-muted mb-2",children:"Tidak ada tahapan produksi"}),e.jsx("p",{className:"text-muted mb-0",children:"Belum ada data tahapan produksi untuk produk ini."})]})}),e.jsx(hs,{show:r,onHide:()=>n(!1),onSubmit:y,nextSeq:C.length>0?Math.max(...C.map(i=>i.seq))+1:1}),e.jsx(xs,{show:d,onHide:()=>f(!1),onSubmit:R,initialData:p,history:c}),e.jsx(ms,{show:w,onHide:()=>N(!1),history:g})]})},ps=async t=>{if(!(await se.post("/spk-stage/approval",{id:t.id,status:t.status})).data.success)throw new Error("Failed to approve SPK stage")},js=async()=>{const t=await se.get("/spk-stage/waiting-approval?start=0&length=100");if(t.data.success)return t.data.data;throw new Error("Failed to fetch SPK stage waiting approval")},gs=()=>me({queryKey:["spkStageWaitingApproval"],queryFn:async()=>await js()}),ys=()=>{const t=ve();return Se({mutationFn:async l=>await ps(l),onSuccess:(l,{status:s})=>{t.invalidateQueries({queryKey:["spkStageWaitingApproval"]});const r=s==="APPROVED"?"approved":"rejected";ae.success(`SPK stage ${r} successfully`)},onError:l=>{var r;const s=l instanceof we?(r=l.response)==null?void 0:r.data.message:l instanceof Error?l.message:"Failed to process approval";Array.isArray(s)?s.forEach(n=>ae.error(n)):ae.error(s)}})},bs=()=>{const{data:t,isLoading:l,error:s}=gs(),r=ys();return l?e.jsx("div",{className:"container-fluid",children:e.jsx(J,{children:e.jsx("div",{className:"text-center p-5",children:"Loading approval data..."})})}):s?e.jsx("div",{className:"container-fluid",children:e.jsx(J,{children:e.jsx("div",{className:"text-center p-5 text-danger",children:s.message})})}):e.jsx("div",{className:"container-fluid",children:t&&t.length>0?e.jsx("div",{className:"row",children:t.map(n=>e.jsx("div",{className:"col-lg-6 col-xl-4",children:e.jsxs(J,{className:"h-100",children:[e.jsx("div",{className:"card-header border-0 pb-0",children:e.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center mt-6",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"card-title mb-1",children:[e.jsx("span",{className:"badge badge-circle badge-primary me-2",children:n.seq}),n.stage_name]}),e.jsx("small",{className:"text-muted",children:"Stage Production"})]}),e.jsx("span",{className:"badge badge-light-primary fs-7 fw-bold",children:"MENUNGGU PERSETUJUAN"})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-gray-800 fw-bold mb-3",children:"SPK Information"}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"SPK No"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.spk.spk_no})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Buyer"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.spk.buyer})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Deadline"}),e.jsx("span",{className:"fw-bold text-gray-900",children:Y(n.spk.deadline)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Status"}),e.jsx("span",{className:"badge badge-light-success fs-7",children:n.spk.status})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-gray-800 fw-bold mb-3",children:"Product Information"}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted d-block",children:"Product Name"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.product_variant.product_name})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Size"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.product_variant.size})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Color"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.product_variant.color})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"SKU"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.product_variant.sku})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-gray-800 fw-bold mb-3",children:"Production Details"}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted d-block",children:"Qty In"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.qty_in})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted d-block",children:"Qty Reject"}),e.jsx("span",{className:"fw-bold text-danger",children:n.qty_reject})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted d-block",children:"Qty OK"}),e.jsx("span",{className:"fw-bold text-success",children:n.qty_in-n.qty_reject})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"PIC"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.pic_id})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Start At"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.start_at?new Date(n.start_at).toLocaleString("id-ID"):"-"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted d-block",children:"End At"}),e.jsx("span",{className:"fw-bold text-gray-900",children:n.end_at?new Date(n.end_at).toLocaleString("id-ID"):"-"})]})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn btn-success btn-sm flex-fill",onClick:()=>r.mutate({id:n.id,status:"APPROVED"}),disabled:r.isPending,children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),r.isPending?"Approving...":"Approve"]}),e.jsxs("button",{className:"btn btn-danger btn-sm flex-fill",onClick:()=>r.mutate({id:n.id,status:"REJECTED"}),disabled:r.isPending,children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),r.isPending?"Rejecting...":"Reject"]})]})]})]})},n.id))}):e.jsx(J,{children:e.jsxs("div",{className:"card-body text-center py-10",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"bi bi-info-circle fs-3x text-muted"})}),e.jsx("h4",{className:"text-muted mb-2",children:"No Approval Requests"}),e.jsx("p",{className:"text-muted mb-0",children:"There are no SPK stages waiting for approval at the moment."})]})})})},fs=({tailorData:t,isSelected:l,onSelect:s,startDate:r,endDate:n})=>{const[d,f]=k.useState(!1),w=t.work_items.filter(c=>{const j=new Date(c.work_date).getTime(),g=r?new Date(r).getTime():-1/0,m=n?new Date(n).getTime():1/0;return j>=g&&j<=m}),N=w.length,p=w.reduce((c,j)=>c+j.quantity,0),P=()=>{f(!d)};return e.jsxs(J,{className:`mb-5 ${l?"border-primary border-2":""}`,children:[e.jsx("div",{className:"card-header border-0 py-3 cursor-pointer",onClick:s,children:e.jsxs("div",{className:"w-100 d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3 mb-md-0",children:[e.jsx("div",{className:"symbol symbol-40px symbol-circle me-3",children:e.jsx("span",{className:"symbol-label bg-primary text-white fw-bold fs-3",children:t.tailor_name.charAt(0)})}),e.jsx("div",{className:"flex-grow-1",children:e.jsx("h4",{className:"text-gray-900 fw-bold mb-0",children:t.tailor_name})})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-10 align-items-center w-100 w-md-auto",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center align-items-md-start",children:[e.jsx("div",{className:"fs-6 text-gray-700 fw-bold",children:N}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Produk"})]}),e.jsxs("div",{className:"d-flex flex-column align-items-center align-items-md-start",children:[e.jsx("div",{className:"fs-6 text-gray-700 fw-bold",children:p}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Jumlah"})]}),e.jsx("button",{className:"btn btn-sm btn-light-primary ms-auto",onClick:c=>{c.stopPropagation(),P()},children:d?"Sembunyikan":"Detail"})]})]})}),d&&e.jsx("div",{className:"card-body pt-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500 fw-bold text-uppercase fs-7",children:[e.jsx("th",{className:"min-w-150px",children:"No SPK"}),e.jsx("th",{className:"min-w-200px",children:"Nama Produk"}),e.jsx("th",{className:"min-w-150px",children:"Varian"}),e.jsx("th",{className:"min-w-150px",children:"Jumlah"}),e.jsx("th",{className:"min-w-150px",children:"Tanggal"})]})}),e.jsx("tbody",{children:w.length>0?w.map((c,j)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-700",children:c.spk_no}),e.jsx("td",{className:"text-gray-800",children:c.product_name}),e.jsx("td",{className:"text-gray-600",children:c.variant_info}),e.jsx("td",{className:"text-gray-700 fw-bold",children:c.quantity}),e.jsx("td",{className:"text-gray-600",children:Y(c.work_date)})]},j)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-gray-500 py-5",children:"Tidak ada data yang sesuai filter"})})})]})})})]})},Ns=()=>me({queryKey:["sewingReport"],queryFn:async()=>{const t=await se.get("/spk-stage/report/sewing");if(!t.data.success)throw new Error("Failed to fetch sewing report");const{total_tailor:l,total_product:s,total_qty:r,tailors:n}=t.data.data,d=n.map(f=>{const w=f.details.map(c=>({product_name:c.product_name,variant_info:c.variant,quantity:c.qty,work_date:c.date,spk_no:c.work_order_no})),N=f.details.map(c=>new Date(c.date).getTime()),p=N.length?new Date(Math.min(...N)).toISOString().slice(0,10):"",P=N.length?new Date(Math.max(...N)).toISOString().slice(0,10):"";return{tailor_name:f.pic,total_products:f.product,total_quantity:f.qty,work_date_range:{start_date:p,end_date:P},work_items:w}});return{total_tailor:l,total_product:s,total_qty:r,tailors:d}},staleTime:300*1e3}),vs=()=>{const{data:t,isLoading:l,error:s}=Ns(),[r,n]=k.useState(null),[d,f]=k.useState(""),[w,N]=k.useState(""),[p,P]=k.useState(""),c=(t==null?void 0:t.tailors.filter(h=>{const u=d?h.tailor_name.toLowerCase().includes(d.toLowerCase()):!0;let o=!0;if(w||p){const x=new Date(h.work_date_range.start_date).getTime(),b=new Date(h.work_date_range.end_date).getTime(),S=w?new Date(w).getTime():-1/0,C=p?new Date(p).getTime():1/0;o=x<=C&&b>=S}return u&&o}))||[];if(l)return e.jsx("div",{className:"container-fluid",children:e.jsx(J,{children:e.jsx("div",{className:"text-center p-5",children:"Loading report data..."})})});if(s)return e.jsx("div",{className:"container-fluid",children:e.jsx(J,{children:e.jsx("div",{className:"text-center p-5 text-danger",children:s.message})})});const j=c,g=(t==null?void 0:t.total_tailor)??j.length,m=(t==null?void 0:t.total_product)??j.reduce((h,u)=>h+u.total_products,0),q=(t==null?void 0:t.total_qty)??j.reduce((h,u)=>h+u.total_quantity,0);return e.jsxs("div",{className:"container-fluid",children:[e.jsx(ue,{breadcrumbs:[{title:"Laporan Jahit",path:"/spk/reports/sewing",isSeparator:!1,isActive:!1}],children:"Laporan Pengerjaan Jahit"}),e.jsxs(J,{children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("div",{className:"d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-5",children:e.jsxs("div",{className:"d-flex flex-wrap gap-3",children:[e.jsxs("div",{className:"position-relative",children:[e.jsxs("i",{className:"ki-duotone ki-magnifier fs-3 text-gray-500 position-absolute ms-3 mt-2",children:[e.jsx("span",{className:"path1"}),e.jsx("span",{className:"path2"})]}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-200px ps-10",placeholder:"Cari penjahit...",value:d,onChange:h=>f(h.target.value)})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("input",{type:"date",className:"form-control form-control-sm",value:w,onChange:h=>N(h.target.value)}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx("input",{type:"date",className:"form-control form-control-sm",value:p,onChange:h=>P(h.target.value)})]})]})}),e.jsx("div",{className:"d-flex flex-wrap justify-content-between align-items-center mb-5",children:e.jsx("div",{className:"d-flex flex-column",children:e.jsxs("div",{className:"d-flex gap-5 mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fs-2 text-gray-800 fw-bold",children:g}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Total Penjahit"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"fs-2 text-gray-800 fw-bold",children:m}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Total Produk"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"fs-2 text-gray-800 fw-bold",children:q}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Total Jumlah"})]})]})})})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:j.map(h=>e.jsx(fs,{tailorData:h,isSelected:r===h.tailor_name,onSelect:()=>n(r===h.tailor_name?null:h.tailor_name),startDate:w,endDate:p},h.tailor_name))})})})]})]})},je=[{title:"SPK > ",path:"/spk/",isSeparator:!1,isActive:!1}],Ms=()=>e.jsx(Oe,{children:e.jsxs(ie,{element:e.jsx(ke,{}),children:[e.jsx(ie,{path:"list",element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"SPK List"}),e.jsx(ss,{})]})}),e.jsx(ie,{path:"stage-approval",element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"SPK Stage Approval"}),e.jsx(bs,{})]})}),e.jsx(ie,{path:"reports/sewing",element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"Laporan Jahit"}),e.jsx(vs,{})]})}),e.jsxs(ie,{path:"detail/:id",element:e.jsx(ke,{}),children:[e.jsx(ie,{index:!0,element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"SPK Detail"}),e.jsx(is,{})]})}),e.jsx(ie,{path:"stage/:spkDetailId",element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"SPK Stage Detail"}),e.jsx(us,{})]})})]}),e.jsx(ie,{index:!0,element:e.jsx(Be,{to:"/spk/list"})})]})});export{Ms as default};
