import{a0 as k,Z as N,X as F,a1 as S,a5 as o,a3 as Q,r as y,j as r,k as T,C as G}from"./index-SJ6CaKPn.js";import{u as M}from"./useMutation-DXbLPUgV.js";import{u as K}from"./useMaterials-D-j_y3FE.js";import{f as v}from"./dateFormatter-Bb4_azhc.js";import{S as L}from"./StatusBadge-CDeSiPwu.js";import{D as R}from"./DynamicEditModal-BkF9yRbb.js";import{a as B,D as O}from"./DynamicDeleteModal-D55r71gl.js";import{T as H}from"./TablesWidget13-CDtcnNGt.js";import"./Modal-Dajr1G0h.js";import"./ThemeProvider-DByzDFN4.js";import"./hasClass-DxMhqE8O.js";import"./warning-YOQHYAjv.js";const J=async()=>(await k.get("/material-stock?start=0&length=100")).data.data,V=async t=>(await k.post("/material-stock",t)).data.data,W=async(t,l)=>(await k.put(`/material-stock/${t}`,l)).data.data,X=async t=>{await k.delete(`/material-stock/${t}`)},Z=async t=>(await k.post("/material-stock/approval",t)).data.data,z=()=>{const t=N(),{data:l=[],isLoading:f,error:b}=F({queryKey:["material-stocks"],queryFn:J}),h=M({mutationFn:a=>V(a),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil ditambahkan")},onError:a=>{var i;const s=a instanceof S?(i=a.response)==null?void 0:i.data.message:`Gagal menambahkan material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),g=M({mutationFn:({id:a,payload:s})=>W(a,s),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil diperbarui")},onError:a=>{var i;const s=a instanceof S?(i=a.response)==null?void 0:i.data.message:`Gagal memperbarui material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),m=M({mutationFn:X,onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil dihapus")},onError:a=>{var i;const s=a instanceof S?(i=a.response)==null?void 0:i.data.message:`Gagal menghapus material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),d=M({mutationFn:a=>Z(a),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil disetujui")},onError:a=>{var i;const s=a instanceof S?(i=a.response)==null?void 0:i.data.message:`Gagal menyetujui material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}});return{materialStocks:l,isLoading:f,error:b,addMaterialStock:h.mutate,updateMaterialStock:g.mutate,deleteMaterialStock:m.mutate,approveMaterialStock:d.mutate,isAdding:h.isPending,isUpdating:g.isPending,isDeleting:m.isPending,isApproving:d.isPending}},Y=[{title:"Inventory",path:"/inventory",isSeparator:!1,isActive:!1}],me=()=>{const{currentUser:t}=Q(),{materialStocks:l,isLoading:f,addMaterialStock:b,updateMaterialStock:h,deleteMaterialStock:g}=z(),{materials:m}=K(),[d,a]=y.useState(!1),[s,i]=y.useState(!1),[n,_]=y.useState(!1),[c,q]=y.useState(null),[u,E]=y.useState(null),D=l.map(e=>({id:e.id,material_name:e.material.material_name,material_code:e.material.material_code,uom:e.material.unit_of_measure,qty:e.qty,price:e.price,status:r.jsx(L,{status:e.status.toLowerCase()}),created_dt:v(e.created_dt),changed_dt:e.changed_dt?v(e.changed_dt):"-"})),A=[{key:"material_name",label:"Material Name"},{key:"uom",label:"UOM"},{key:"qty",label:"Qty"},{key:"price",label:"Price"},{key:"status",label:"Status"},{key:"created_dt",label:"Created Date"},{key:"changed_dt",label:"Changed Date"}],j=[{key:"status",label:"Status",options:["APPROVED","PENDING","REJECTED"]}],w=e=>{t!=null&&t.id&&(b({material_id:e.material_id,qty:parseInt(e.qty),price:parseFloat(e.price),user_id:t.id}),a(!1))},C=e=>{q(e),i(!0)},P=e=>{c&&(t!=null&&t.id)&&(h({id:c.id,payload:{material_id:e.material_id,qty:parseInt(e.qty),price:parseFloat(e.price),user_id:t.id}}),i(!1),q(null))},$=e=>{E(e),_(!0)},I=()=>{u&&(g(u.id),_(!1),E(null))};return f?r.jsx("div",{className:"card",children:r.jsxs("div",{className:"card-body text-center py-10",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:"Loading..."})}),r.jsx("div",{className:"mt-3",children:"Memuat data Material Stock..."})]})}):r.jsxs(r.Fragment,{children:[r.jsx(T,{breadcrumbs:Y,children:"Inventory Stock"}),r.jsxs(G,{children:[r.jsx(H,{className:"card-xl-stretch",rows:D,columns:A,labelAdd:"Stock",filters:j,onAddClick:()=>a(!0),onEdit:e=>{const p=l.find(x=>x.id===e.id);p&&C(p)},onDelete:e=>{const p=l.find(x=>x.id===e.id);p&&$(p)}}),d&&r.jsx(B,{show:d,title:"Tambah Material Stock",fields:[{name:"material_id",label:"Material",type:"select",required:!0,options:m.map(e=>({value:e.id,label:`${e.material_name} (${e.unit_of_measure})`}))},{name:"qty",label:"Quantity",type:"number",required:!0,placeholder:"Masukkan quantity"},{name:"price",label:"Price",type:"number",required:!1,placeholder:"Masukkan price"}],onSubmit:w,onClose:()=>a(!1)}),s&&c&&r.jsx(R,{show:s,title:"Edit Material Stock",fields:[{name:"material_id",label:"Material",type:"select",required:!0,options:m.map(e=>({value:e.id,label:`${e.material_name} (${e.unit_of_measure})`}))},{name:"qty",label:"Quantity",type:"number",required:!0,placeholder:"Masukkan quantity"},{name:"price",label:"Price",type:"number",required:!1,placeholder:"Masukkan price"}],initialData:{material_id:c.material.id,qty:c.qty.toString(),price:c.price.toString()},onSave:P,onClose:()=>{i(!1),q(null)}}),n&&u&&r.jsx(O,{show:n,title:"Hapus Material Stock",itemName:`${u.material.material_name} (${u.qty})`,onConfirm:I,onClose:()=>{_(!1),E(null)}}),(d||s||n)&&r.jsx("div",{className:"modal-backdrop fade show"})]})]})};export{me as default};
