import{r as P,j as e,a4 as Me,$ as ae,a1 as fe,_ as z,a2 as qe,a5 as ge,a3 as Ne,Y as ve,a0 as we,Z as te,k as ue,g as Ke,i as ie,O as ke,N as Be}from"./index-CjT1ZNgX.js";import{T as Oe}from"./TablesWidget13-DcY1CsaW.js";import{u as me,a as _e}from"./useMutation-bify0NZM.js";import{u as Ce}from"./useVendors-DT93MlyL.js";import{a as De,b as Fe,c as Ge,u as $e,d as We,m as Qe}from"./useSpkList-ne6It3YS.js";import{M as I}from"./Modal-Ch3UiCbq.js";import{F as t,C as k,B as D}from"./Form-Bl1QkGuE.js";import{u as Ae,b as Je,d as Ve,c as Ee}from"./ThemeProvider-DxhEyUPT.js";import{B as ze}from"./react-barcode-B1yHWEmr.js";import{f as X}from"./dateFormatter-Bb4_azhc.js";import{S as He}from"./StatusBadge-CApyHaA7.js";import"./hasClass-CN7lXdNy.js";import"./warning-6ASXsdlm.js";const O=P.forwardRef(({bsPrefix:r,className:i,as:s="div",...n},a)=>{const d=Ae(r,"row"),v=Je(),_=Ve(),w=`${d}-cols`,u=[];return v.forEach(q=>{const h=n[q];delete n[q];let p;h!=null&&typeof h=="object"?{cols:p}=h:p=h;const g=q!==_?`-${q}`:"";p!=null&&u.push(`${w}${g}-${p}`)}),e.jsx(s,{ref:a,...n,className:Ee(i,d,...u)})});O.displayName="Row";const Ie=P.forwardRef(({bsPrefix:r,className:i,striped:s,bordered:n,borderless:a,hover:d,size:v,variant:_,responsive:w,...u},q)=>{const h=Ae(r,"table"),p=Ee(i,h,_&&`${h}-${_}`,v&&`${h}-${v}`,s&&`${h}-${typeof s=="string"?`striped-${s}`:"striped"}`,n&&`${h}-bordered`,a&&`${h}-borderless`,d&&`${h}-hover`),g=e.jsx("table",{...u,className:p,ref:q});if(w){let x=`${h}-responsive`;return typeof w=="string"&&(x=`${x}-${w}`),e.jsx("div",{className:x,children:g})}return g});var ye={exports:{}},Ue=ye.exports,Pe;function Xe(){return Pe||(Pe=1,(function(r,i){(function(s,n){r.exports=n(Me())})(typeof self<"u"?self:Ue,function(s){return(function(){var n={155:function(c){c.exports=s}},a={};function d(c){var o=a[c];if(o!==void 0)return o.exports;var f=a[c]={exports:{}};return n[c](f,f.exports,d),f.exports}d.d=function(c,o){for(var f in o)d.o(o,f)&&!d.o(c,f)&&Object.defineProperty(c,f,{enumerable:!0,get:o[f]})},d.o=function(c,o){return Object.prototype.hasOwnProperty.call(c,o)},d.r=function(c){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})};var v={};d.r(v),d.d(v,{useReactToPrint:function(){return m}});var _=d(155);const w="printWindow";function u({level:c="error",messages:o,suppressErrors:f=!1}){f||(c==="error"?console.error(o):c==="warning"?console.warn(o):console.debug(o))}function q(c,o){if(o||!c){const f=document.getElementById(w);f&&document.body.removeChild(f)}}function h(c){return c instanceof Error?c:new Error("Unknown Error")}function p(c,o){const{documentTitle:f,onAfterPrint:S,onPrintError:A,preserveAfterPrint:M,print:F,suppressErrors:$}=o;setTimeout(()=>{var y,R;if(c.contentWindow){let l=function(){S==null||S(),q(M)};if(c.contentWindow.focus(),F)F(c).then(l).catch(L=>{A?A("print",h(L)):u({messages:["An error was thrown by the specified `print` function"],suppressErrors:$})});else{if(c.contentWindow.print){const L=(R=(y=c.contentDocument)===null||y===void 0?void 0:y.title)!==null&&R!==void 0?R:"",G=c.ownerDocument.title;f&&(c.ownerDocument.title=f,c.contentDocument&&(c.contentDocument.title=f)),c.contentWindow.print(),f&&(c.ownerDocument.title=G,c.contentDocument&&(c.contentDocument.title=L))}else u({messages:["Printing for this browser is not currently possible: the browser does not have a `print` method available for iframes."],suppressErrors:$});[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(L=>{var G,W;return((W=(G=navigator.userAgent)!==null&&G!==void 0?G:navigator.vendor)!==null&&W!==void 0?W:"opera"in window&&window.opera).match(L)})?setTimeout(l,500):l()}}else u({messages:["Printing failed because the `contentWindow` of the print iframe did not load. This is possibly an error with `react-to-print`. Please file an issue: https://github.com/MatthewHerbst/react-to-print/issues/"],suppressErrors:$})},500)}function g(c){const o=[],f=document.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,null);let S=f.nextNode();for(;S;)o.push(S),S=f.nextNode();return o}function x(c,o,f){const S=g(c),A=g(o);if(S.length===A.length)for(let M=0;M<S.length;M++){const F=S[M],$=A[M],y=F.shadowRoot;if(y!==null){const R=$.attachShadow({mode:y.mode});R.innerHTML=y.innerHTML,x(y,R,f)}}else u({messages:["When cloning shadow root content, source and target elements have different size. `onBeforePrint` likely resolved too early.",c,o],suppressErrors:f})}const b=`
    @page {
        /* Remove browser default header (title) and footer (url) */
        margin: 0;
    }
    @media print {
        body {
            /* Tell browsers to print background colors */
            color-adjust: exact; /* Firefox. This is an older version of "print-color-adjust" */
            print-color-adjust: exact; /* Firefox/Safari */
            -webkit-print-color-adjust: exact; /* Chrome/Safari/Edge/Opera */
        }
    }
`;function j(c,o,f,S){var A,M,F,$,y;const{contentNode:R,clonedContentNode:l,clonedImgNodes:L,clonedVideoNodes:G,numResourcesToLoad:W,originalCanvasNodes:ne}=f,{bodyClass:pe,fonts:re,ignoreGlobalStyles:de,pageStyle:Q,nonce:Z,suppressErrors:ce,copyShadowRoots:be}=S;c.onload=null;const C=(A=c.contentDocument)!==null&&A!==void 0?A:(M=c.contentWindow)===null||M===void 0?void 0:M.document;if(C){const B=C.body.appendChild(l);be&&x(R,B,!!ce),re&&(!((F=c.contentDocument)===null||F===void 0)&&F.fonts&&(!(($=c.contentWindow)===null||$===void 0)&&$.FontFace)?re.forEach(E=>{const N=new FontFace(E.family,E.source,{weight:E.weight,style:E.style});c.contentDocument.fonts.add(N),N.loaded.then(()=>{o(N)}).catch(J=>{o(N,["Failed loading the font:",N,"Load error:",h(J)])})}):(re.forEach(E=>{o(E)}),u({messages:['"react-to-print" is not able to load custom fonts because the browser does not support the FontFace API but will continue attempting to print the page'],suppressErrors:ce})));const oe=Q??b,Y=C.createElement("style");Z&&(Y.setAttribute("nonce",Z),C.head.setAttribute("nonce",Z)),Y.appendChild(C.createTextNode(oe)),C.head.appendChild(Y),pe&&C.body.classList.add(...pe.split(" "));const he=C.querySelectorAll("canvas");for(let E=0;E<ne.length;++E){const N=ne[E],J=he[E];if(J===void 0){u({messages:["A canvas element could not be copied for printing, has it loaded? `onBeforePrint` likely resolved too early.",N],suppressErrors:ce});continue}const T=J.getContext("2d");T&&T.drawImage(N,0,0)}for(let E=0;E<L.length;E++){const N=L[E],J=N.getAttribute("src");if(J){const T=new Image;T.onload=()=>{o(N)},T.onerror=(K,V,ee,U,se)=>{o(N,["Error loading <img>",N,"Error",se])},T.src=J}else o(N,['Found an <img> tag with an empty "src" attribute. This prevents pre-loading it.',N])}for(let E=0;E<G.length;E++){const N=G[E];N.preload="auto";const J=N.getAttribute("poster");if(J){const T=new Image;T.onload=()=>{o(N)},T.onerror=(K,V,ee,U,se)=>{o(N,["Error loading video poster",J,"for video",N,"Error:",se])},T.src=J}else N.readyState>=2?o(N):N.src?(N.onloadeddata=()=>{o(N)},N.onerror=(T,K,V,ee,U)=>{o(N,["Error loading video",N,"Error",U])},N.onstalled=()=>{o(N,["Loading video stalled, skipping",N])}):o(N,["Error loading video, `src` is empty",N])}const xe="select",H=R.querySelectorAll(xe),le=C.querySelectorAll(xe);for(let E=0;E<H.length;E++)le[E].value=H[E].value;if(!de){const E=document.querySelectorAll("style, link[rel~='stylesheet'], link[as='style']");for(let N=0,J=E.length;N<J;++N){const T=E[N];if(T.tagName.toLowerCase()==="style"){const K=C.createElement(T.tagName),V=T.sheet;if(V){let ee="";try{const U=V.cssRules.length;for(let se=0;se<U;++se)typeof V.cssRules[se].cssText=="string"&&(ee+=`${V.cssRules[se].cssText}\r
`)}catch(U){u({messages:["A stylesheet could not be accessed. This is likely due to the stylesheet having cross-origin imports, and many browsers block script access to cross-origin stylesheets. See https://github.com/MatthewHerbst/react-to-print/issues/429 for details. You may be able to load the sheet by both marking the stylesheet with the cross `crossorigin` attribute, and setting the `Access-Control-Allow-Origin` header on the server serving the stylesheet. Alternatively, host the stylesheet on your domain to avoid this issue entirely.",T,`Original error: ${h(U).message}`],level:"warning"})}K.setAttribute("id",`react-to-print-${N}`),Z&&K.setAttribute("nonce",Z),K.appendChild(C.createTextNode(ee)),C.head.appendChild(K)}}else if(T.getAttribute("href"))if(T.hasAttribute("disabled"))u({messages:["`react-to-print` encountered a <link> tag with a `disabled` attribute and will ignore it. Note that the `disabled` attribute is deprecated, and some browsers ignore it. You should stop using it. https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link#attr-disabled. The <link> is:",T],level:"warning"}),o(T);else{const K=C.createElement(T.tagName);for(let V=0,ee=T.attributes.length;V<ee;++V){const U=T.attributes[V];U&&K.setAttribute(U.nodeName,(y=U.nodeValue)!==null&&y!==void 0?y:"")}K.onload=()=>{o(K)},K.onerror=(V,ee,U,se,Le)=>{o(K,["Failed to load",K,"Error:",Le])},Z&&K.setAttribute("nonce",Z),C.head.appendChild(K)}else u({messages:["`react-to-print` encountered a <link> tag with an empty `href` attribute. In addition to being invalid HTML, this can cause problems in many browsers, and so the <link> was not loaded. The <link> is:",T],level:"warning"}),o(T)}}}W===0&&p(c,S)}function m({bodyClass:c,contentRef:o,copyShadowRoots:f,documentTitle:S,fonts:A,ignoreGlobalStyles:M,nonce:F,onAfterPrint:$,onBeforePrint:y,onPrintError:R,pageStyle:l,preserveAfterPrint:L,print:G,printIframeProps:W,suppressErrors:ne}){return(0,_.useCallback)(re=>{function de(){const Q={bodyClass:c,contentRef:o,copyShadowRoots:f,documentTitle:S,fonts:A,ignoreGlobalStyles:M,nonce:F,onAfterPrint:$,onPrintError:R,pageStyle:l,preserveAfterPrint:L,print:G,suppressErrors:ne},Z=(function(C){const B=document.createElement("iframe");return B.width=`${document.documentElement.clientWidth}px`,B.height=`${document.documentElement.clientHeight}px`,B.style.position="absolute",B.style.top=`-${document.documentElement.clientHeight+100}px`,B.style.left=`-${document.documentElement.clientWidth+100}px`,B.id=w,B.srcdoc="<!DOCTYPE html>",C&&(C.allow&&(B.allow=C.allow),C.referrerPolicy!==void 0&&(B.referrerPolicy=C.referrerPolicy),C.sandbox!==void 0&&(B.sandbox=C.sandbox)),B})(W),ce=(function(C,B){const{contentRef:oe,fonts:Y,ignoreGlobalStyles:he,suppressErrors:xe}=B,H=(function({contentRef:K,optionalContent:V,suppressErrors:ee}){return V&&typeof V=="function"?(K&&u({level:"warning",messages:['"react-to-print" received a `contentRef` option and an optional-content param passed to its callback. The `contentRef` option will be ignored.']}),V()):K?K.current:void u({messages:['"react-to-print" did not receive a `contentRef` option or a optional-content param pass to its callback.'],suppressErrors:ee})})({contentRef:oe,optionalContent:C,suppressErrors:xe});if(!H)return;const le=H.cloneNode(!0),E=document.querySelectorAll("link[rel~='stylesheet'], link[as='style']"),N=le.querySelectorAll("img"),J=le.querySelectorAll("video"),T=Y?Y.length:0;return{contentNode:H,clonedContentNode:le,clonedImgNodes:N,clonedVideoNodes:J,numResourcesToLoad:(he?0:E.length)+N.length+J.length+T,originalCanvasNodes:H.querySelectorAll("canvas")}})(re,Q);if(!ce)return void u({messages:["There is nothing to print"],suppressErrors:ne});const be=(function(C,B,oe){const{suppressErrors:Y}=C,he=[],xe=[];return function(H,le){he.includes(H)?u({level:"debug",messages:["Tried to mark a resource that has already been handled",H],suppressErrors:Y}):(le?(u({messages:['"react-to-print" was unable to load a resource but will continue attempting to print the page',...le],suppressErrors:Y}),xe.push(H)):he.push(H),he.length+xe.length===B&&p(oe,C))}})(Q,ce.numResourcesToLoad,Z);(function(C,B,oe,Y){C.onload=()=>{j(C,B,oe,Y)},document.body.appendChild(C)})(Z,be,ce,Q)}q(L,!0),y?y().then(()=>{de()}).catch(Q=>{R==null||R("onBeforePrint",h(Q))}):de()},[c,o,f,S,A,M,F,$,y,R,l,L,G,ne])}return v})()})})(ye)),ye.exports}var Ye=Xe();const Ze=({show:r,onHide:i})=>{const[s,n]=P.useState({no_spk:"",buyer:"",tanggal:new Date().toISOString().split("T")[0],deadline:"",status:"PENDING",notes:"",biayaJahit:"",user_id:"system"}),[a,d]=P.useState([{variantId:"",qty:""}]),{vendors:v}=Ce(),{data:_}=me({queryKey:["productVariants"],queryFn:async()=>(await ae.get("/product-variants")).data.data}),{data:w}=De();P.useEffect(()=>{w&&!s.no_spk&&n(x=>({...x,no_spk:w}))},[w,s.no_spk]);const u=Fe(),q=async()=>{if(!s.no_spk||!s.buyer||!s.tanggal||!s.deadline){alert("Please fill all required fields");return}if(a.some(x=>!x.variantId||!x.qty||parseInt(x.qty)<=0)){alert("Please select a product variant and enter a valid quantity for each article");return}await u.mutateAsync({no_spk:s.no_spk,buyer:s.buyer,spk_date:s.tanggal,deadline:s.deadline,status:s.status,notes:s.notes,sewing_cost:s.biayaJahit,user_id:s.user_id,details:a.map(x=>({product_variant_id:x.variantId,qty_order:x.qty}))}),i(),n({no_spk:"",buyer:"",tanggal:new Date().toISOString().split("T")[0],deadline:"",status:"PENDING",notes:"",biayaJahit:"",user_id:"system"}),d([{variantId:"",qty:""}])},h=()=>{d([...a,{variantId:"",qty:""}])},p=x=>{a.length>1&&d(a.filter((b,j)=>j!==x))},g=(x,b,j)=>{const m=[...a];m[x]={...m[x],[b]:j},d(m)};return e.jsxs(I,{show:r,onHide:i,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Tambah SPK"})}),e.jsx(I.Body,{children:e.jsxs(t,{children:[e.jsxs(O,{children:[e.jsx(k,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"No SPK *"}),e.jsx(t.Control,{type:"text",value:s.no_spk,onChange:x=>n({...s,no_spk:x.target.value}),placeholder:"Masukkan nomor SPK",disabled:!0})]})}),e.jsx(k,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Vendor *"}),e.jsxs(t.Select,{value:s.buyer,onChange:x=>n({...s,buyer:x.target.value}),children:[e.jsx("option",{value:"",children:"Pilih Vendor"}),v==null?void 0:v.map(x=>e.jsx("option",{value:x.name,children:x.name},x.id))]})]})})]}),e.jsxs(O,{children:[e.jsx(k,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Tanggal *"}),e.jsx(t.Control,{type:"date",value:s.tanggal,onChange:x=>n({...s,tanggal:x.target.value})})]})}),e.jsx(k,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Deadline *"}),e.jsx(t.Control,{type:"date",value:s.deadline,onChange:x=>n({...s,deadline:x.target.value})})]})})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Notes"}),e.jsx(t.Control,{as:"textarea",rows:3,value:s.notes,onChange:x=>n({...s,notes:x.target.value}),placeholder:"Masukkan catatan"})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Biaya Jahit"}),e.jsx(t.Control,{type:"number",value:s.biayaJahit,onChange:x=>n({...s,biayaJahit:x.target.value}),placeholder:"Masukkan biaya jahit"})]}),e.jsx("hr",{}),a.map((x,b)=>e.jsxs(O,{className:"mb-3 align-items-end",children:[e.jsx(k,{md:5,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Product Variant *"}),e.jsxs(t.Select,{value:x.variantId,onChange:j=>g(b,"variantId",j.target.value),children:[e.jsx("option",{value:"",children:"Pilih Variant"}),_==null?void 0:_.map(j=>e.jsxs("option",{value:j.id,children:[j.product_name," - ",j.color," - ",j.size]},j.id))]})]})}),e.jsx(k,{md:5,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Qty Order *"}),e.jsx(t.Control,{type:"number",value:x.qty,onChange:j=>g(b,"qty",j.target.value)})]})}),e.jsx(k,{md:2,children:e.jsx(D,{variant:"danger",onClick:()=>p(b),disabled:a.length===1,children:"Hapus"})})]},b)),e.jsx(D,{variant:"secondary",onClick:h,children:"Tambah Artikel"})]})}),e.jsxs(I.Footer,{children:[e.jsx(D,{variant:"secondary",onClick:i,children:"Batal"}),e.jsx(D,{variant:"primary",onClick:q,disabled:u.isPending,children:u.isPending?"Menyimpan...":"Simpan"})]})]})},es=({show:r,onHide:i,spkData:s})=>{const[n,a]=P.useState({no_spk:"",buyer:"",tanggal:"",deadline:"",notes:"",biayaJahit:""}),[d,v]=P.useState([]),{vendors:_}=Ce(),{data:w,isLoading:u}=me({queryKey:["productVariants"],queryFn:async()=>(await ae.get("/product-variants")).data.data}),q=Ge(),{data:h,isLoading:p}=me({queryKey:["spkDetail",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return null;const m=await ae.get(`/spk/${s.id}`);return m.data.success?m.data.data:null},enabled:!!(s!=null&&s.id)&&r});P.useEffect(()=>{s&&r&&a({no_spk:s.noSpk,buyer:s.buyer,tanggal:s.spkDate,deadline:s.deadline,notes:"",biayaJahit:""})},[s,r]),P.useEffect(()=>{if(h!=null&&h.details&&w){const m=h.details.map(c=>{var o,f,S,A;return{variantId:((f=(o=c.product_variants)==null?void 0:o.id)==null?void 0:f.toString())||((S=c.product_variant_id)==null?void 0:S.toString())||"",qty:((A=c.qty_order)==null?void 0:A.toString())||""}});v(m.length>0?m:[{variantId:"",qty:""}]),a(c=>{var o;return{...c,notes:h.notes||"",biayaJahit:((o=h.sewing_cost)==null?void 0:o.toString())||""}})}},[h,w]);const g=async()=>{if(s){if(!n.no_spk||!n.buyer||!n.tanggal||!n.deadline){alert("Please fill all required fields");return}if(d.some(m=>!m.variantId||!m.qty||parseInt(m.qty)<=0)){alert("Please select a product variant and enter a valid quantity for each article");return}await q.mutateAsync({id:s.id,data:{no_spk:n.no_spk,buyer:n.buyer,spk_date:n.tanggal,deadline:n.deadline,notes:n.notes,sewing_cost:n.biayaJahit,details:d.map(m=>({product_variant_id:m.variantId,qty_order:m.qty}))}}),i()}},x=()=>{const m=w&&w.length>0?w[0].id.toString():"";v([...d,{variantId:m,qty:""}])},b=m=>{d.length>1&&v(d.filter((c,o)=>o!==m))},j=(m,c,o)=>{const f=[...d];f[m]={...f[m],[c]:o},v(f)};return r&&(u||p)&&s?e.jsxs(I,{show:r,onHide:i,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Edit SPK"})}),e.jsx(I.Body,{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 mb-0",children:"Loading data..."})]})})]}):e.jsxs(I,{show:r,onHide:i,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Edit SPK"})}),e.jsx(I.Body,{children:e.jsxs(t,{children:[e.jsxs(O,{children:[e.jsx(k,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"No SPK *"}),e.jsx(t.Control,{type:"text",value:n.no_spk,onChange:m=>a({...n,no_spk:m.target.value}),placeholder:"Masukkan nomor SPK",disabled:!0})]})}),e.jsx(k,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Vendor *"}),e.jsxs(t.Select,{value:n.buyer,onChange:m=>a({...n,buyer:m.target.value}),children:[e.jsx("option",{value:"",children:"Pilih Vendor"}),_==null?void 0:_.map(m=>e.jsx("option",{value:m.name,children:m.name},m.id))]})]})})]}),e.jsxs(O,{children:[e.jsx(k,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Tanggal *"}),e.jsx(t.Control,{type:"date",value:n.tanggal,onChange:m=>a({...n,tanggal:m.target.value})})]})}),e.jsx(k,{md:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Deadline *"}),e.jsx(t.Control,{type:"date",value:n.deadline,onChange:m=>a({...n,deadline:m.target.value})})]})})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Notes"}),e.jsx(t.Control,{as:"textarea",rows:3,value:n.notes,onChange:m=>a({...n,notes:m.target.value}),placeholder:"Masukkan catatan"})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{children:"Biaya Jahit"}),e.jsx(t.Control,{type:"number",value:n.biayaJahit,onChange:m=>a({...n,biayaJahit:m.target.value}),placeholder:"Masukkan biaya jahit"})]}),e.jsx("hr",{}),d.map((m,c)=>e.jsxs(O,{className:"mb-3 align-items-end",children:[e.jsx(k,{md:5,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Product Variant *"}),e.jsxs(t.Select,{value:m.variantId,onChange:o=>j(c,"variantId",o.target.value),children:[e.jsx("option",{value:"",children:"Pilih Variant"}),w==null?void 0:w.map(o=>e.jsxs("option",{value:o.id.toString(),children:[o.product_name," - ",o.color," - ",o.size]},o.id))]})]})}),e.jsx(k,{md:5,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Qty Order *"}),e.jsx(t.Control,{type:"number",value:m.qty,onChange:o=>j(c,"qty",o.target.value)})]})}),e.jsx(k,{md:2,children:e.jsx(D,{variant:"danger",onClick:()=>b(c),disabled:d.length===1,children:"Hapus"})})]},c)),e.jsx(D,{variant:"secondary",onClick:x,children:"Tambah Artikel"})]})}),e.jsxs(I.Footer,{children:[e.jsx(D,{variant:"secondary",onClick:i,children:"Batal"}),e.jsx(D,{variant:"primary",onClick:g,disabled:q.isPending,children:q.isPending?"Menyimpan...":"Simpan"})]})]})},Te=({spkDetail:r,artikel:i,bom:s})=>{const n=new Date().toLocaleDateString("id-ID");return e.jsxs("div",{style:{fontFamily:"Arial, sans-serif",maxWidth:"210mm",margin:"0 auto",padding:"20mm",backgroundColor:"#fff",color:"#000",lineHeight:"1.4",fontSize:"12px"},children:[e.jsxs("div",{style:{textAlign:"center",borderBottom:"2px solid #333",paddingBottom:"10px",marginBottom:"20px"},children:[e.jsx("h1",{style:{margin:"0",fontSize:"24px",fontWeight:"bold",color:"#333"},children:"SPK Detail"}),e.jsx("div",{style:{margin:"10px 0"},children:e.jsx(ze,{value:r.spk_no,width:1.5,height:40,fontSize:12})}),e.jsxs("p",{style:{margin:"5px 0 0 0",fontSize:"10px",color:"#666"},children:["Printed on: ",n]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"30px",padding:"15px",backgroundColor:"#f9f9f9",borderRadius:"5px"},children:[e.jsxs("div",{children:[e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"No SPK:"})," ",r.spk_no]}),e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"Tanggal Pembuatan SPK:"})," ",r.created_dt?X(r.created_dt):""]})]}),e.jsxs("div",{children:[e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"Nama Vendor:"})," ",r.buyer]}),e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"Deadline:"})," ",r.deadline?X(r.deadline):""]})]}),e.jsx("div",{style:{gridColumn:"span 2"},children:e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[e.jsx("span",{style:{color:"#555"},children:"Notes:"})," ",r.notes]})})]}),e.jsx("h2",{style:{fontSize:"18px",marginBottom:"10px",color:"#333",borderBottom:"1px solid #ddd",paddingBottom:"5px"},children:"Artikel / Varian"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"30px",fontSize:"11px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",fontWeight:"bold"},children:"Produk"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",fontWeight:"bold"},children:"Varian"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Qty Order"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Qty Done"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Qty Shipped"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Reject"})]})}),e.jsx("tbody",{children:i.map((a,d)=>e.jsxs("tr",{style:{backgroundColor:d%2===0?"#fff":"#f9f9f9"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:a.produk}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:a.varian}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:a.qtyOrder}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:a.qtyDone}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:a.qtyShipped}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:a.reject})]},d))})]}),e.jsx("h2",{style:{fontSize:"18px",marginBottom:"10px",color:"#333",borderBottom:"1px solid #ddd",paddingBottom:"5px"},children:"BOM"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"11px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"left",fontWeight:"bold"},children:"Material Name"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Qty Required"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"Stock Qty"}),e.jsx("th",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center",fontWeight:"bold"},children:"UOM"})]})}),e.jsx("tbody",{children:s.map((a,d)=>e.jsxs("tr",{style:{backgroundColor:d%2===0?"#fff":"#f9f9f9"},children:[e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px"},children:a.materialName}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:a.qty_required}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:a.stock_qty}),e.jsx("td",{style:{border:"1px solid #ccc",padding:"10px",textAlign:"center"},children:a.uom})]},d))})]}),e.jsx("div",{style:{marginTop:"40px",textAlign:"center",fontSize:"10px",color:"#666",borderTop:"1px solid #ddd",paddingTop:"10px"},children:e.jsxs("p",{children:["Kalea Attire Â© ",n.split("/")[2]]})})]})},Se=r=>me({queryKey:["spkDetail",r],queryFn:async()=>{const i=await ae.get(`/spk/${r}`);if(i.data.success)return i.data.data;throw new Error("Failed to fetch SPK detail")}}),ss=()=>{var F,$;const r=fe(),{data:i,isLoading:s,error:n}=$e(),[a,d]=P.useState(!1),[v,_]=P.useState(!1),[w,u]=P.useState(null),[q,h]=P.useState(null),p=P.useRef(null),{data:g,isLoading:x}=Se(q||""),b=[{key:"noSpk",label:"No SPK",className:"min-w-150px"},{key:"buyer",label:"Vendor",className:"min-w-150px"},{key:"tanggal",label:"Tanggal",className:"min-w-100px"},{key:"deadline",label:"Deadline",className:"min-w-100px"},{key:"status",label:"Status",className:"min-w-100px"}],j=(i||[]).map(y=>({id:y.id,noSpk:y.noSpk,buyer:y.buyer,tanggal:X(y.spkDate),deadline:X(y.deadline),status:e.jsx("span",{className:`badge badge-light-${y.status_badge}`,children:y.status_label})})),m=()=>{d(!0)},c=y=>{const R=y.id;r(`/spk/detail/${R}`)},o=P.useCallback(y=>{const R=(i||[]).find(l=>l.id===y.id);R&&(u(R),_(!0))},[i]),f=P.useCallback(y=>{const R=y.id;h(R)},[]),S=Ye.useReactToPrint({contentRef:p,documentTitle:g?`SPK-${g.spk_no}`:"SPK-Detail",pageStyle:`
      @page {
        size: A4;
        margin: 20mm;
      }
      body {
        -webkit-print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
    `});if(P.useEffect(()=>{g&&!x&&q&&(S(),h(null))},[g,x,S,q]),s)return e.jsx("div",{className:"container-fluid",children:e.jsx(z,{children:e.jsx("div",{className:"text-center p-5",children:"Loading SPK data..."})})});if(n)return e.jsx("div",{className:"container-fluid",children:e.jsx(z,{children:e.jsx("div",{className:"text-center p-5 text-danger",children:n.message})})});const A=((F=g==null?void 0:g.details)==null?void 0:F.map(y=>({id:y.id,produk:y.product_name,varian:`${y.color} - ${y.size}`,qtyOrder:y.qty_order,qtyDone:y.qty_done,qtyShipped:y.qty_shipped,reject:y.qty_reject,status_badge:y.status_badge,status:y.status,progress:y.progress,costPrice:y.cost_price})))||[],M=(($=g==null?void 0:g.boms)==null?void 0:$.map(y=>({materialName:y.material_name,qty_required:y.qty_required,stock_qty:y.stock_qty,status_badge:y.status_badge,status:y.status,uom:y.unit_of_measure})))||[];return e.jsxs("div",{className:"container-fluid",children:[g&&e.jsx("div",{ref:p,className:"spk-print-content",style:{visibility:"hidden",position:"absolute",left:"-9999px"},children:e.jsx(Te,{spkDetail:g,artikel:A,bom:M})}),e.jsx(z,{children:e.jsx(Oe,{className:"card-xl-stretch",rows:j,columns:b,labelAdd:"SPK",filters:[],onEdit:o,onPrint:f,onAddClick:m,onRowClick:c})}),e.jsx(Ze,{show:a,onHide:()=>d(!1)}),v&&w&&e.jsx(es,{show:v,onHide:()=>{_(!1),u(null)},spkData:w})]})},ts=({spkDetail:r})=>{var n;const i=We(),{currentUser:s}=qe();return e.jsxs(z,{className:"mb-5 shadow-sm border-0",children:[e.jsx("div",{className:"card-header border-0 py-4",children:e.jsxs("div",{className:"w-100 d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"card-title mb-2 d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-file-earmark-text-fill text-primary me-3 fs-1"}),r.spk_no]}),e.jsxs("p",{className:"text-muted mb-1 fs-5",children:[e.jsx("i",{className:"bi bi-building me-2"}),r.buyer]})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("span",{className:"badge badge-light-primary fs-6 px-3 py-2",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Deadline: ",X(r.deadline)]})}),e.jsx("span",{className:`badge badge-light-${r.status_badge||"primary"} fs-7 fw-bold`,children:r.status})]})]})}),e.jsx("div",{className:"card-body pt-0",children:e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-person-circle text-info me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Created By"}),e.jsx("p",{className:"text-gray-900 mb-0 fw-semibold",children:r.created_by}),e.jsx("small",{className:"text-muted",children:X(r.created_dt)})]})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle text-success me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Approved By"}),e.jsx("p",{className:"text-gray-900 mb-0 fw-semibold",children:r.approved_by||"-"})]})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-clock text-warning me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Approved At"}),e.jsx("p",{className:"text-gray-900 mb-0 fw-semibold",children:r.approved_dt?X(r.approved_dt):"-"})]})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-cash text-primary me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Sewing Cost"}),e.jsxs("p",{className:"text-gray-900 mb-0 fw-semibold",children:["Rp. ",((n=r.sewing_cost)==null?void 0:n.toLocaleString("id-ID"))||"-"]})]})]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("span",{className:"fs-7 fw-bold text-gray-700 d-block",children:"Notes"}),e.jsx("p",{className:"text-gray-900 mb-0 fw-semibold",children:r.notes})]}),e.jsx(ge,{allowedRoles:["ADMIN","OWNER","PRODUKSI"],children:Qe(r.status)==="draft"&&e.jsx("button",{className:"btn btn-primary btn-sm ms-3",onClick:()=>{s&&i.mutate({id:r.id,status:"APPROVE",user_id:s.full_name})},disabled:i.isPending,children:i.isPending?"Approving...":"Approve"})})]})})]})})]})},as=({value:r})=>e.jsxs("div",{className:"d-flex flex-column w-100 me-2",children:[e.jsx("div",{className:"d-flex flex-stack mb-2",children:e.jsx("span",{className:"text-muted me-2 fs-7 fw-semibold",children:r})}),e.jsx("div",{className:"progress h-6px w-100",children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${r}`}})})]}),ns=({artikel:r,selectedArtikelId:i,onSelectArtikel:s})=>{const n=fe(),{id:a}=Ne();return e.jsx("div",{className:"tab-pane fade show active",id:"tab1",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped align-middle gs-0 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 min-w-150px",children:"Produk"}),e.jsx("th",{className:"p-0 min-w-150px",children:"Varian"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Qty Order"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Qty Done"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Qty Shipped"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Reject"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Status"}),e.jsx("th",{className:"p-0 min-w-120px",children:"Progress"})]})}),e.jsx("tbody",{children:r.map((d,v)=>e.jsxs("tr",{onClick:()=>{s(d.id),n(`/spk/detail/${a}/stage/${d.id}`)},style:{cursor:"pointer"},className:i===d.id?"table-active":"",children:[e.jsx("td",{children:e.jsx("span",{className:"text-gray-900 fw-bold",children:d.produk})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:d.varian})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:d.qtyOrder})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:d.qtyDone})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:d.qtyShipped})}),e.jsx("td",{children:e.jsx("span",{className:"text-danger",children:d.reject})}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-light-${d.status_badge==="WAITING_APPROVAL"?"warning":d.status_badge} fs-7 fw-bold`,children:d.status==="PROCESSING"?"Proses":d.status==="DONE"?"Selesai":d.status==="PENDING"?"Tertunda":d.status==="DONE_PARTIAL"?"Selesai (Partial)":d.status==="WAITING_APPROVAL"?"Menunggu Persetujuan":d.status})}),e.jsx("td",{children:e.jsx(as,{value:d.progress})})]},v))})]})})})},rs=({bom:r})=>e.jsx("div",{className:"tab-pane fade",id:"tab2",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle gs-0 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 min-w-200px",children:"Nama Material"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Qty"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Stock"}),e.jsx("th",{className:"p-0 min-w-80px",children:"Satuan Ukuran"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Status"})]})}),e.jsx("tbody",{children:r.map((i,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:i.materialName})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:i.qty_required})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:i.stock_qty})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:i.uom})}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-light-${i.status_badge} fs-7 fw-bold`,children:i.status})})]},s))})]})})}),ls=({suratJalanHistory:r})=>e.jsx("div",{className:"tab-pane fade",id:"tab4",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table align-middle gs-0 gy-5",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-0 min-w-150px",children:"No Surat Jalan"}),e.jsx("th",{className:"p-0 min-w-150px",children:"Tanggal"}),e.jsx("th",{className:"p-0 min-w-100px",children:"Status"}),e.jsx("th",{className:"p-0 min-w-200px",children:"Catatan"})]})}),e.jsx("tbody",{children:r&&r.length>0?r.map((i,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:i.no||"-"})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:i.date?X(i.date):"-"})}),e.jsx("td",{children:e.jsx(He,{status:i.status||"UNKNOWN"})}),e.jsx("td",{children:e.jsx("span",{className:"text-gray-900",children:i.notes||"-"})})]},s)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center text-muted",children:"Tidak ada history surat jalan"})})})]})})}),is=()=>{const{id:r}=Ne(),[i,s]=P.useState(null),n=P.useRef(null),{data:a,isLoading:d,error:v}=Se(r);if(d)return e.jsx("div",{children:"Loading..."});if(v)return e.jsx("div",{children:"Error loading data"});if(!a)return e.jsx("div",{children:"No data found"});const _=a.details.map(u=>({id:u.id,produk:u.product_name,varian:`${u.color} - ${u.size}`,qtyOrder:u.qty_order,qtyDone:u.qty_done,qtyShipped:u.qty_shipped,reject:u.qty_reject,status_badge:u.status_badge,status:u.status,progress:u.progress,costPrice:u.cost_price})),w=a.boms.map(u=>({materialName:u.material_name,qty_required:u.qty_required,stock_qty:u.stock_qty,status_badge:u.status_badge,status:u.status,uom:u.unit_of_measure}));return e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{ref:n,className:"spk-print-content",style:{visibility:"hidden",position:"absolute",left:"-9999px"},children:e.jsx(Te,{spkDetail:a,artikel:_,bom:w})}),e.jsx(ts,{spkDetail:a}),e.jsxs(z,{children:[e.jsx("div",{className:"p-5",children:e.jsxs("ul",{className:"nav nav-tabs nav-line-tabs",children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link active","data-bs-toggle":"tab",href:"#tab1",children:"Artikel / Varian"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link","data-bs-toggle":"tab",href:"#tab2",children:"Bahan (BOM)"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link","data-bs-toggle":"tab",href:"#tab4",children:"History Surat Jalan"})})]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"tab-content",children:[e.jsx(ns,{artikel:_,selectedArtikelId:i,onSelectArtikel:s}),e.jsx(rs,{bom:w}),e.jsx(ls,{suratJalanHistory:a.surat_jalan_history||[]})]})})]})]})},ds=r=>me({queryKey:["spkStages",r],queryFn:async()=>{const i=await ae.get(`/spk-stage/spk-detail/${r}?start=0&length=100`);if(i.data.success)return i.data.data;throw new Error("Failed to fetch SPK stages")}}),cs=()=>{const r=ve();return _e({mutationFn:async i=>{const s=await ae.post("/spk-stage",i);if(s.data.success)return s.data.data;throw new Error("Failed to add SPK stage")},onSuccess:()=>{r.invalidateQueries({queryKey:["spkStages"]}),te.success("SPK stage added successfully")},onError:i=>{var n;const s=i instanceof we?(n=i.response)==null?void 0:n.data.message:i instanceof Error?i.message:"Failed to add SPK stage";Array.isArray(s)?s.forEach(a=>te.error(a)):te.error(s)}})},os=()=>{const r=ve();return _e({mutationFn:async({id:i,payload:s})=>{const n=await ae.put(`/spk-stage/${i}`,s);if(n.data.success)return n.data.data;throw new Error("Failed to update SPK stage")},onSuccess:()=>{r.invalidateQueries({queryKey:["spkStages"]}),te.success("SPK stage updated successfully")},onError:i=>{var n;const s=i instanceof we?(n=i.response)==null?void 0:n.data.message:i instanceof Error?i.message:"Failed to update SPK stage";Array.isArray(s)?s.forEach(a=>te.error(a)):te.error(s)}})},Re=r=>{const[i,s]=P.useState({stageName:"",seq:1,qtyIn:0,qtyMax:0,qtyReject:[{stageName:"Cutting",qty:""},{stageName:"Jahit",qty:""}],status:"PENDING",startAt:"",endAt:"",pic:[],...r}),n=P.useRef(void 0);return P.useEffect(()=>{const h=JSON.stringify(r);n.current!==h&&(s({stageName:"",seq:1,qtyIn:0,qtyMax:0,qtyReject:[],status:"PENDING",startAt:"",endAt:"",pic:[],...r}),n.current=h)},[r]),P.useEffect(()=>{const h=i.pic.reduce((p,g)=>p+(parseInt(g.qty||"0",10)||0),0);s(p=>({...p,qtyIn:h}))},[i.pic]),{formData:i,setFormData:s,handleFormChange:(h,p)=>{s(g=>({...g,[h]:p}))},handleNumericChange:(h,p)=>{if(p===""){s(x=>({...x,[h]:0}));return}const g=parseInt(p);!isNaN(g)&&g>=0&&s(x=>({...x,[h]:g}))},updateRejectEntry:(h,p,g)=>{s(x=>({...x,qtyReject:x.qtyReject.map((b,j)=>j===h?{...b,[p]:g}:b)}))},addPicEntry:()=>{s(h=>({...h,pic:[...h.pic,{name:"",qty:""}]}))},updatePicEntry:(h,p,g)=>{s(x=>({...x,pic:x.pic.map((b,j)=>j===h?{...b,[p]:g}:b)}))},removePicEntry:h=>{s(p=>({...p,pic:p.pic.filter((g,x)=>x!==h)}))},resetForm:h=>{s({stageName:"",seq:1,qtyIn:0,qtyMax:0,qtyReject:[{stageName:"Cutting",qty:""},{stageName:"Jahit",qty:""}],status:"PENDING",startAt:"",endAt:"",pic:[],...h})}}},hs=({show:r,onHide:i,onSubmit:s,nextSeq:n})=>{const{formData:a,handleFormChange:d,handleNumericChange:v,addPicEntry:_,updatePicEntry:w,removePicEntry:u,resetForm:q}=Re({seq:n}),h=()=>{s(a),q({seq:n}),i()};return e.jsxs(I,{show:r,onHide:i,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Tambah Tahapan Produksi"})}),e.jsx(I.Body,{children:e.jsxs(t,{children:[e.jsxs(O,{className:"mb-3",children:[e.jsx(k,{md:8,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Nama Tahapan"}),e.jsx(t.Control,{type:"text",value:a.stageName,onChange:p=>d("stageName",p.target.value),placeholder:"Masukkan nama tahapan"})]})}),e.jsx(k,{md:4,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Tahap"}),e.jsx(t.Control,{type:"text",value:a.seq,onChange:p=>v("seq",p.target.value),min:"1",placeholder:"1"})]})})]}),e.jsx(O,{className:"mb-3",children:e.jsx(k,{md:12,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Qty In"}),e.jsx(t.Control,{type:"text",value:a.qtyIn,onChange:p=>v("qtyIn",p.target.value),min:"0"})]})})}),e.jsx(O,{className:"mb-3",children:e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Status"}),e.jsxs(t.Select,{value:a.status,onChange:p=>d("status",p.target.value),children:[e.jsx("option",{value:"PENDING",children:"Tertunda"}),e.jsx("option",{value:"PROCESSING",children:"Proses"}),e.jsx("option",{value:"DONE",children:"Selesai"})]})]})})}),e.jsxs(O,{className:"mb-3",children:[e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Start At"}),e.jsx(t.Control,{type:"datetime-local",value:a.startAt,onChange:p=>d("startAt",p.target.value)})]})}),e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"End At"}),e.jsx(t.Control,{type:"datetime-local",value:a.endAt,onChange:p=>d("endAt",p.target.value)})]})})]}),a.pic.map((p,g)=>e.jsxs(O,{className:"mb-3 align-items-end",children:[e.jsx(k,{md:5,children:e.jsxs(t.Group,{children:[e.jsxs(t.Label,{className:"fw-semibold text-gray-700",children:["Nama PIC ",g+1]}),e.jsx(t.Control,{type:"text",value:p.name,onChange:x=>w(g,"name",x.target.value),placeholder:"Masukkan nama PIC",className:"form-control-solid"})]})}),e.jsx(k,{md:5,children:e.jsxs(t.Group,{children:[e.jsxs(t.Label,{className:"fw-semibold text-gray-700",children:["Qty PIC ",g+1]}),e.jsx(t.Control,{type:"number",value:p.qty,onChange:x=>{const b=x.target.value,j=parseInt(String(a.qtyIn||0),10),m=parseInt(b||"0",10),c=Math.min(Math.max(isNaN(m)?0:m,0),isNaN(j)?0:j);w(g,"qty",c.toString())},min:"0",max:a.qtyIn,placeholder:"0",className:"form-control-solid"})]})}),e.jsx(k,{md:2,className:"text-end",children:e.jsx(D,{variant:"light-danger",size:"sm",className:"btn-icon",onClick:()=>u(g),disabled:a.pic.length===1,children:e.jsx("i",{className:"bi bi-trash3 fs-5"})})})]},g)),e.jsx(O,{className:"mb-3",children:e.jsx(k,{md:6,children:e.jsxs(D,{variant:"outline-primary",onClick:_,children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Tambah PIC"]})})})]})}),e.jsxs(I.Footer,{children:[e.jsx(D,{variant:"secondary",onClick:i,children:"Batal"}),e.jsx(D,{variant:"primary",onClick:h,children:"Simpan"})]})]})},xs=({show:r,onHide:i,onSubmit:s,initialData:n,history:a})=>{var x,b;const{formData:d,handleFormChange:v,handleNumericChange:_,updateRejectEntry:w,addPicEntry:u,updatePicEntry:q,removePicEntry:h}=Re(n),p=()=>{s(d),i()},g=a||[];return e.jsxs(I,{show:r,onHide:i,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Edit Tahapan Produksi"})}),e.jsxs(I.Body,{children:[e.jsxs(t,{children:[e.jsxs(O,{className:"mb-3",children:[e.jsx(k,{md:8,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Nama Tahapan"}),e.jsx(t.Control,{type:"text",value:d.stageName,onChange:j=>v("stageName",j.target.value),placeholder:"Masukkan nama tahapan"})]})}),e.jsx(k,{md:4,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Tahap"}),e.jsx(t.Control,{type:"text",value:d.seq,onChange:j=>_("seq",j.target.value),min:"1",placeholder:"1"})]})})]}),e.jsxs(O,{className:"mb-3",children:[e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Qty In"}),e.jsx(t.Control,{type:"text",value:d.qtyIn,disabled:!0,min:"0"})]})}),e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Status"}),e.jsxs(t.Select,{value:d.status,onChange:j=>v("status",j.target.value),children:[e.jsx("option",{value:"PENDING",children:"Tertunda"}),e.jsx("option",{value:"PROCESSING",children:"Proses"}),e.jsx("option",{value:"DONE",children:"Selesai"})]})]})})]}),e.jsxs(O,{className:"mb-3",children:[e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"Start At"}),e.jsx(t.Control,{type:"datetime-local",value:d.startAt,onChange:j=>v("startAt",j.target.value)})]})}),e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{children:"End At"}),e.jsx(t.Control,{type:"datetime-local",value:d.endAt,onChange:j=>v("endAt",j.target.value)})]})})]}),d.pic.map((j,m)=>{const o=d.pic.reduce((S,A)=>S+(parseInt(A.qty||"0",10)||0),0)-(parseInt(j.qty||"0",10)||0),f=(d.qtyMax||0)-o;return e.jsxs(O,{className:"mb-3 align-items-end",children:[e.jsx(k,{md:5,children:e.jsxs(t.Group,{children:[e.jsxs(t.Label,{className:"fw-semibold text-gray-700",children:["Nama PIC ",m+1]}),e.jsx(t.Control,{type:"text",value:j.name,onChange:S=>q(m,"name",S.target.value),placeholder:"Masukkan nama PIC",className:"form-control-solid"})]})}),e.jsx(k,{md:5,children:e.jsxs(t.Group,{children:[e.jsxs(t.Label,{className:"fw-semibold text-gray-700",children:["Qty PIC ",m+1]}),e.jsx(t.Control,{type:"number",value:j.qty,onChange:S=>{const A=S.target.value,M=parseInt(A||"0",10),F=Math.min(Math.max(isNaN(M)?0:M,0),f);q(m,"qty",F.toString())},min:"0",max:f||void 0,placeholder:"0",className:"form-control-solid"})]})}),e.jsx(k,{md:2,className:"text-end",children:e.jsx(D,{variant:"light-danger",size:"sm",className:"btn-icon btn-active-light-danger",onClick:()=>h(m),disabled:d.pic.length===1,children:e.jsx("i",{className:"bi bi-trash3 fs-5"})})})]},m)}),e.jsx(O,{className:"mb-3",children:e.jsx(k,{md:6,children:e.jsxs(D,{variant:"outline-primary",onClick:u,children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Tambah PIC"]})})}),d.stageName==="QC 1"||d.stageName==="QC 2"&&e.jsx(e.Fragment,{children:e.jsxs(O,{className:"mb-3 align-items-end",children:[e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{className:"fw-semibold text-gray-700",children:"Cutting Reject Qty"}),e.jsx(t.Control,{type:"number",value:((x=d.qtyReject[0])==null?void 0:x.qty)||"",onChange:j=>w(0,"qty",j.target.value),min:"0",placeholder:"0",className:"form-control-solid"})]})}),e.jsx(k,{md:6,children:e.jsxs(t.Group,{children:[e.jsx(t.Label,{className:"fw-semibold text-gray-700",children:"Jahit Reject Qty"}),e.jsx(t.Control,{type:"number",value:((b=d.qtyReject[1])==null?void 0:b.qty)||"",onChange:j=>w(1,"qty",j.target.value),min:"0",placeholder:"0",className:"form-control-solid"})]})})]})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{children:"Historical Data"}),e.jsxs(Ie,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Perubahan Data"}),e.jsx("th",{children:"Data Lama"}),e.jsx("th",{children:"Data Baru"}),e.jsx("th",{children:"Created By"}),e.jsx("th",{children:"Created Date"})]})}),e.jsx("tbody",{children:g.map((j,m)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.field_changed}),e.jsx("td",{children:j.old_value??""}),e.jsx("td",{children:j.new_value??""}),e.jsx("td",{children:j.created_by}),e.jsx("td",{children:j.created_dt?new Date(j.created_dt).toLocaleString("id-ID"):""})]},m))})]})]})]}),e.jsxs(I.Footer,{children:[e.jsx(D,{variant:"secondary",onClick:i,children:"Batal"}),e.jsx(D,{variant:"primary",onClick:p,children:"Update"})]})]})},ms=({show:r,onHide:i,history:s})=>e.jsxs(I,{show:r,onHide:i,size:"lg",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Riwayat Perubahan"})}),e.jsx(I.Body,{children:e.jsxs(Ie,{striped:!0,bordered:!0,hover:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Perubahan Data"}),e.jsx("th",{children:"Data Lama"}),e.jsx("th",{children:"Data Baru"}),e.jsx("th",{children:"Dibuat Oleh"}),e.jsx("th",{children:"Tanggal Dibuat"})]})}),e.jsx("tbody",{children:s.map((n,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:n.field_changed}),e.jsx("td",{children:n.old_value??"-"}),e.jsx("td",{children:n.new_value??"-"}),e.jsx("td",{children:n.created_by}),e.jsx("td",{children:n.created_dt?new Date(n.created_dt).toLocaleString("id-ID"):"-"})]},a))})]})})]}),us=()=>{const r=fe(),{id:i,spkDetailId:s}=Ne(),[n,a]=P.useState(!1),[d,v]=P.useState(!1),[_,w]=P.useState(!1),[u,q]=P.useState({}),[h,p]=P.useState([]),[g,x]=P.useState([]),{data:b}=Se(i||""),{data:j}=ds(s||""),m=cs(),c=os(),{currentUser:o}=qe(),f=b==null?void 0:b.details.find(l=>l.id===s),S=b,A=j||[],M=()=>{a(!0)},F=l=>{q({stageName:l.stage_name,seq:l.seq,qtyIn:l.qty_in,qtyMax:l.qty_max??l.qty_in,qtyReject:l.stage_name==="QC 1"||l.stage_name==="QC 2"?[{stageName:"Cutting",qty:l.qty_reject.toString()},{stageName:"Jahit",qty:"0"}]:[],status:l.status,startAt:l.start_at?new Date(l.start_at).toISOString().slice(0,16):"",endAt:l.end_at?new Date(l.end_at).toISOString().slice(0,16):"",pic:l.pics&&l.pics.length>0?l.pics.map(L=>({name:L.pic,qty:L.qty.toString()})):l.pic_id?[{name:l.pic_id,qty:"0"}]:[]}),p(l.history||[]),v(!0)},$=l=>{x(l.history||[]),w(!0)},y=l=>{const L=A.length>0?Math.max(...A.map(W=>W.seq))+1:1,G={spk_detail_id:s||"",stage_name:l.stageName,seq:L,qty_in:l.qtyIn,qty_reject:0,pic:l.pic.map(W=>({pic_id:W.name,qty:parseInt(W.qty||"0",10)})),start_at:l.startAt?new Date(l.startAt).toISOString():"",end_at:l.endAt?new Date(l.endAt).toISOString():"",status:l.status==="PROCESSING"?"PROCESSING":l.status.toUpperCase(),user_id:o==null?void 0:o.full_name};m.mutate(G,{onSuccess:()=>{a(!1)},onError:W=>{console.error("Failed to add stage:",W)}})},R=l=>{var re,de;const L=A.find(Q=>Q.stage_name===l.stageName||Q.seq===l.seq);if(console.log(l),!L){console.error("Stage not found for editing");return}const G=l.stageName==="QC 1"||l.stageName==="QC 2"?parseInt(((re=l.qtyReject[0])==null?void 0:re.qty)||"0",10):0,W=l.stageName==="QC 1"||l.stageName==="QC 2"?parseInt(((de=l.qtyReject[1])==null?void 0:de.qty)||"0",10):0,ne=l.stageName==="QC 1"||l.stageName==="QC 2"?G+W:0,pe={stage_name:l.stageName,seq:l.seq,qty_in:l.qtyIn,qty_reject:ne,qty_reject_cutting:G,qty_reject_sewing:W,pic:l.pic.map(Q=>({pic_id:Q.name,qty:parseInt(Q.qty||"0",10)})),start_at:l.startAt?new Date(l.startAt).toISOString():"",end_at:l.endAt?new Date(l.endAt).toISOString():"",status:l.status,user_id:""};c.mutate({id:L.id,payload:pe},{onSuccess:()=>{v(!1)},onError:Q=>{console.error("Failed to update stage:",Q)}})};return e.jsxs("div",{className:"container-fluid",children:[e.jsx(z,{className:"mb-5",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"card-title",children:"Detail Tahapan Produksi"}),e.jsx("p",{className:"text-muted",children:f?`${f.product_name} - ${f.color} ${f.size}`:"Produk tidak ditemukan"}),S&&e.jsxs("small",{className:"text-gray-600",children:["SPK: ",S.spk_no," | Buyer: ",S.buyer]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(ge,{allowedRoles:["ADMIN","OWNER","ADMIN PRODUKSI"],children:e.jsxs(D,{variant:"dark",className:"btn btn-sm",onClick:M,disabled:!(S!=null&&S.can_add_stage),children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Tambah Tahapan"]})}),e.jsxs("button",{className:"btn btn-sm btn-outline-dark",onClick:()=>r(-1),children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to SPK Detail"]})]})]})})}),A.length>0?e.jsx("div",{className:"row",children:A.map((l,L)=>e.jsx("div",{className:"col-lg-4 col-md-6 mb-5",children:e.jsxs(z,{className:"h-100",children:[e.jsx("div",{className:"card-header border-0 pb-0",children:e.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center pt-4",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"card-title mb-1",children:[e.jsx("span",{className:"badge badge-circle badge-primary me-2",children:l.seq}),l.stage_name]}),e.jsx("small",{className:"text-muted",children:"Tahapan Produksi"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(ge,{allowedRoles:["ADMIN","OWNER","ADMIN PRODUKSI"],children:e.jsx(D,{variant:"outline-dark",className:"btn btn-sm",onClick:()=>F(l),disabled:!l.can_edit,title:"Edit Tahapan",children:e.jsx("i",{className:"bi bi-pencil"})})}),e.jsx(ge,{allowedRoles:["ADMIN","OWNER","WAREHOUSE"],children:e.jsx(D,{variant:"outline-dark",className:"btn btn-sm",onClick:()=>$(l),title:"Lihat Riwayat",children:e.jsx("i",{className:"bi bi-eye"})})}),e.jsx("span",{className:`badge badge-light-${l.status_badge==="WAITING_APPROVAL"?"warning":l.status_badge} fs-7 fw-bold`,children:l.status==="PROCESSING"?"Proses":l.status==="DONE"?"Selesai":l.status==="PENDING"?"Tertunda":l.status==="DONE_PARTIAL"?"Selesai (Partial)":l.status==="WAITING_APPROVAL"?"Menunggu Persetujuan":l.status})]})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Qty In"}),e.jsx("span",{className:"fw-bold text-gray-900",children:l.qty_in})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Qty OK"}),e.jsx("span",{className:"fw-bold text-success",children:l.qty_in-l.qty_reject})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Qty Reject"}),e.jsx("span",{className:"fw-bold text-danger",children:l.qty_reject})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"PIC"}),e.jsx("span",{className:"fw-bold text-gray-900",children:l.pics&&l.pics.length>0?l.pics.map(G=>G.pic).join(", "):l.pic_id||"-"})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Start At"}),e.jsx("span",{className:"fw-bold text-gray-900",children:l.start_at?X(l.start_at):"-"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"End At"}),e.jsx("span",{className:"fw-bold text-gray-900",children:l.end_at?X(l.end_at):"-"})]})})]})]})]})},L))}):e.jsx(z,{children:e.jsxs("div",{className:"card-body text-center py-10",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"bi bi-info-circle fs-3x text-muted"})}),e.jsx("h4",{className:"text-muted mb-2",children:"Tidak ada tahapan produksi"}),e.jsx("p",{className:"text-muted mb-0",children:"Belum ada data tahapan produksi untuk produk ini."})]})}),e.jsx(hs,{show:n,onHide:()=>a(!1),onSubmit:y,nextSeq:A.length>0?Math.max(...A.map(l=>l.seq))+1:1}),e.jsx(xs,{show:d,onHide:()=>v(!1),onSubmit:R,initialData:u,history:h}),e.jsx(ms,{show:_,onHide:()=>w(!1),history:g})]})},ps=async r=>{if(!(await ae.post("/spk-stage/approval",{id:r.id,status:r.status})).data.success)throw new Error("Failed to approve SPK stage")},js=async()=>{const r=await ae.get("/spk-stage/waiting-approval?start=0&length=100");if(r.data.success)return r.data.data;throw new Error("Failed to fetch SPK stage waiting approval")},gs=()=>me({queryKey:["spkStageWaitingApproval"],queryFn:async()=>await js()}),ys=()=>{const r=ve();return _e({mutationFn:async i=>await ps(i),onSuccess:(i,{status:s})=>{r.invalidateQueries({queryKey:["spkStageWaitingApproval"]});const n=s==="APPROVED"?"approved":"rejected";te.success(`SPK stage ${n} successfully`)},onError:i=>{var n;const s=i instanceof we?(n=i.response)==null?void 0:n.data.message:i instanceof Error?i.message:"Failed to process approval";Array.isArray(s)?s.forEach(a=>te.error(a)):te.error(s)}})},bs=()=>{const{data:r,isLoading:i,error:s}=gs(),n=ys();return i?e.jsx("div",{className:"container-fluid",children:e.jsx(z,{children:e.jsx("div",{className:"text-center p-5",children:"Loading approval data..."})})}):s?e.jsx("div",{className:"container-fluid",children:e.jsx(z,{children:e.jsx("div",{className:"text-center p-5 text-danger",children:s.message})})}):e.jsx("div",{className:"container-fluid",children:r&&r.length>0?e.jsx("div",{className:"row",children:r.map(a=>e.jsx("div",{className:"col-lg-6 col-xl-4",children:e.jsxs(z,{className:"h-100",children:[e.jsx("div",{className:"card-header border-0 pb-0",children:e.jsxs("div",{className:"w-100 d-flex justify-content-between align-items-center mt-6",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"card-title mb-1",children:[e.jsx("span",{className:"badge badge-circle badge-primary me-2",children:a.seq}),a.stage_name]}),e.jsx("small",{className:"text-muted",children:"Stage Production"})]}),e.jsx("span",{className:"badge badge-light-primary fs-7 fw-bold",children:"MENUNGGU PERSETUJUAN"})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-gray-800 fw-bold mb-3",children:"SPK Information"}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"SPK No"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.spk.spk_no})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Buyer"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.spk.buyer})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Deadline"}),e.jsx("span",{className:"fw-bold text-gray-900",children:X(a.spk.deadline)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Status"}),e.jsx("span",{className:"badge badge-light-success fs-7",children:a.spk.status})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-gray-800 fw-bold mb-3",children:"Product Information"}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted d-block",children:"Product Name"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.product_variant.product_name})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Size"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.product_variant.size})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Color"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.product_variant.color})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"SKU"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.product_variant.sku})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-gray-800 fw-bold mb-3",children:"Production Details"}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted d-block",children:"Qty In"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.qty_in})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted d-block",children:"Qty Reject"}),e.jsx("span",{className:"fw-bold text-danger",children:a.qty_reject})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("small",{className:"text-muted d-block",children:"Qty OK"}),e.jsx("span",{className:"fw-bold text-success",children:a.qty_in-a.qty_reject})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"PIC"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.pic_id})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Start At"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.start_at?new Date(a.start_at).toLocaleString("id-ID"):"-"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("small",{className:"text-muted d-block",children:"End At"}),e.jsx("span",{className:"fw-bold text-gray-900",children:a.end_at?new Date(a.end_at).toLocaleString("id-ID"):"-"})]})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn btn-success btn-sm flex-fill",onClick:()=>n.mutate({id:a.id,status:"APPROVED"}),disabled:n.isPending,children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),n.isPending?"Approving...":"Approve"]}),e.jsxs("button",{className:"btn btn-danger btn-sm flex-fill",onClick:()=>n.mutate({id:a.id,status:"REJECTED"}),disabled:n.isPending,children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),n.isPending?"Rejecting...":"Reject"]})]})]})]})},a.id))}):e.jsx(z,{children:e.jsxs("div",{className:"card-body text-center py-10",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"bi bi-info-circle fs-3x text-muted"})}),e.jsx("h4",{className:"text-muted mb-2",children:"No Approval Requests"}),e.jsx("p",{className:"text-muted mb-0",children:"There are no SPK stages waiting for approval at the moment."})]})})})},fs=({tailorData:r,isSelected:i,onSelect:s,startDate:n,endDate:a})=>{const[d,v]=P.useState(!1),_=r.work_items.filter(h=>{const p=new Date(h.work_date).getTime(),g=n?new Date(n).getTime():-1/0,x=a?new Date(a).getTime():1/0;return p>=g&&p<=x}),w=_.length,u=_.reduce((h,p)=>h+p.quantity,0),q=()=>{v(!d)};return e.jsxs(z,{className:`mb-5 ${i?"border-primary border-2":""}`,children:[e.jsx("div",{className:"card-header border-0 py-3 cursor-pointer",onClick:s,children:e.jsxs("div",{className:"w-100 d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3 mb-md-0",children:[e.jsx("div",{className:"symbol symbol-40px symbol-circle me-3",children:e.jsx("span",{className:"symbol-label bg-primary text-white fw-bold fs-3",children:r.tailor_name.charAt(0)})}),e.jsx("div",{className:"flex-grow-1",children:e.jsx("h4",{className:"text-gray-900 fw-bold mb-0",children:r.tailor_name})})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-10 align-items-center w-100 w-md-auto",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center align-items-md-start",children:[e.jsx("div",{className:"fs-6 text-gray-700 fw-bold",children:w}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Produk"})]}),e.jsxs("div",{className:"d-flex flex-column align-items-center align-items-md-start",children:[e.jsx("div",{className:"fs-6 text-gray-700 fw-bold",children:u}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Jumlah"})]}),e.jsx("button",{className:"btn btn-sm btn-light-primary ms-auto",onClick:h=>{h.stopPropagation(),q()},children:d?"Sembunyikan":"Detail"})]})]})}),d&&e.jsx("div",{className:"card-body pt-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500 fw-bold text-uppercase fs-7",children:[e.jsx("th",{className:"min-w-150px",children:"No SPK"}),e.jsx("th",{className:"min-w-200px",children:"Nama Produk"}),e.jsx("th",{className:"min-w-150px",children:"Varian"}),e.jsx("th",{className:"min-w-150px",children:"Jumlah"}),e.jsx("th",{className:"min-w-150px",children:"Tanggal"})]})}),e.jsx("tbody",{children:_.length>0?_.map((h,p)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-700",children:h.spk_no}),e.jsx("td",{className:"text-gray-800",children:h.product_name}),e.jsx("td",{className:"text-gray-600",children:h.variant_info}),e.jsx("td",{className:"text-gray-700 fw-bold",children:h.quantity}),e.jsx("td",{className:"text-gray-600",children:X(h.work_date)})]},p)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-gray-500 py-5",children:"Tidak ada data yang sesuai filter"})})})]})})})]})},Ns=()=>me({queryKey:["sewingReport"],queryFn:async()=>[{tailor_name:"Ahmad Santoso",total_products:3,total_quantity:150,work_date_range:{start_date:"2025-10-20",end_date:"2025-11-05"},work_items:[{product_name:"Kalea Oversized Hoodie",variant_info:"Hitam - L",quantity:50,work_date:"2025-10-20",spk_no:"001/SPK/X/2025"},{product_name:"Kalea Oversized Hoodie",variant_info:"Hitam - M",quantity:70,work_date:"2025-10-25",spk_no:"001/SPK/X/2025"},{product_name:"Kemeja Formal",variant_info:"Putih - L",quantity:30,work_date:"2025-11-05",spk_no:"002/SPK/XI/2025"}]},{tailor_name:"Budi Prasetyo",total_products:2,total_quantity:80,work_date_range:{start_date:"2025-10-22",end_date:"2025-11-03"},work_items:[{product_name:"Celana Chino",variant_info:"Coklat - M",quantity:30,work_date:"2025-10-22",spk_no:"003/SPK/IX/2025"},{product_name:"Celana Chino",variant_info:"Coklat - L",quantity:50,work_date:"2025-11-03",spk_no:"003/SPK/IX/2025"}]},{tailor_name:"Siti Aminah",total_products:4,total_quantity:200,work_date_range:{start_date:"2025-10-18",end_date:"2025-11-08"},work_items:[{product_name:"Dress Casual",variant_info:"Merah - S",quantity:40,work_date:"2025-10-18",spk_no:"004/SPK/X/2025"},{product_name:"Dress Casual",variant_info:"Merah - M",quantity:50,work_date:"2025-10-20",spk_no:"004/SPK/X/2025"},{product_name:"Dress Casual",variant_info:"Biru - M",quantity:60,work_date:"2025-10-25",spk_no:"005/SPK/X/2025"},{product_name:"Dress Casual",variant_info:"Biru - L",quantity:50,work_date:"2025-11-08",spk_no:"005/SPK/X/2025"}]},{tailor_name:"Rina Kusuma",total_products:2,total_quantity:90,work_date_range:{start_date:"2025-10-25",end_date:"2025-11-10"},work_items:[{product_name:"Jaket Denim",variant_info:"Biru - L",quantity:40,work_date:"2025-10-25",spk_no:"006/SPK/XI/2025"},{product_name:"Jaket Denim",variant_info:"Biru - XL",quantity:50,work_date:"2025-11-10",spk_no:"006/SPK/XI/2025"}]},{tailor_name:"Joko Susilo",total_products:3,total_quantity:120,work_date_range:{start_date:"2025-10-15",end_date:"2025-11-02"},work_items:[{product_name:"Celana Jeans",variant_info:"Biru - M",quantity:35,work_date:"2025-10-15",spk_no:"007/SPK/IX/2025"},{product_name:"Celana Jeans",variant_info:"Biru - L",quantity:45,work_date:"2025-10-20",spk_no:"007/SPK/IX/2025"},{product_name:"Celana Jeans",variant_info:"Biru - XL",quantity:40,work_date:"2025-11-02",spk_no:"008/SPK/X/2025"}]}],staleTime:300*1e3}),vs=()=>{const{data:r,isLoading:i,error:s}=Ns(),[n,a]=P.useState(null),[d,v]=P.useState(""),[_,w]=P.useState(""),[u,q]=P.useState(""),h=(r==null?void 0:r.filter(b=>{const j=d?b.tailor_name.toLowerCase().includes(d.toLowerCase()):!0;let m=!0;if(_||u){const c=new Date(b.work_date_range.start_date).getTime(),o=new Date(b.work_date_range.end_date).getTime(),f=_?new Date(_).getTime():-1/0,S=u?new Date(u).getTime():1/0;m=c<=S&&o>=f}return j&&m}))||[];if(i)return e.jsx("div",{className:"container-fluid",children:e.jsx(z,{children:e.jsx("div",{className:"text-center p-5",children:"Loading report data..."})})});if(s)return e.jsx("div",{className:"container-fluid",children:e.jsx(z,{children:e.jsx("div",{className:"text-center p-5 text-danger",children:s.message})})});const p=h,g=p.reduce((b,j)=>b+j.total_products,0),x=p.reduce((b,j)=>b+j.total_quantity,0);return e.jsxs("div",{className:"container-fluid",children:[e.jsx(ue,{breadcrumbs:[{title:"Laporan Jahit",path:"/spk/reports/sewing",isSeparator:!1,isActive:!1}],children:"Laporan Pengerjaan Jahit"}),e.jsxs(z,{children:[e.jsxs("div",{className:"card-header border-0 pt-5",children:[e.jsx("div",{className:"d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-5",children:e.jsxs("div",{className:"d-flex flex-wrap gap-3",children:[e.jsxs("div",{className:"position-relative",children:[e.jsxs("i",{className:"ki-duotone ki-magnifier fs-3 text-gray-500 position-absolute ms-3 mt-2",children:[e.jsx("span",{className:"path1"}),e.jsx("span",{className:"path2"})]}),e.jsx("input",{type:"text",className:"form-control form-control-sm w-200px ps-10",placeholder:"Cari penjahit...",value:d,onChange:b=>v(b.target.value)})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("input",{type:"date",className:"form-control form-control-sm",value:_,onChange:b=>w(b.target.value)}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx("input",{type:"date",className:"form-control form-control-sm",value:u,onChange:b=>q(b.target.value)})]})]})}),e.jsx("div",{className:"d-flex flex-wrap justify-content-between align-items-center mb-5",children:e.jsx("div",{className:"d-flex flex-column",children:e.jsxs("div",{className:"d-flex gap-5 mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fs-2 text-gray-800 fw-bold",children:p.length}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Total Penjahit"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"fs-2 text-gray-800 fw-bold",children:g}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Total Produk"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"fs-2 text-gray-800 fw-bold",children:x}),e.jsx("div",{className:"text-gray-500 fs-7",children:"Total Jumlah"})]})]})})})]}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:p.map(b=>e.jsx(fs,{tailorData:b,isSelected:n===b.tailor_name,onSelect:()=>a(n===b.tailor_name?null:b.tailor_name),startDate:_,endDate:u},b.tailor_name))})})})]})]})},je=[{title:"SPK > ",path:"/spk/",isSeparator:!1,isActive:!1}],Ms=()=>e.jsx(Ke,{children:e.jsxs(ie,{element:e.jsx(ke,{}),children:[e.jsx(ie,{path:"list",element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"SPK List"}),e.jsx(ss,{})]})}),e.jsx(ie,{path:"stage-approval",element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"SPK Stage Approval"}),e.jsx(bs,{})]})}),e.jsx(ie,{path:"reports/sewing",element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"Laporan Jahit"}),e.jsx(vs,{})]})}),e.jsxs(ie,{path:"detail/:id",element:e.jsx(ke,{}),children:[e.jsx(ie,{index:!0,element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"SPK Detail"}),e.jsx(is,{})]})}),e.jsx(ie,{path:"stage/:spkDetailId",element:e.jsxs(e.Fragment,{children:[e.jsx(ue,{breadcrumbs:je,children:"SPK Stage Detail"}),e.jsx(us,{})]})})]}),e.jsx(ie,{index:!0,element:e.jsx(Be,{to:"/spk/list"})})]})});export{Ms as default};
