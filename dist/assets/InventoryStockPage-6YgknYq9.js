import{a0 as k,Z as $,X as F,a1 as S,a7 as o,a3 as Q,r as y,j as r,k as R,C as O}from"./index-CcxKac3z.js";import{u as g}from"./useMutation-BbXnzo1k.js";import{u as T}from"./useMaterials-COBG-l8W.js";import{f as v}from"./dateFormatter-Bb4_azhc.js";import{b as G,a as K,D as W}from"./DynamicEditModal-9Ub8EoGz.js";import{T as H}from"./TablesWidget13-DdJTvDRX.js";import"./Modal-D4I9ZlVZ.js";import"./ThemeProvider-q1Z8hl0d.js";import"./hasClass-Dc6NTiut.js";import"./Form-BF-3RJVH.js";import"./warning-DzwJTdBv.js";const L=async()=>(await k.get("/material-stock?start=0&length=100")).data.data,B=async t=>(await k.post("/material-stock",t)).data.data,J=async(t,l)=>(await k.put(`/material-stock/${t}`,l)).data.data,U=async t=>{await k.delete(`/material-stock/${t}`)},V=async t=>(await k.post("/material-stock/approval",t)).data.data,X=()=>{const t=$(),{data:l=[],isLoading:f,error:b}=F({queryKey:["material-stocks"],queryFn:L}),h=g({mutationFn:a=>B(a),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil ditambahkan")},onError:a=>{var i;const s=a instanceof S?(i=a.response)==null?void 0:i.data.message:`Gagal menambahkan material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),M=g({mutationFn:({id:a,payload:s})=>J(a,s),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil diperbarui")},onError:a=>{var i;const s=a instanceof S?(i=a.response)==null?void 0:i.data.message:`Gagal memperbarui material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),m=g({mutationFn:U,onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil dihapus")},onError:a=>{var i;const s=a instanceof S?(i=a.response)==null?void 0:i.data.message:`Gagal menghapus material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),d=g({mutationFn:a=>V(a),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil disetujui")},onError:a=>{var i;const s=a instanceof S?(i=a.response)==null?void 0:i.data.message:`Gagal menyetujui material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}});return{materialStocks:l,isLoading:f,error:b,addMaterialStock:h.mutate,updateMaterialStock:M.mutate,deleteMaterialStock:m.mutate,approveMaterialStock:d.mutate,isAdding:h.isPending,isUpdating:M.isPending,isDeleting:m.isPending,isApproving:d.isPending}},Z=[{title:"Inventory",path:"/inventory",isSeparator:!1,isActive:!1}],de=()=>{const{currentUser:t}=Q(),{materialStocks:l,isLoading:f,addMaterialStock:b,updateMaterialStock:h,deleteMaterialStock:M}=X(),{materials:m}=T(),[d,a]=y.useState(!1),[s,i]=y.useState(!1),[n,E]=y.useState(!1),[c,_]=y.useState(null),[u,q]=y.useState(null),x=l.map(e=>({id:e.id,material_name:e.material.material_name,material_code:e.material.material_code,uom:e.material.unit_of_measure,qty:e.qty,price:e.price,created_dt:v(e.created_dt),changed_dt:e.changed_dt?v(e.changed_dt):"-"})),D=[{key:"material_name",label:"Material Name"},{key:"uom",label:"UOM"},{key:"qty",label:"Qty"},{key:"price",label:"Price"},{key:"status",label:"Status"},{key:"created_dt",label:"Created Date"},{key:"changed_dt",label:"Changed Date"}],j=[{key:"status",label:"Status",options:["APPROVED","PENDING","REJECTED"]}],w=e=>{t!=null&&t.id&&(b({material_id:e.material_id,qty:parseInt(e.qty),price:parseFloat(e.price),user_id:t.id}),a(!1))},C=e=>{_(e),i(!0)},N=e=>{c&&(t!=null&&t.id)&&(h({id:c.id,payload:{material_id:e.material_id,qty:parseInt(e.qty),price:parseFloat(e.price),user_id:t.id}}),i(!1),_(null))},I=e=>{q(e),E(!0)},P=()=>{u&&(M(u.id),E(!1),q(null))};return f?r.jsx("div",{className:"card",children:r.jsxs("div",{className:"card-body text-center py-10",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:"Loading..."})}),r.jsx("div",{className:"mt-3",children:"Memuat data Material Stock..."})]})}):r.jsxs(r.Fragment,{children:[r.jsx(R,{breadcrumbs:Z,children:"Inventory Stock"}),r.jsxs(O,{children:[r.jsx(H,{className:"card-xl-stretch",rows:x,columns:D,labelAdd:"Stock",filters:j,onAddClick:()=>a(!0),onEdit:e=>{const p=l.find(A=>A.id===e.id);p&&C(p)},onDelete:e=>{const p=l.find(A=>A.id===e.id);p&&I(p)},roleAccess:{add:["ADMIN","OWNER","WAREHOUSE"],edit:["ADMIN","OWNER","WAREHOUSE"]}}),d&&r.jsx(G,{show:d,title:"Tambah Material Stock",fields:[{name:"material_id",label:"Material",type:"select",required:!0,options:m.map(e=>({value:e.id,label:`${e.material_name} (${e.unit_of_measure})`}))},{name:"qty",label:"Quantity",type:"number",required:!0,placeholder:"Masukkan quantity"},{name:"price",label:"Price",type:"number",required:!1,placeholder:"Masukkan price"}],onSubmit:w,onClose:()=>a(!1)}),s&&c&&r.jsx(K,{show:s,title:"Edit Material Stock",fields:[{name:"material_id",label:"Material",type:"select",required:!0,options:m.map(e=>({value:e.id,label:`${e.material_name} (${e.unit_of_measure})`}))},{name:"qty",label:"Quantity",type:"number",required:!0,placeholder:"Masukkan quantity"},{name:"price",label:"Price",type:"number",required:!1,placeholder:"Masukkan price"}],initialData:{material_id:c.material.id,qty:c.qty.toString(),price:c.price.toString()},onSave:N,onClose:()=>{i(!1),_(null)}}),n&&u&&r.jsx(W,{show:n,title:"Hapus Material Stock",itemName:`${u.material.material_name} (${u.qty})`,onConfirm:P,onClose:()=>{E(!1),q(null)}}),(d||s||n)&&r.jsx("div",{className:"modal-backdrop fade show"})]})]})};export{de as default};
