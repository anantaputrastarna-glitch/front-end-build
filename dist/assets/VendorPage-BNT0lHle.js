import{r as o,a2 as I,j as i,_ as g,k as $}from"./index-CjT1ZNgX.js";import{T as W}from"./TablesWidget13-DcY1CsaW.js";import{D as L,a as O,b as B}from"./DynamicEditModal-CWHXiAYX.js";import{u as H}from"./useVendors-DT93MlyL.js";import{f as N}from"./dateFormatter-Bb4_azhc.js";import"./ThemeProvider-DxhEyUPT.js";import"./Modal-Ch3UiCbq.js";import"./hasClass-CN7lXdNy.js";import"./Form-Bl1QkGuE.js";import"./warning-6ASXsdlm.js";import"./useMutation-bify0NZM.js";const G=[{title:"Dashboard",path:"/dashboard",isSeparator:!1,isActive:!1}],le=()=>{const[x,p]=o.useState(!1),[f,u]=o.useState(!1),[_,h]=o.useState(!1),[a,l]=o.useState(null),[c,v]=o.useState([]),[S,w]=o.useState([]),[q,d]=o.useState([]),[J,P]=o.useState(null),[Q,m]=o.useState(null),{currentUser:b}=I(),{vendors:j,isLoading:k,addVendor:D,updateVendor:E,deleteVendor:A}=H();o.useEffect(()=>{(async()=>{try{const n=await(await fetch("https://www.emsifa.com/api-wilayah-indonesia/api/provinces.json")).json();v(n)}catch(t){console.error("Failed to fetch provinces",t)}})()},[]);const y=async e=>{try{return await(await fetch(`https://www.emsifa.com/api-wilayah-indonesia/api/regencies/${e}.json`)).json()}catch(t){return console.error("Failed to fetch regencies",t),[]}},V=j.map(e=>({...e,location:`${e.city}, ${e.province}${e.country?`, ${e.country}`:""}`,created_dt:N(e.created_dt),changed_dt:e.changed_dt?N(e.changed_dt):"-"})),C=[{key:"name",label:"Nama",className:"min-w-140px"},{key:"contact_person",label:"Contact Person",className:"min-w-140px"},{key:"phone",label:"Phone",className:"min-w-120px"},{key:"email",label:"Email",className:"min-w-120px"},{key:"address",label:"Alamat",className:"min-w-120px"},{key:"location",label:"Lokasi",className:"min-w-150px"},{key:"zip_code",label:"Kode Pos",className:"min-w-100px"},{key:"tax_number",label:"NPWP",className:"min-w-120px"},{key:"created_by",label:"Dibuat Oleh",className:"min-w-120px"},{key:"created_dt",label:"Tanggal Dibuat",className:"min-w-120px"},{key:"changed_by",label:"Diubah Oleh",className:"min-w-120px"},{key:"changed_dt",label:"Tanggal Diubah",className:"min-w-120px"}],M=e=>{l(e),p(!0)},z=()=>{a&&(A(a.id),p(!1),l(null))},T=e=>{l(e),u(!0);const t=c.find(n=>n.name===e.province);t?(m(t.id),y(t.id).then(n=>d(n.map(s=>({id:s.id,name:s.name}))))):(m(null),d([]))},F=e=>{a&&(E({id:a.id,vendor:{name:e.name,contact_person:e.contact_person,phone:e.phone,email:e.email,address:e.address,city:e.city,province:e.province,zip_code:e.zip_code,tax_number:e.tax_number}}),u(!1),l(null))},K=()=>{h(!0)},R=e=>{D({name:e.name,contact_person:e.contact_person,phone:e.phone,email:e.email,address:e.address,city:e.city,province:e.province,zip_code:e.zip_code,tax_number:e.tax_number,is_active:e.is_active,user_id:b==null?void 0:b.full_name}),h(!1)};return k?i.jsx(g,{children:i.jsxs("div",{className:"card-body text-center py-10",children:[i.jsx("div",{className:"spinner-border text-primary",role:"status",children:i.jsx("span",{className:"visually-hidden",children:"Loading..."})}),i.jsx("div",{className:"mt-3",children:"Memuat data vendor..."})]})}):i.jsxs("div",{className:"container-fluid",children:[i.jsx($,{breadcrumbs:G,children:"Master Vendor"}),i.jsx(g,{children:i.jsx(W,{className:"card-xl-stretch",rows:V,columns:C,labelAdd:"Vendor",onDelete:M,onEdit:T,onAddClick:K})}),x&&a&&i.jsx(L,{show:x,title:"Hapus Vendor",itemName:a.name,onConfirm:z,onClose:()=>{p(!1),l(null)}}),f&&a&&i.jsx(O,{show:f,title:"Edit Vendor",fields:[{name:"name",label:"Nama",type:"text",required:!0,icon:"user"},{name:"contact_person",label:"Contact Person",type:"text",required:!0,icon:"user"},{name:"phone",label:"Phone",type:"text",required:!0,icon:"phone"},{name:"email",label:"Email",type:"text",required:!0,icon:"email"},{name:"province",label:"Provinsi",type:"select",required:!0,icon:"map",options:c.map(e=>({value:e.name,label:e.name})),onChange:async(e,t)=>{const n=c.find(s=>s.name===e);if(n){m(n.id);const s=await y(n.id);d(s.map(r=>({id:r.id,name:r.name}))),t.setFieldValue("city","")}else m(null),d([]),t.setFieldValue("city","")}},{name:"city",label:"Kota",type:"select",required:!0,icon:"map",options:q.map(e=>({value:e.name,label:e.name}))},{name:"address",label:"Alamat",type:"textarea",required:!0,icon:"map"},{name:"zip_code",label:"Kode Pos",type:"text",required:!0,icon:"map"},{name:"tax_number",label:"NPWP",type:"text",required:!1,icon:"document"}],initialData:{name:a.name,contact_person:a.contact_person,phone:a.phone,email:a.email,address:a.address,province:a.province,city:a.city,zip_code:a.zip_code,tax_number:a.tax_number},onSave:F,onClose:()=>{u(!1),l(null)}}),_&&i.jsx(B,{show:_,title:"Tambah Vendor",fields:[{name:"name",label:"Nama",type:"text",required:!0,icon:"user"},{name:"contact_person",label:"Contact Person",type:"text",required:!0,icon:"user"},{name:"phone",label:"Phone",type:"text",required:!0,icon:"phone"},{name:"email",label:"Email",type:"text",required:!0,icon:"email"},{name:"province",label:"Provinsi",type:"select",required:!0,icon:"map",options:c.map(e=>({value:e.name,label:e.name})),onChange:async(e,t)=>{const n=c.find(s=>s.name===e);if(n){P(n.id);const s=await y(n.id);w(s.map(r=>({id:r.id,name:r.name}))),t.setFieldValue("city","")}else P(null),w([]),t.setFieldValue("city","")}},{name:"city",label:"Kota",type:"select",required:!0,icon:"map",options:S.map(e=>({value:e.name,label:e.name}))},{name:"address",label:"Alamat",type:"textarea",required:!0,icon:"map"},{name:"zip_code",label:"Kode Pos",type:"text",required:!0,icon:"map"},{name:"tax_number",label:"NPWP",type:"text",required:!1,icon:"document"},{name:"is_active",label:"Status Aktif",type:"checkbox",required:!1,icon:"check-circle"}],onSubmit:R,onClose:()=>h(!1)})]})};export{le as default};
