import{$ as k,Y as P,a0 as g,a6 as o,a2 as F,r as y,j as r,k as Q,C as R}from"./index-D-XR31JT.js";import{u as T,a as S}from"./useMutation-Oh55HBpB.js";import{u as G}from"./useMaterials-B89BU0cm.js";import{f as v}from"./dateFormatter-Bb4_azhc.js";import{b as K,a as O,D as L}from"./DynamicEditModal-OwU-ZmUL.js";import{T as W}from"./TablesWidget13-y_aP1tXu.js";import"./Modal-DYMOa9Z9.js";import"./ThemeProvider-B2JDDGPV.js";import"./hasClass-CdozZXuC.js";import"./Form--xwUDFMC.js";import"./warning-iUkfSyoP.js";const H=async()=>(await k.get("/material-stock?start=0&length=100")).data.data,B=async t=>(await k.post("/material-stock",t)).data.data,J=async(t,l)=>(await k.put(`/material-stock/${t}`,l)).data.data,V=async t=>{await k.delete(`/material-stock/${t}`)},Y=async t=>(await k.post("/material-stock/approval",t)).data.data,z=()=>{const t=P(),{data:l=[],isLoading:f,error:b}=T({queryKey:["material-stocks"],queryFn:H}),h=S({mutationFn:a=>B(a),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil ditambahkan")},onError:a=>{var i;const s=a instanceof g?(i=a.response)==null?void 0:i.data.message:`Gagal menambahkan material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),M=S({mutationFn:({id:a,payload:s})=>J(a,s),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil diperbarui")},onError:a=>{var i;const s=a instanceof g?(i=a.response)==null?void 0:i.data.message:`Gagal memperbarui material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),m=S({mutationFn:V,onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil dihapus")},onError:a=>{var i;const s=a instanceof g?(i=a.response)==null?void 0:i.data.message:`Gagal menghapus material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}}),c=S({mutationFn:a=>Y(a),onSuccess:()=>{t.invalidateQueries({queryKey:["material-stocks"]}),o.success("Material stock berhasil disetujui")},onError:a=>{var i;const s=a instanceof g?(i=a.response)==null?void 0:i.data.message:`Gagal menyetujui material stock: ${a.message}`;Array.isArray(s)?s.forEach(n=>o.error(n)):o.error(s)}});return{materialStocks:l,isLoading:f,error:b,addMaterialStock:h.mutate,updateMaterialStock:M.mutate,deleteMaterialStock:m.mutate,approveMaterialStock:c.mutate,isAdding:h.isPending,isUpdating:M.isPending,isDeleting:m.isPending,isApproving:c.isPending}},U=[{title:"Inventory",path:"/inventory",isSeparator:!1,isActive:!1}],ce=()=>{const{currentUser:t}=F(),{materialStocks:l,isLoading:f,addMaterialStock:b,updateMaterialStock:h,deleteMaterialStock:M}=z(),{materials:m}=G(),[c,a]=y.useState(!1),[s,i]=y.useState(!1),[n,_]=y.useState(!1),[d,q]=y.useState(null),[u,E]=y.useState(null),x=l.map(e=>({id:e.id,material_name:e.material.material_name,material_code:e.material.material_code,uom:e.material.unit_of_measure,qty:e.qty,price:e.price,created_dt:v(e.created_dt),changed_dt:e.changed_dt?v(e.changed_dt):"-"})),D=[{key:"material_name",label:"Material Name"},{key:"uom",label:"UOM"},{key:"qty",label:"Qty"},{key:"price",label:"Price"},{key:"status",label:"Status"},{key:"created_dt",label:"Created Date"},{key:"changed_dt",label:"Changed Date"}],j=[{key:"status",label:"Status",options:["APPROVED","PENDING","REJECTED"]}],w=e=>{t!=null&&t.id&&(b({material_id:e.material_id,qty:parseInt(e.qty),price:parseFloat(e.price),user_id:t.id}),a(!1))},C=e=>{q(e),i(!0)},N=e=>{d&&(t!=null&&t.id)&&(h({id:d.id,payload:{material_id:e.material_id,qty:parseInt(e.qty),price:parseFloat(e.price),user_id:t.id}}),i(!1),q(null))},$=e=>{E(e),_(!0)},I=()=>{u&&(M(u.id),_(!1),E(null))};return f?r.jsx("div",{className:"card",children:r.jsxs("div",{className:"card-body text-center py-10",children:[r.jsx("div",{className:"spinner-border text-primary",role:"status",children:r.jsx("span",{className:"visually-hidden",children:"Loading..."})}),r.jsx("div",{className:"mt-3",children:"Memuat data Material Stock..."})]})}):r.jsxs(r.Fragment,{children:[r.jsx(Q,{breadcrumbs:U,children:"Inventory Stock"}),r.jsxs(R,{children:[r.jsx(W,{className:"card-xl-stretch",rows:x,columns:D,labelAdd:"Stock",filters:j,onAddClick:()=>a(!0),onEdit:e=>{const p=l.find(A=>A.id===e.id);p&&C(p)},onDelete:e=>{const p=l.find(A=>A.id===e.id);p&&$(p)},roleAccess:["ADMIN","OWNER","WAREHOUSE"]}),c&&r.jsx(K,{show:c,title:"Tambah Material Stock",fields:[{name:"material_id",label:"Material",type:"select",required:!0,options:m.map(e=>({value:e.id,label:`${e.material_name} (${e.unit_of_measure})`}))},{name:"qty",label:"Quantity",type:"number",required:!0,placeholder:"Masukkan quantity"},{name:"price",label:"Price",type:"number",required:!1,placeholder:"Masukkan price"}],onSubmit:w,onClose:()=>a(!1)}),s&&d&&r.jsx(O,{show:s,title:"Edit Material Stock",fields:[{name:"material_id",label:"Material",type:"select",required:!0,options:m.map(e=>({value:e.id,label:`${e.material_name} (${e.unit_of_measure})`}))},{name:"qty",label:"Quantity",type:"number",required:!0,placeholder:"Masukkan quantity"},{name:"price",label:"Price",type:"number",required:!1,placeholder:"Masukkan price"}],initialData:{material_id:d.material.id,qty:d.qty.toString(),price:d.price.toString()},onSave:N,onClose:()=>{i(!1),q(null)}}),n&&u&&r.jsx(L,{show:n,title:"Hapus Material Stock",itemName:`${u.material.material_name} (${u.qty})`,onConfirm:I,onClose:()=>{_(!1),E(null)}}),(c||s||n)&&r.jsx("div",{className:"modal-backdrop fade show"})]})]})};export{ce as default};
